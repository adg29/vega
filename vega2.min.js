!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.vg=e()}}(function(){var e;return function t(e,n,r){function i(s,o){if(!n[s]){if(!e[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[s]={exports:{}};e[s][0].call(d.exports,function(t){var n=e[s][1][t];return i(n?n:t)},d,d.exports,t,e,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){t.exports={core:{View:e("./src/core/View")},dataflow:{changeset:e("./src/dataflow/changeset"),Datasource:e("./src/dataflow/Datasource"),Graph:e("./src/dataflow/Graph"),Node:e("./src/dataflow/Node")},parse:e("./src/parse/"),scene:{Builder:e("./src/scene/Builder"),GroupBuilder:e("./src/scene/GroupBuilder")},transforms:e("./src/transforms/"),config:e("./src/util/config"),util:e("datalib"),schema:e("./src/util/schema")}},{"./src/core/View":30,"./src/dataflow/Datasource":32,"./src/dataflow/Graph":33,"./src/dataflow/Node":34,"./src/dataflow/changeset":36,"./src/parse/":48,"./src/scene/Builder":74,"./src/scene/GroupBuilder":76,"./src/transforms/":103,"./src/util/config":107,"./src/util/schema":110,datalib:20}],2:[function(e,t,n){},{}],3:[function(e,t,n){function r(){if(!o){o=!0;for(var e,t=s.length;t;){e=s,s=[];for(var n=-1;++n<t;)e[n]();t=s.length}o=!1}}function i(){}var a=t.exports={},s=[],o=!1;a.nextTick=function(e){s.push(e),o||setTimeout(r,0)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=i,a.addListener=i,a.once=i,a.off=i,a.removeListener=i,a.removeAllListeners=i,a.emit=i,a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},{}],4:[function(e,t,n){function r(){this._cells={},this._aggr=[],this._stream=!1}function i(e){if(a.isArray(e))return e;if(null==e)return[];var t,n,r=[];for(t in e)n=a.array(e[t]),r.push({name:t,ops:n});return r}var a=e("../util"),s=e("./measures"),o=e("./collector"),l=r.Flags={ADD_CELL:1,MOD_CELL:2},u=r.prototype;u.stream=function(e){return null==e?this._stream:(this._stream=!!e,this._aggr=[],this)},u.key=function(e){return null==e?this._key:(this._key=a.$(e),this)},u.groupby=function(e){return this._dims=a.array(e).map(function(e,t){if(e=a.isString(e)?{name:e,get:a.$(e)}:a.isFunction(e)?{name:a.name(e)||e.name||"_"+t,get:e}:e.name&&a.isFunction(e.get)?e:null,null==e)throw"Invalid groupby argument: "+e;return e}),this.clear()},u.summarize=function(e){e=i(e),this._count=!0;var t,n,r,o,l,u,d,c=this._aggr=[];for(r=0;r<e.length;++r){for(o=0,t=[],n=e[r];o<n.ops.length;++o)l=n.ops[o],"count"!==l&&(this._count=!1),u=n.as&&n.as[o]||l+("*"===n.name?"":"_"+n.name),t.push(s[l](u));d=n.get&&a.$(n.get)||("*"===n.name?a.identity:a.$(n.name)),c.push({name:n.name,measures:s.create(t,this._stream,d,this._assign)})}return this.clear()},u.count=function(){return this.summarize({"*":"count"})},u._assign=function(e,t,n){e[t]=n},u.clear=function(){return this._cells={},this},u._cellkey=function(e){var t,n=this._dims,r=n.length,i=String(n[0].get(e));for(t=1;r>t;++t)i+="|"+n[t].get(e);return i},u._cell=function(e){var t=this._dims.length?this._cellkey(e):"";return this._cells[t]||(this._cells[t]=this._newcell(e))},u._newcell=function(e){var t,n={num:0,tuple:this._newtuple(e),flag:l.ADD_CELL,aggs:{}},r=this._aggr;for(t=0;t<r.length;++t)n.aggs[r[t].name]=new r[t].measures(n,n.tuple);return n.collect&&(n.data=new o(this._key)),n},u._newtuple=function(e){var t,n,r=this._dims,i={};for(t=0,n=r.length;n>t;++t)i[r[t].name]=r[t].get(e);return this._ingest(i)},u._ingest=a.identity,u._add=function(e){var t,n=this._cell(e),r=this._aggr;if(n.num+=1,!this._count)for(n.collect&&n.data.add(e),t=0;t<r.length;++t)n.aggs[r[t].name].add(e);n.flag|=l.MOD_CELL},u._rem=function(e){var t,n=this._cell(e),r=this._aggr;if(n.num-=1,!this._count)for(n.collect&&n.data.rem(e),t=0;t<r.length;++t)n.aggs[r[t].name].rem(e);n.flag|=l.MOD_CELL},u._mod=function(e,t){var n,r=this._cell(t),i=this._cell(e),s=this._aggr;for(r!==i?(r.num-=1,i.num+=1,r.collect&&r.data.rem(t),i.collect&&i.data.add(e)):r.collect&&!a.isObject(e)&&(r.data.rem(t),r.data.add(e)),n=0;n<s.length;++n)r.aggs[s[n].name].rem(t),i.aggs[s[n].name].add(e);r.flag|=l.MOD_CELL,i.flag|=l.MOD_CELL},u.result=function(){var e,t,n,r=[],i=this._aggr;for(n in this._cells){if(e=this._cells[n],e.num>0){for(e.collect&&e.data.values(),t=0;t<i.length;++t)e.aggs[i[t].name].set();r.push(e.tuple)}else delete this._cells[n];e.flag=0}return this._rems=!1,r},u.changes=function(){var e,t,n,r,i={add:[],rem:[],mod:[]},a=this._aggr;for(r in this._cells){for(e=this._cells[r],t=e.flag,e.collect&&e.data.values(),n=0;n<a.length;++n)e.aggs[a[n].name].set();e.num<=0?(i.rem.push(e.tuple),delete this._cells[r]):t&l.ADD_CELL?i.add.push(e.tuple):t&l.MOD_CELL&&i.mod.push(e.tuple),e.flag=0}return this._rems=!1,i},u.execute=function(e){return this.clear().insert(e).result()},u.insert=function(e){this._consolidate();for(var t=0;t<e.length;++t)this._add(e[t]);return this},u.remove=function(e){if(!this._stream)throw"Aggregator not configured for streaming removes. Call stream(true) prior to calling summarize.";for(var t=0;t<e.length;++t)this._rem(e[t]);return this._rems=!0,this},u._consolidate=function(){if(this._rems){for(var e in this._cells)this._cells[e].collect&&this._cells[e].data.values();this._rems=!1}},t.exports=r},{"../util":25,"./collector":5,"./measures":7}],5:[function(e,t,n){function r(e){this._add=[],this._rem=[],this._key=e||null,this._last=null}var i=e("../util"),a=e("../stats"),s="__dl_rem__",o=r.prototype;o.add=function(e){this._add.push(e)},o.rem=function(e){this._rem.push(e)},o.values=function(){if(this._get=null,0===this._rem.length)return this._add;var e,t,n,r,o=this._add,l=this._rem,u=this._key,d=Array(o.length-l.length);if(i.isObject(l[0]))if(u)for(r=i.toMap(l,u),e=0,t=0,n=o.length;n>e;++e)r.hasOwnProperty(u(o[e]))||(d[t++]=o[e]);else{for(e=0,n=l.length;n>e;++e)l[e][s]=1;for(e=0,t=0,n=o.length;n>e;++e)o[e][s]||(d[t++]=o[e]);for(e=0,n=l.length;n>e;++e)delete l[e][s]}else for(r=a.count.map(l),e=0,t=0,n=o.length;n>e;++e)r[o[e]]>0?r[o[e]]-=1:d[t++]=o[e];return this._rem=[],this._add=d},o.extent=function(e){if(this._get!==e||!this._ext){var t=this.values(),n=a.extent.index(t,e);this._ext=[t[n[0]],t[n[1]]],this._get=e}return this._ext},o.argmin=function(e){return this.extent(e)[0]},o.argmax=function(e){return this.extent(e)[1]},o.min=function(e){var t=this.extent(e)[0];return t?e(t):+(1/0)},o.max=function(e){var t=this.extent(e)[1];return t?e(t):-(1/0)},o.quartile=function(e){return this._get===e&&this._q||(this._q=a.quartile(this.values(),e),this._get=e),this._q},o.q1=function(e){return this.quartile(e)[0]},o.q2=function(e){return this.quartile(e)[1]},o.q3=function(e){return this.quartile(e)[2]},t.exports=r},{"../stats":22,"../util":25}],6:[function(e,t,n){var r=e("../util"),i=e("./aggregator");t.exports=function(){var e=[].reduce.call(arguments,function(e,t){return e.concat(r.array(t))},[]);return(new i).groupby(e).summarize({"*":"values"})}},{"../util":25,"./aggregator":4}],7:[function(e,t,n){function r(e){return function(t){var n=s.extend({init:"",add:"",rem:"",idx:0},e);return n.out=t||e.name,n}}function i(e,t){function n(e,r){function i(t){e[t]||n(e,e[t]=o[t]())}return r.req&&r.req.forEach(i),t&&r.str&&r.str.forEach(i),e}var r=e.reduce(n,e.reduce(function(e,t){return e[t.name]=t,e},{}));return s.vals(r).sort(function(e,t){return e.idx-t.idx})}function a(t,n,r,a){var o=i(t,n),l="this.cell = cell; this.tuple = t; this.valid = 0; this.missing = 0;",u="if (v==null) this.missing++; if (!this.isValid(v)) return; ++this.valid;",d="if (v==null) this.missing--; if (!this.isValid(v)) return; --this.valid;",c="var t = this.tuple; var cell = this.cell;";return o.forEach(function(e){e.idx<0?(l=e.init+l,u=e.add+u,d=e.rem+d):(l+=e.init,u+=e.add,d+=e.rem)}),t.slice().sort(function(e,t){return e.idx-t.idx}).forEach(function(e){c+="this.assign(t,'"+e.out+"',"+e.set+");"}),c+="return t;",l=Function("cell","t",l),l.prototype.assign=a,l.prototype.add=Function("t","var v = this.get(t);"+u),l.prototype.rem=Function("t","var v = this.get(t);"+d),l.prototype.set=Function(c),l.prototype.get=r,l.prototype.distinct=e("../stats").count.distinct,l.prototype.isValid=s.isValid,l}var s=e("../util"),o={values:r({name:"values",init:"cell.collect = true;",set:"cell.data.values()",idx:-1}),count:r({name:"count",set:"cell.num"}),missing:r({name:"missing",set:"this.missing"}),valid:r({name:"valid",set:"this.valid"}),sum:r({name:"sum",init:"this.sum = 0;",add:"this.sum += v;",rem:"this.sum -= v;",set:"this.sum"}),mean:r({name:"mean",init:"this.mean = 0;",add:"var d = v - this.mean; this.mean += d / this.valid;",rem:"var d = v - this.mean; this.mean -= this.valid ? d / this.valid : this.mean;",set:"this.mean"}),average:r({name:"average",set:"this.mean",req:["mean"],idx:1}),variance:r({name:"variance",init:"this.dev = 0;",add:"this.dev += d * (v - this.mean);",rem:"this.dev -= d * (v - this.mean);",set:"this.valid > 1 ? this.dev / (this.valid-1) : 0",req:["mean"],idx:1}),variancep:r({name:"variancep",set:"this.valid > 1 ? this.dev / this.valid : 0",req:["variance"],idx:2}),stdev:r({name:"stdev",set:"this.valid > 1 ? Math.sqrt(this.dev / (this.valid-1)) : 0",req:["variance"],idx:2}),stdevp:r({name:"stdevp",set:"this.valid > 1 ? Math.sqrt(this.dev / this.valid) : 0",req:["variance"],idx:2}),median:r({name:"median",set:"cell.data.q2(this.get)",req:["values"],idx:3}),q1:r({name:"q1",set:"cell.data.q1(this.get)",req:["values"],idx:3}),q3:r({name:"q3",set:"cell.data.q3(this.get)",req:["values"],idx:3}),distinct:r({name:"distinct",set:"this.distinct(cell.data.values(), this.get)",req:["values"],idx:3}),argmin:r({name:"argmin",add:"if (v < this.min) this.argmin = t;",rem:"if (v <= this.min) this.argmin = null;",set:"this.argmin = this.argmin || cell.data.argmin(this.get)",req:["min"],str:["values"],idx:3}),argmax:r({name:"argmax",add:"if (v > this.max) this.argmax = t;",rem:"if (v >= this.max) this.argmax = null;",set:"this.argmax = this.argmax || cell.data.argmax(this.get)",req:["max"],str:["values"],idx:3}),min:r({name:"min",init:"this.min = +Infinity;",add:"if (v < this.min) this.min = v;",rem:"if (v <= this.min) this.min = NaN;",set:"this.min = (isNaN(this.min) ? cell.data.min(this.get) : this.min)",str:["values"],idx:4}),max:r({name:"max",init:"this.max = -Infinity;",add:"if (v > this.max) this.max = v;",rem:"if (v >= this.max) this.max = NaN;",set:"this.max = (isNaN(this.max) ? cell.data.max(this.get) : this.max)",str:["values"],idx:4}),modeskew:r({name:"modeskew",set:"this.dev===0 ? 0 : (this.mean - cell.data.q2(this.get)) / Math.sqrt(this.dev/(this.valid-1))",req:["mean","stdev","median"],idx:5})};o.create=a,t.exports=o},{"../stats":22,"../util":25}],8:[function(e,t,n){function r(e){if(!e)throw Error("Missing binning options.");var t,n,r,o,l,u,d,c=e.maxbins||15,f=e.base||10,h=Math.log(f),p=e.div||[5,2],m=e.min,g=e.max,y=g-m;if(e.step)t=e.step;else if(e.steps)t=e.steps[Math.min(e.steps.length-1,i(e.steps,y/c,0,e.steps.length))];else{n=Math.ceil(Math.log(c)/h),r=e.minstep||0,t=Math.max(r,Math.pow(f,Math.round(Math.log(y)/h)-n));do t*=f;while(Math.ceil(y/t)>c);for(u=0;u<p.length;++u)l=t/p[u],l>=r&&c>=y/l&&(t=l)}return l=Math.log(t),o=l>=0?0:~~(-l/h)+1,d=Math.pow(f,-o-1),m=Math.min(m,Math.floor(m/t+d)*t),g=Math.ceil(g/t)*t,{start:m,stop:g,step:t,unit:{precision:o},value:a,index:s}}function i(e,t,n,r){for(;r>n;){var i=n+r>>>1;u.cmp(e[i],t)<0?n=i+1:r=i}return n}function a(e){return this.step*Math.floor(e/this.step+c)}function s(e){return Math.floor((e-this.start)/this.step+c)}function o(e){return this.unit.date(a.call(this,e))}function l(e){return s.call(this,this.unit.unit(e))}var u=e("../util"),d=e("../time-units"),c=1e-15;r.date=function(e){if(!e)throw Error("Missing date binning options.");var t=e.min,n=e.max,i=e.maxbins||20,a=e.minbins||4,s=+n-+t,u=e.unit?d[e.unit]:d.find(s,a,i),c=r({min:null!=u.min?u.min:u.unit(t),max:null!=u.max?u.max:u.unit(n),maxbins:i,minstep:u.minstep,steps:u.step});return c.unit=u,c.index=l,e.raw||(c.value=o),c},t.exports=r},{"../time-units":24,"../util":25}],9:[function(e,t,n){function r(e,t,n){n=s(e,t,n);var r=a(n);return r?c.$func("bin",r.unit.unit?function(e){return r.value(r.unit.unit(e))}:function(e){return r.value(e)})(n.accessor):n.accessor||c.identity}function i(e,t,n){n=s(e,t,n);var r=a(n);return r?o(e,n.accessor,r):l(e,n.accessor,n&&n.sort)}function a(e){var t=e.type,n=null;return(null==t||p[t])&&("integer"===t&&null==e.minstep&&(e.minstep=1),n="date"===t?h.date(e):h(e)),n}function s(){var e=arguments,t=0,n=c.isArray(e[t])?e[t++]:null,r=c.isFunction(e[t])||c.isString(e[t])?c.$(e[t++]):null,i=c.extend({},e[t]);if(n&&(i.type=i.type||d(n,r),p[i.type])){var a=u.extent(n,r);i=c.extend({min:a[0],max:a[1]},i)}return r&&(i.accessor=r),i}function o(e,t,n){for(var r,i,a=f.range(n.start,n.stop+n.step/2,n.step).map(function(e){return{value:n.value(e),count:0}}),s=0;s<e.length;++s)if(r=t?t(e[s]):e[s],c.isValid(r)){if(i=n.index(r),0>i||i>=a.length||!isFinite(i))continue;a[i].count+=1}return a.bins=n,a}function l(e,t,n){var r=u.unique(e,t),i=u.count.map(e,t);return r.map(function(e){return{value:e,count:i[e]}}).sort(c.comparator(n?"-count":"+value"))}var u=e("../stats"),d=e("../import/type"),c=e("../util"),f=e("../generate"),h=e("./bins"),p={integer:1,number:1,date:1};t.exports={$bin:r,histogram:i}},{"../generate":10,"../import/type":19,"../stats":22,"../util":25,"./bins":8}],10:[function(e,t,n){var r=t.exports={};r.repeat=function(e,t){var n,r=Array(t);for(n=0;t>n;++n)r[n]=e;return r},r.zeros=function(e){return r.repeat(0,e)},r.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("Infinite range");var r,i=[],a=-1;if(0>n)for(;(r=e+n*++a)>t;)i.push(r);else for(;(r=e+n*++a)<t;)i.push(r);return i},r.random={},r.random.uniform=function(e,t){void 0===t&&(t=void 0===e?1:e,e=0);var n=t-e,i=function(){return e+n*Math.random()};return i.samples=function(e){return r.zeros(e).map(i)},i},r.random.integer=function(e,t){void 0===t&&(t=e,e=0);var n=t-e,i=function(){return e+Math.floor(n*Math.random())};return i.samples=function(e){return r.zeros(e).map(i)},i},r.random.normal=function(e,t){e=e||0,t=t||1;var n,i=function(){var r,i,a=0,s=0;if(void 0!==n)return a=n,n=void 0,a;do a=2*Math.random()-1,s=2*Math.random()-1,r=a*a+s*s;while(0===r||r>1);return i=Math.sqrt(-2*Math.log(r)/r),n=e+s*i*t,e+a*i*t};return i.samples=function(e){return r.zeros(e).map(i)},i}},{}],11:[function(e,t,n){(function(n){function r(e,t){if(e){var n=t.header;e=(n?n.join(t.delimiter)+"\n":"")+e}return a.dsv(t.delimiter).parse(e)}var i=e("../../util"),a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null;r.delimiter=function(e){var t={delimiter:e};return function(e,n){return r(e,n?i.extend(n,t):t)}},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util":25}],12:[function(e,t,n){var r=e("./dsv");t.exports={json:e("./json"),topojson:e("./topojson"),treejson:e("./treejson"),dsv:r,csv:r.delimiter(","),tsv:r.delimiter("	")}},{"./dsv":11,"./json":13,"./topojson":14,"./treejson":15}],13:[function(e,t,n){var r=e("../../util");t.exports=function(e,t){var n=r.isObject(e)&&!r.isBuffer(e)?e:JSON.parse(e);return t&&t.property&&(n=r.accessor(t.property)(n)),n}},{"../../util":25}],14:[function(e,t,n){(function(n){var r=e("./json"),i=function(e,t){var n=i.topojson;if(null==n)throw Error("TopoJSON library not loaded.");var a,s=r(e,t);if(t&&t.feature){if(a=s.objects[t.feature])return n.feature(s,a).features;throw Error("Invalid TopoJSON object: "+t.feature)}if(t&&t.mesh){if(a=s.objects[t.mesh])return[n.mesh(s,s.objects[t.mesh])];throw Error("Invalid TopoJSON object: "+t.mesh)}throw Error("Missing TopoJSON feature or mesh parameter.")};i.topojson="undefined"!=typeof window?window.topojson:"undefined"!=typeof n?n.topojson:null,t.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./json":13}],15:[function(e,t,n){function r(e,t){function n(e){r.push(e);var i=e[t];if(i)for(var a=0;a<i.length;++a)n(i[a],e)}t=t||"children";var r=[];return n(e,null),r.root=e,r}var i=e("./json");t.exports=function(e,t){return e=i(e,t),r(e,t&&t.children)}},{"./json":13}],16:[function(e,t,n){function r(t){var n=t.url;if(!n&&t.file)return c+t.file;if(t.baseURL&&!d.test(n)&&(u.startsWith(n,"/")||"/"===t.baseURL[t.baseURL.length-1]||(n="/"+n),n=t.baseURL+n),u.isNode&&u.startsWith(n,"//")&&(n=(t.defaultProtocol||"http")+":"+n),t.domainWhiteList){var r,i;if(u.isNode){var a=e("url").parse(n);r=a.hostname,i=null}else{var s=document.createElement("a");s.href=n,""===s.host&&(s.href=s.href),r=s.hostname.toLowerCase(),i=window.location.hostname}if(i!==r){var o=t.domainWhiteList.some(function(e){var t=r.length-e.length;return e===r||t>1&&"."===r[t-1]&&r.lastIndexOf(e)===t});if(!o)throw"URL is not whitelisted: "+n}}return n}function i(e,t){var n,r=t||function(e){throw e};try{n=i.sanitizeUrl(e)}catch(a){return void r(a)}return n?u.isNode?u.startsWith(n,c)?o(n.slice(c.length),t):n.indexOf("://")<0?o(n,t):l(n,t):s(n,t):void r("Invalid URL: "+n)}function a(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText}function s(e,t){function n(){var e=i.status;!e&&a(i)||e>=200&&300>e||304===e?t(null,i.responseText):t(i,null)}var r=!!t,i=new XMLHttpRequest;return!this.XDomainRequest||"withCredentials"in i||!/^(http(s)?:)?\/\//.test(e)||(i=new XDomainRequest),r&&("onload"in i?i.onload=i.onerror=n:i.onreadystatechange=function(){i.readyState>3&&n()}),i.open("GET",e,r),i.send(),!r&&a(i)?i.responseText:void 0}function o(t,n){var r=e("fs");return n?void e("fs").readFile(t,n):r.readFileSync(t,"utf8")}function l(t,n){return n?void e("request")(t,function(e,t,r){e||200!==t.statusCode?(e=e||"Load failed with response code "+t.statusCode+".",n(e,null)):n(null,r)}):e("sync-request")("GET",t).getBody()}var u=e("../util"),d=/^([A-Za-z]+:)?\/\//,c="file://";i.sanitizeUrl=r,t.exports=i},{"../util":25,fs:2,request:2,"sync-request":2,url:2}],17:[function(e,t,n){function r(e,t){var n=t&&t.type||"json";return e=o[n](e,t),t&&t.parse&&i(e,t.parse),e}function i(e,t){var n,r,i,o,l,u,d=e.length;for(t="auto"===t?s.inferAll(e):a.duplicate(t),n=a.keys(t),r=n.map(function(e){return s.parsers[t[e]]}),o=0,u=n.length;d>o;++o)for(i=e[o],l=0;u>l;++l)i[n[l]]=r[l](i[n[l]]);s.annotation(e,t)}var a=e("../util"),s=e("./type"),o=e("./formats");r.formats=o,t.exports=r},{"../util":25,"./formats":12,"./type":19}],18:[function(e,t,n){var r=e("../util"),i=e("./load"),a=e("./read");t.exports=r.keys(a.formats).reduce(function(e,t){return e[t]=function(e,n,s){r.isString(e)&&(e={url:e}),2===arguments.length&&r.isFunction(n)&&(s=n,n=void 0),n=r.extend({parse:"auto"},n),n.type=t;var o=i(e,s?function(e,t){if(e)return void s(e,null);try{t=a(t,n)}catch(r){s(r,null)}s(null,t)}:void 0);return o?a(o,n):void 0},e},{})},{"../util":25,"./load":16,"./read":17}],19:[function(e,t,n){function r(e,t){return t?void(e[u]=t):e&&e[u]||null}function i(e,t){t=l.$(t);var n,r,i;if(e[u]&&(n=t(e[u]),l.isString(n)))return n;for(r=0,i=e.length;!l.isValid(n)&&i>r;++r)n=t?t(e[r]):e[r];return l.isDate(n)?"date":l.isNumber(n)?"number":l.isBoolean(n)?"boolean":l.isString(n)?"string":null}function a(e,t){return e.length?(t=t||l.keys(e[0]),t.reduce(function(t,n){return t[n]=i(e,n),t},{})):void 0}function s(e,t){t=l.$(t);var n,r,i,a=["boolean","integer","number","date"];for(n=0;n<e.length;++n){for(i=t?t(e[n]):e[n],r=0;r<a.length;++r)l.isValid(i)&&!c[a[r]](i)&&(a.splice(r,1),r-=1);if(0===a.length)return"string"}return a[0]}function o(e,t){return t=t||l.keys(e[0]),t.reduce(function(t,n){return t[n]=s(e,n),t},{})}var l=e("../util"),u="__types__",d={"boolean":l["boolean"],integer:l.number,number:l.number,date:l.date,string:function(e){return""===e?null:e}},c={"boolean":function(e){return"true"===e||"false"===e||l.isBoolean(e)},integer:function(e){return c.number(e)&&(e=+e)===~~e},number:function(e){return!isNaN(+e)&&!l.isDate(e)},date:function(e){return!isNaN(Date.parse(e))}};i.annotation=r,i.all=a,i.infer=s,i.inferAll=o,i.parsers=d,t.exports=i},{"../util":25}],20:[function(e,t,n){var r=e("./util"),i={load:e("./import/load"),read:e("./import/read"),type:e("./import/type"),bins:e("./bins/bins"),$bin:e("./bins/histogram").$bin,groupby:e("./aggregate/groupby"),histogram:e("./bins/histogram").histogram,print:e("./print"),template:e("./template"),timeunits:e("./time-units")};r.extend(i,r),r.extend(i,e("./generate")),r.extend(i,e("./stats")),r.extend(i,e("./import/readers")),t.exports=i},{"./aggregate/groupby":6,"./bins/bins":8,"./bins/histogram":9,"./generate":10,"./import/load":16,"./import/read":17,"./import/readers":18,"./import/type":19,"./print":21,"./stats":22,"./template":23,"./time-units":24,"./util":25}],21:[function(e,t,n){function r(e){return["valid:    "+e.valid,"missing:  "+e.missing,"distinct: "+e.distinct,"min:      "+e.min,"max:      "+e.max,"median:   "+e.median,"mean:     "+e.mean,"stdev:    "+e.stdev,"modeskew: "+e.modeskew].join("\n")}function i(e){var t=["valid:    "+e.valid,"missing:  "+e.missing,"distinct: "+e.distinct,"top values: "],n=e.unique,r=a.keys(n).sort(function(e,t){return n[t]-n[e]}).slice(0,6).map(function(e){return" '"+e+"' ("+n[e]+")"});return t.concat(r).join("\n")}var a=e("./util"),s=e("./import/type"),o=e("./stats"),l=e("./template"),u={date:'|time:"%m/%d/%Y %H:%M:%S"',number:'|number:".4f"',integer:'|number:"d"'},d={number:"left",integer:"left"};t.exports.table=function(e,t){t=a.extend({separator:" ",minwidth:8,maxwidth:15},t);var n=t.fields||a.keys(e[0]),r=s.all(e);if(t.start||t.limit){var i=t.start||0,c=t.limit?i+t.limit:e.length;e=e.slice(i,c)}var f=n.map(function(n){var i=u[r[n]]||"",a=l("{{"+n+i+"}}"),s=o.max(e,function(e){return a(e).length});return s=Math.max(Math.min(n.length,t.minwidth),s),t.maxwidth>0?Math.min(s,t.maxwidth):s}),h=n.map(function(e,t){return a.truncate(a.pad(e,f[t],"center"),f[t])}).join(t.separator),p=l(n.map(function(e,t){return"{{"+e+(u[r[e]]||"")+("|pad:"+f[t]+","+(d[r[e]]||"right"))+("|truncate:"+f[t])+"}}"}).join(t.separator));return h+"\n"+e.map(p).join("\n")},t.exports.summary=function(e){e=e?e.__summary__?e:o.summary(e):this;var t,n,a=[];for(t=0,n=e.length;n>t;++t)a.push("-- "+e[t].field+" --"),a.push("string"===e[t].type||e[t].distinct<10?i(e[t]):r(e[t])),a.push("");return a.join("\n")}},{"./import/type":19,"./stats":22,"./template":23,"./util":25}],22:[function(e,t,n){var r=e("./util"),i=e("./import/type"),a=e("./generate"),s={};s.unique=function(e,t,n){t=r.$(t),n=n||[];var i,a,s,o={};for(a=0,s=e.length;s>a;++a)i=t?t(e[a]):e[a],i in o||(o[i]=1,n.push(i));return n},s.count=function(e){return e&&e.length||0},s.count.valid=function(e,t){t=r.$(t);var n,i,a,s=0;for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],r.isValid(n)&&(s+=1);return s},s.count.missing=function(e,t){t=r.$(t);var n,i,a,s=0;for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],null==n&&(s+=1);return s},s.count.distinct=function(e,t){t=r.$(t);var n,i,a,s={},o=0;for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],n in s||(s[n]=1,o+=1);return o},s.count.map=function(e,t){t=r.$(t);var n,i,a,s={};for(i=0,a=e.length;a>i;++i)n=t?t(e[i]):e[i],s[n]=n in s?s[n]+1:1;return s},s.median=function(e,t){return t&&(e=e.map(r.$(t))),e=e.filter(r.isValid).sort(r.cmp),s.quantile(e,.5)},s.quartile=function(e,t){t&&(e=e.map(r.$(t))),e=e.filter(r.isValid).sort(r.cmp);var n=s.quantile;return[n(e,.25),n(e,.5),n(e,.75)]},s.quantile=function(e,t,n){void 0===n&&(n=t,t=r.identity),t=r.$(t);var i=(e.length-1)*n+1,a=Math.floor(i),s=+t(e[a-1]),o=i-a;return o?s+o*(t(e[a])-s):s},s.sum=function(e,t){t=r.$(t);for(var n,i=0,a=0,s=e.length;s>a;++a)n=t?t(e[a]):e[a],r.isValid(n)&&(i+=n);return i},s.mean=function(e,t){t=r.$(t);var n,i,a,s,o,l=0;for(i=0,s=0,a=e.length;a>i;++i)o=t?t(e[i]):e[i],r.isValid(o)&&(n=o-l,l+=n/++s);return l},s.variance=function(e,t){if(t=r.$(t),!r.isArray(e)||e.length<2)return 0;var n,i,a,s,o=0,l=0;for(i=0,a=0;i<e.length;++i)s=t?t(e[i]):e[i],r.isValid(s)&&(n=s-o,o+=n/++a,l+=n*(s-o));return l/=a-1},s.stdev=function(e,t){return Math.sqrt(s.variance(e,t))},s.modeskew=function(e,t){var n=s.mean(e,t),r=s.median(e,t),i=s.stdev(e,t);return 0===i?0:(n-r)/i},s.min=function(e,t){return s.extent(e,t)[0]},s.max=function(e,t){return s.extent(e,t)[1]},s.extent=function(e,t){t=r.$(t);var n,i,a,s,o=e.length;for(s=0;o>s;++s)if(a=t?t(e[s]):e[s],r.isValid(a)){n=i=a;break}for(;o>s;++s)a=t?t(e[s]):e[s],r.isValid(a)&&(n>a&&(n=a),a>i&&(i=a));return[n,i]},s.extent.index=function(e,t){t=r.$(t);var n,i,a,s,o=-1,l=-1,u=e.length;for(s=0;u>s;++s)if(a=t?t(e[s]):e[s],r.isValid(a)){n=i=a,o=l=s;break}for(;u>s;++s)a=t?t(e[s]):e[s],r.isValid(a)&&(n>a&&(n=a,o=s),a>i&&(i=a,l=s));return[o,l]},s.dot=function(e,t,n){var i,a,s=0;if(n)for(t=r.$(t),n=r.$(n),i=0;i<e.length;++i)a=t(e[i])*n(e[i]),a===a&&(s+=a);else{if(e.length!==t.length)throw Error("Array lengths must match.");for(i=0;i<e.length;++i)a=e[i]*t[i],a===a&&(s+=a)}return s},s.rank=function(e,t){t=r.$(t)||r.identity;var n,i,a,s=e.map(function(e,n){return{idx:n,val:t(e)}}).sort(r.comparator("val")),o=e.length,l=Array(o),u=-1,d={};for(n=0;o>n;++n){if(i=s[n].val,0>u&&d===i)u=n-1;else if(u>-1&&d!==i){for(a=1+(n-1+u)/2;n>u;++u)l[s[u].idx]=a;u=-1}l[s[n].idx]=n+1,d=i}if(u>-1)for(a=1+(o-1+u)/2;o>u;++u)l[s[u].idx]=a;return l},s.cor=function(e,t,n){var i=n;n=i?e.map(r.$(n)):t,t=i?e.map(r.$(t)):e;var a=s.dot(t,n),o=s.mean(t),l=s.mean(n),u=s.stdev(t),d=s.stdev(n),c=e.length;return(a-c*o*l)/((c-1)*u*d)},s.cor.rank=function(e,t,n){var i,a,o,l=n?s.rank(e,r.$(t)):s.rank(e),u=n?s.rank(e,r.$(n)):s.rank(t),d=e.length;for(i=0,a=0;d>i;++i)o=l[i]-u[i],a+=o*o;return 1-6*a/(d*(d*d-1))},s.cor.dist=function(e,t,n){var i,a,o,l,u=n?e.map(r.$(t)):e,d=n?e.map(r.$(n)):t,c=s.dist.mat(u),f=s.dist.mat(d),h=c.length;for(i=0,a=0,o=0,l=0;h>i;++i)a+=c[i]*c[i],o+=f[i]*f[i],l+=c[i]*f[i];return Math.sqrt(l/Math.sqrt(a*o))},s.dist=function(e,t,n,i){var a,s,o=r.isFunction(n)||r.isString(n),l=e,u=o?e:t,d=o?i:n,c=2===d||null==d,f=e.length,h=0;for(o&&(t=r.$(t),n=r.$(n)),s=0;f>s;++s)a=o?t(l[s])-n(u[s]):l[s]-u[s],h+=c?a*a:Math.pow(Math.abs(a),d);return c?Math.sqrt(h):Math.pow(h,1/d)},s.dist.mat=function(e){var t,n,r,i=e.length,s=i*i,o=Array(s),l=a.zeros(i),u=0;for(n=0;i>n;++n)for(o[n*i+n]=0,r=n+1;i>r;++r)o[n*i+r]=t=Math.abs(e[n]-e[r]),o[r*i+n]=t,l[n]+=t,l[r]+=t;for(n=0;i>n;++n)u+=l[n],l[n]/=i;for(u/=s,n=0;i>n;++n)for(r=n;i>r;++r)o[n*i+r]+=u-l[n]-l[r],o[r*i+n]=o[n*i+r];return o},s.entropy=function(e,t){t=r.$(t);var n,i,a=0,s=0,o=e.length;for(n=0;o>n;++n)a+=t?t(e[n]):e[n];if(0===a)return 0;for(n=0;o>n;++n)i=(t?t(e[n]):e[n])/a,i&&(s+=i*Math.log(i));return-s/Math.LN2},s.mutual=function(e,t,n,i){var a,s,o,l=i?e.map(r.$(t)):e,u=i?e.map(r.$(n)):t,d=i?e.map(r.$(i)):n,c={},f={},h=d.length,p=0,m=0,g=0;for(o=0;h>o;++o)c[l[o]]=0,f[u[o]]=0;for(o=0;h>o;++o)c[l[o]]+=d[o],f[u[o]]+=d[o],p+=d[o];for(s=1/(p*Math.LN2),o=0;h>o;++o)0!==d[o]&&(a=p*d[o]/(c[l[o]]*f[u[o]]),m+=d[o]*s*Math.log(a),g+=d[o]*s*Math.log(d[o]/p));return[m,1+m/g]},s.mutual.info=function(e,t,n,r){return s.mutual(e,t,n,r)[0]},s.mutual.dist=function(e,t,n,r){return s.mutual(e,t,n,r)[1]},s.profile=function(e,t){var n,a,o,l,u,d=0,c=0,f=0,h=0,p=null,m=null,g=0,y=[],v={};for(o=0;o<e.length;++o)l=t?t(e[o]):e[o],v[l]=l in v?v[l]+1:(h+=1,1),null==l?++f:r.isValid(l)&&(u="string"==typeof l?l.length:l,(null===p||p>u)&&(p=u),(null===m||u>m)&&(m=u),n=u-d,d+=n/++c,g+=n*(u-d),y.push(u));return g/=c-1,a=Math.sqrt(g),y.sort(r.cmp),{type:i(e,t),unique:v,count:e.length,valid:c,missing:f,distinct:h,min:p,max:m,mean:d,stdev:a,median:l=s.quantile(y,.5),q1:s.quantile(y,.25),q3:s.quantile(y,.75),modeskew:0===a?0:(d-l)/a}},s.summary=function(e,t){t=t||r.keys(e[0]);var n=t.map(function(t){var n=s.profile(e,r.$(t));return n.field=t,n});return n.__summary__=!0,n},t.exports=s},{"./generate":10,"./import/type":19,"./util":25}],23:[function(e,t,n){(function(n){function r(e){var t=i(e,"d");return t="var __t; return "+t+";",new Function("d",t).bind(d)}function i(e,t,n){t=t||"obj";var r=0,i="'",o=c;return e.replace(o,function(o,l,u){return i+=e.slice(r,u).replace(h,s),r=u+o.length,l&&(i+="'\n+((__t=("+a(l,t,n)+"))==null?'':__t)+\n'"),o}),i+"'"}function a(e,t,n){function r(e){return e=e||"",d?(d=!1,c="String("+c+")"+e):c+=e,c}function i(){return"(typeof "+c+'==="number"?new Date('+c+"):"+c+")"}var a=e.split("|"),s=a.shift().trim(),d=!0;n&&(n[s]=1);var c=l.field(s).map(l.str).join("][");c=t+"["+c+"]";for(var f=0;f<a.length;++f){var h,p,m,g=a[f],y=null;switch((h=g.indexOf(":"))>0&&(g=g.slice(0,h),y=a[f].slice(h+1).split(",").map(function(e){return e.trim()})),g=g.trim()){case"length":r(".length");break;case"lower":r(".toLowerCase()");break;case"upper":r(".toUpperCase()");break;case"lower-locale":r(".toLocaleLowerCase()");break;case"upper-locale":r(".toLocaleUpperCase()");break;case"trim":r(".trim()");break;case"left":p=l.number(y[0]),r(".slice(0,"+p+")");break;case"right":p=l.number(y[0]),r(".slice(-"+p+")");break;case"mid":p=l.number(y[0]),m=p+l.number(y[1]),r(".slice(+"+p+","+m+")");break;case"slice":p=l.number(y[0]),r(".slice("+p+(y.length>1?","+l.number(y[1]):"")+")");break;case"truncate":p=l.number(y[0]),m=y[1],m="left"!==m&&"middle"!==m&&"center"!==m?"right":m,c="this.truncate("+r()+","+p+",'"+m+"')";break;case"pad":p=l.number(y[0]),m=y[1],m="left"!==m&&"middle"!==m&&"center"!==m?"right":m,c="this.pad("+r()+","+p+",'"+m+"')";break;case"number":p=o(y[0],u.format),d=!1,c="this.formats["+p+"]("+c+")";break;case"time":p=o(y[0],u.time.format),d=!1,c="this.formats["+p+"]("+i()+")";break;default:throw Error("Unrecognized template filter: "+g)}}return c}function s(e){return"\\"+f[e]}function o(e,t){if(!("'"===e[0]&&"'"===e[e.length-1]||'"'===e[0]&&'"'===e[e.length-1]))throw Error("Format pattern must be quoted: "+e);if(e=e.slice(1,-1),!d.format_map[e]){var n=t(e),r=d.formats.length;d.formats.push(n),d.format_map[e]=r}return d.format_map[e]}var l=e("./util"),u="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,d={formats:[],format_map:{},truncate:l.truncate,pad:l.pad};r.source=i,r.context=d,t.exports=r,r.clearFormatCache=function(){d.formats=[],d.format_map={}};var c=/\{\{(.+?)\}\}|$/g,f={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},h=/\\|'|\r|\n|\u2028|\u2029/g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./util":25}],24:[function(e,t,n){function r(e){return"number"==typeof e}var i=[[31536e6,5],[7776e6,4],[2592e6,4],[12096e5,3],[6048e5,3],[1728e5,3],[864e5,3],[432e5,2],[216e5,2],[108e5,2],[36e5,2],[18e5,1],[9e5,1],[3e5,1],[6e4,1],[3e4,0],[15e3,0],[5e3,0],[1e3,0]],a=[{type:"second",minstep:1,format:"%Y %b %-d %H:%M:%S.%L",date:function(e){return new Date(1e3*e)},unit:function(e){return+e/1e3}},{type:"minute",minstep:1,format:"%Y %b %-d %H:%M",date:function(e){return new Date(6e4*e)},unit:function(e){return~~(+e/6e4)}},{type:"hour",minstep:1,format:"%Y %b %-d %H:00",date:function(e){return new Date(36e5*e)},unit:function(e){return~~(+e/36e5)}},{type:"day",minstep:1,step:[1,7],format:"%Y %b %-d",date:function(e){return new Date(864e5*e)},unit:function(e){return~~(+e/864e5)}},{type:"month",minstep:1,step:[1,3,6],format:"%b %Y",date:function(e){return new Date(Date.UTC(~~(e/12),e%12,1))},unit:function(e){return r(e)&&(e=new Date(e)),12*e.getUTCFullYear()+e.getUTCMonth()}},{type:"year",minstep:1,format:"%Y",date:function(e){return new Date(Date.UTC(e,0,1))},unit:function(e){return(r(e)?new Date(e):e).getUTCFullYear()}}],s={type:"minuteOfHour",min:0,
max:59,minstep:1,format:"%M",date:function(e){return new Date(Date.UTC(1970,0,1,0,e))},unit:function(e){return(r(e)?new Date(e):e).getUTCMinutes()}},o={type:"hourOfDay",min:0,max:23,minstep:1,format:"%H",date:function(e){return new Date(Date.UTC(1970,0,1,e))},unit:function(e){return(r(e)?new Date(e):e).getUTCHours()}},l={type:"dayOfWeek",min:0,max:6,step:[1],format:"%a",date:function(e){return new Date(Date.UTC(1970,0,4+e))},unit:function(e){return(r(e)?new Date(e):e).getUTCDay()}},u={type:"dayOfMonth",min:1,max:31,step:[1],format:"%-d",date:function(e){return new Date(Date.UTC(1970,0,e))},unit:function(e){return(r(e)?new Date(e):e).getUTCDate()}},d={type:"monthOfYear",min:0,max:11,step:[1],format:"%b",date:function(e){return new Date(Date.UTC(1970,e%12,1))},unit:function(e){return(r(e)?new Date(e):e).getUTCMonth()}},c={second:a[0],minute:a[1],hour:a[2],day:a[3],month:a[4],year:a[5],minuteOfHour:s,hourOfDay:o,dayOfWeek:l,dayOfMonth:u,monthOfYear:d,timesteps:a};c.find=function(e,t,n){var r,s,o,l=i[0];for(r=1,s=i.length;s>r;++r)if(l=i[r],e>l[0]){if(o=e/l[0],o>n)return a[i[r-1][1]];if(o>=t)return a[l[1]]}return a[i[i.length-1][1]]},t.exports=c},{}],25:[function(e,t,n){(function(n){function r(e){return e.replace(c,"$1\\'")}function i(e,t){var n,r="";for(n=0;e>n;++n)r+=t;return r}function a(e,t,n){var r=0,i=e.split(f);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,t>=r}).reverse():i.filter(function(e){return r+=e.length,t>=r}),e.length?e.join("").trim():i[0].slice(0,t)}var s=e("buffer"),o=e("./time-units"),l=t.exports={};l.isNode="undefined"!=typeof n&&"undefined"!=typeof n.stderr;var u="__name__";l.namedfunc=function(e,t){return t[u]=e,t},l.name=function(e){return null==e?null:e[u]},l.identity=function(e){return e},l["true"]=l.namedfunc("true",function(){return!0}),l["false"]=l.namedfunc("false",function(){return!1}),l.duplicate=function(e){return JSON.parse(JSON.stringify(e))},l.equal=function(e,t){return JSON.stringify(e)===JSON.stringify(t)},l.extend=function(e){for(var t,n,r=1,i=arguments.length;i>r;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},l.length=function(e){return null!=e&&null!=e.length?e.length:null},l.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},l.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},l.toMap=function(e,t){return(t=l.$(t))?e.reduce(function(e,n){return e[t(n)]=1,e},{}):e.reduce(function(e,t){return e[t]=1,e},{})},l.keystr=function(e){var t=e.length;if(!t)return"";for(var n=String(e[0]),r=1;t>r;++r)n+="|"+String(e[r]);return n};var d=Object.prototype.toString;l.isObject=function(e){return e===Object(e)},l.isFunction=function(e){return"[object Function]"===d.call(e)},l.isString=function(e){return"string"==typeof value||"[object String]"===d.call(e)},l.isArray=Array.isArray||function(e){return"[object Array]"===d.call(e)},l.isNumber=function(e){return"number"==typeof e||"[object Number]"===d.call(e)},l.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==d.call(e)},l.isDate=function(e){return"[object Date]"===d.call(e)},l.isValid=function(e){return null!=e&&e===e},l.isBuffer=s.Buffer&&s.Buffer.isBuffer||l["false"],l.number=function(e){return null==e||""===e?null:+e},l["boolean"]=function(e){return null==e||""===e?null:"false"===e?!1:!!e},l.date=function(e){return null==e||""===e?null:Date.parse(e)},l.array=function(e){return null!=e?l.isArray(e)?e:[e]:[]},l.str=function(e){return l.isArray(e)?"["+e.map(l.str)+"]":l.isObject(e)?JSON.stringify(e):l.isString(e)?"'"+r(e)+"'":e};var c=/(^|[^\\])'/g;l.field=function(e){return String(e).split("\\.").map(function(e){return e.split(".")}).reduce(function(e,t){return e.length&&(e[e.length-1]+="."+t.shift()),e.push.apply(e,t),e},[])},l.accessor=function(e){var t;return null==e||l.isFunction(e)?e:l.namedfunc(e,(t=l.field(e)).length>1?function(e){return t.reduce(function(e,t){return e[t]},e)}:function(t){return t[e]})},l.$=l.accessor,l.mutator=function(e){var t;return l.isString(e)&&(t=l.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},l.$func=function(e,t){return function(n){n=l.$(n)||l.identity;var r=e+(l.name(n)?"_"+l.name(n):"");return l.namedfunc(r,function(e){return t(n(e))})}},l.$valid=l.$func("valid",l.isValid),l.$length=l.$func("length",l.length),l.$year=l.$func("year",o.year.unit),l.$month=l.$func("month",o.monthOfYear.unit),l.$date=l.$func("date",o.dayOfMonth.unit),l.$day=l.$func("day",o.dayOfWeek.unit),l.$hour=l.$func("hour",o.hourOfDay.unit),l.$minute=l.$func("minute",o.minuteOfHour.unit),l.$in=function(e,t){e=l.$(e);var n=l.isArray(t)?l.toMap(t):t;return function(t){return!!n[e(t)]}},l.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=l.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),l.accessor(e)}),function(n,r){var i,a,s,o,l;for(i=0,a=e.length;a>i;++i){if(s=e[i],o=s(n),l=s(r),l>o)return-1*t[i];if(o>l)return t[i]}return 0}},l.cmp=function(e,t){return t>e?-1:e>t?1:e>=t?0:null===e?-1:null===t?1:0/0},l.numcmp=function(e,t){return e-t},l.stablesort=function(e,t,n){var r=e.reduce(function(e,t,r){return e[n(t)]=r,e},{});return e.sort(function(e,i){var a=t(e),s=t(i);return s>a?-1:a>s?1:r[n(e)]-r[n(i)]}),e},l.startsWith=String.prototype.startsWith?function(e,t){return e.startsWith(t)}:function(e,t){return 0===e.lastIndexOf(t,0)},l.pad=function(e,t,n,r){r=r||" ";var a=t-e.length;if(0>=a)return e;switch(n){case"left":return i(a,r)+e;case"middle":case"center":return i(Math.floor(a/2),r)+e+i(Math.ceil(a/2),r);default:return e+i(a,r)}},l.truncate=function(e,t,n,r,i){var s=e.length;if(t>=s)return e;i=void 0!==i?String(i):"…";var o=Math.max(0,t-i.length);switch(n){case"left":return i+(r?a(e,o,1):e.slice(s-o));case"middle":case"center":var l=Math.ceil(o/2),u=Math.floor(o/2);return(r?a(e,l):e.slice(0,l))+i+(r?a(e,u,1):e.slice(s-u));default:return(r?a(e,o):e.slice(0,o))+i}};var f=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/}).call(this,e("_process"))},{"./time-units":24,_process:3,buffer:2}],26:[function(e,t,n){t.exports=e("./lib/heap")},{"./lib/heap":27}],27:[function(t,n,r){(function(){var t,i,a,s,o,l,u,d,c,f,h,p,m,g,y;a=Math.floor,f=Math.min,i=function(e,t){return t>e?-1:e>t?1:0},c=function(e,t,n,r,s){var o;if(null==n&&(n=0),null==s&&(s=i),0>n)throw new Error("lo must be non-negative");for(null==r&&(r=e.length);r>n;)o=a((n+r)/2),s(t,e[o])<0?r=o:n=o+1;return[].splice.apply(e,[n,n-n].concat(t)),t},l=function(e,t,n){return null==n&&(n=i),e.push(t),g(e,0,e.length-1,n)},o=function(e,t){var n,r;return null==t&&(t=i),n=e.pop(),e.length?(r=e[0],e[0]=n,y(e,0,t)):r=n,r},d=function(e,t,n){var r;return null==n&&(n=i),r=e[0],e[0]=t,y(e,0,n),r},u=function(e,t,n){var r;return null==n&&(n=i),e.length&&n(e[0],t)<0&&(r=[e[0],t],t=r[0],e[0]=r[1],y(e,0,n)),t},s=function(e,t){var n,r,s,o,l,u;for(null==t&&(t=i),o=function(){u=[];for(var t=0,n=a(e.length/2);n>=0?n>t:t>n;n>=0?t++:t--)u.push(t);return u}.apply(this).reverse(),l=[],r=0,s=o.length;s>r;r++)n=o[r],l.push(y(e,n,t));return l},m=function(e,t,n){var r;return null==n&&(n=i),r=e.indexOf(t),-1!==r?(g(e,0,r,n),y(e,r,n)):void 0},h=function(e,t,n){var r,a,o,l,d;if(null==n&&(n=i),a=e.slice(0,t),!a.length)return a;for(s(a,n),d=e.slice(t),o=0,l=d.length;l>o;o++)r=d[o],u(a,r,n);return a.sort(n).reverse()},p=function(e,t,n){var r,a,l,u,d,h,p,m,g,y;if(null==n&&(n=i),10*t<=e.length){if(u=e.slice(0,t).sort(n),!u.length)return u;for(l=u[u.length-1],m=e.slice(t),d=0,p=m.length;p>d;d++)r=m[d],n(r,l)<0&&(c(u,r,0,null,n),u.pop(),l=u[u.length-1]);return u}for(s(e,n),y=[],a=h=0,g=f(t,e.length);g>=0?g>h:h>g;a=g>=0?++h:--h)y.push(o(e,n));return y},g=function(e,t,n,r){var a,s,o;for(null==r&&(r=i),a=e[n];n>t&&(o=n-1>>1,s=e[o],r(a,s)<0);)e[n]=s,n=o;return e[n]=a},y=function(e,t,n){var r,a,s,o,l;for(null==n&&(n=i),a=e.length,l=t,s=e[t],r=2*t+1;a>r;)o=r+1,a>o&&!(n(e[r],e[o])<0)&&(r=o),e[t]=e[r],t=r,r=2*t+1;return e[t]=s,g(e,l,t,n)},t=function(){function e(e){this.cmp=null!=e?e:i,this.nodes=[]}return e.push=l,e.pop=o,e.replace=d,e.pushpop=u,e.heapify=s,e.updateItem=m,e.nlargest=h,e.nsmallest=p,e.prototype.push=function(e){return l(this.nodes,e,this.cmp)},e.prototype.pop=function(){return o(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return-1!==this.nodes.indexOf(e)},e.prototype.replace=function(e){return d(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return u(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return s(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return m(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return t=new e,t.nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),function(t,i){return"function"==typeof e&&e.amd?e([],i):"object"==typeof r?n.exports=i():t.Heap=i()}(this,function(){return t})}).call(this)},{}],28:[function(e,t,n){(function(n){var r=e("datalib"),i=e("../render/canvas/index"),a=e("../render/svg-headless/index"),s=e("./View"),o=(e("../util/debug"),function(e,t,n){s.call(null,e,t,n),this._el="body",this._type="canvas",this._renderers={canvas:i,svg:a},this._canvas=null}),l=o.prototype=new s;l.renderer=function(e){return e&&(this._type=e),s.prototype.renderer.apply(this,arguments)},l.canvas=function(){return this._canvas},l.canvasAsync=function(e){function t(){0===n.pendingImages()?(r.render(),e(r._canvas)):setTimeout(t,10)}var n=this._renderer,r=this;n.pendingImages()>0?t():e(this._canvas)},l.svg=function(){return"svg"===this._type?this._renderer.svg():null},l.initialize=function(){var e=this._width,t=this._height,n=this._padding,r=this._bgcolor;return this._viewport&&(e=this._viewport[0]-(n?n.left+n.right:0),t=this._viewport[1]-(n?n.top+n.bottom:0)),this._renderer=this._renderer||new this._io.Renderer,"svg"===this._type?this.initSVG(e,t,n,r):this.initCanvas(e,t,n,r),this},l.initCanvas=function(e,t,i,a){var s="undefined"!=typeof window?window.canvas:"undefined"!=typeof n?n.canvas:null,o=e+(i?i.left+i.right:0),l=t+(i?i.top+i.bottom:0),u=this._canvas=r.isNode?new s(o,l):document.createElement("canvas"),d=u.getContext("2d");r.isNode||(u.setAttribute("width",o),u.setAttribute("height",l)),d.setTransform(1,0,0,1,i.left,i.top),this._renderer.context(d),this._renderer.resize(e,t,i),this._renderer.background(a)},l.initSVG=function(e,t,n,r){var i=e+(n?n.left+n.right:0),a=t+(n?n.top+n.bottom:0);this._renderer.initialize(this._el,i,a,n,r)},t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../render/canvas/index":63,"../render/svg-headless/index":67,"../util/debug":109,"./View":30,datalib:20}],29:[function(e,t,n){function r(){this._defs={},this._predicates={},this._scene=null,this._node=null,this._builder=null,this._reset={axes:!1,legends:!1},s.prototype.init.call(this)}function i(e){var t=this,n={};return a.isArray(e)?(e.forEach(function(e){n[e]=t._predicates[e]}),n):this._predicates[e]}var a=e("datalib"),s=e("../dataflow/Graph"),o=e("../dataflow/Node"),l=e("../scene/GroupBuilder"),u=e("../dataflow/changeset"),d=e("../scene/visit"),c=r.prototype=new s;c.defs=function(e){return arguments.length?(this._defs=e,this):this._defs},c.width=function(e){return this._defs&&(this._defs.width=e),this._defs&&this._defs.marks&&(this._defs.marks.width=e),this._scene&&(this._scene.items[0].width=e),this._reset.axes=!0,this},c.height=function(e){return this._defs&&(this._defs.height=e),this._defs&&this._defs.marks&&(this._defs.marks.height=e),this._scene&&(this._scene.items[0].height=e),this._reset.axes=!0,this},c.node=function(){return this._node||(this._node=new o(this))},c.data=function(){var e=s.prototype.data.apply(this,arguments);return arguments.length>1&&this.node().addListener(e.pipeline()[0]),e},c.predicate=function(e,t){return 1===arguments.length?i.call(this,e):this._predicates[e]=t},c.predicates=function(){return this._predicates},c.scene=function(e){if(!arguments.length)return this._scene;this._builder&&this.node().removeListener(this._builder.disconnect()),this._builder=new l(this,this._defs.marks,this._scene={}),this.node().addListener(this._builder.connect());var t=this._builder.pipeline();return t[t.length-1].addListener(e),this},c.reset=function(){return this._scene&&this._reset.axes&&(d(this._scene,function(e){e.axes&&e.axes.forEach(function(e){e.reset()})}),this._reset.axes=!1),this._scene&&this._reset.legends&&(d(this._scene,function(e){e.legends&&e.legends.forEach(function(e){e.reset()})}),this._reset.legends=!1),this},c.addListener=function(e){this.node().addListener(e)},c.removeListener=function(e){this.node().removeListener(e)},c.fire=function(e){e||(e=u.create()),this.propagate(e,this.node())},t.exports=r},{"../dataflow/Graph":33,"../dataflow/Node":34,"../dataflow/changeset":36,"../scene/GroupBuilder":76,"../scene/visit":82,datalib:20}],30:[function(e,t,n){(function(n){function r(e){var t=this,n=this._model.data(e),r=n.name(),i=n.pipeline()[0],a=this._streamer,o=this._changeset,l={};if(s.keys(o.signals).length>0)throw"New signal values are not reflected in the visualization. Please call view.update() before updating data values.";return this._api[e]?this._api[e]:(l.insert=function(e){return n.insert(s.duplicate(e)),a.addListener(i),t._changeset.data[r]=1,l},l.update=function(){return a.addListener(i),t._changeset.data[r]=1,n.update.apply(n,arguments),l},l.remove=function(){return a.addListener(i),t._changeset.data[r]=1,n.remove.apply(n,arguments),l},l.values=function(){return n.values()},this._api[e]=l)}function i(){var e=this;return e._renderNode=new o(e._model).router(!0),e._renderNode.evaluate=function(t){p(t,["rendering"]);var n=e._model.scene();t.trans?t.trans.start(function(t){e._renderer.render(n,t)}):e._renderer.render(n);var r,i;for(r in t.data)i=e._model.data(r),i.revises()&&m.finalize(i.last());return t},e._model.scene(e._renderNode),!0}var a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,s=e("datalib"),o=e("../dataflow/Node"),l=e("../parse/streams"),u=e("../render/canvas/index"),d=e("../render/svg/index"),c=e("../scene/Encoder"),f=e("../scene/Transition"),h=e("../util/config"),p=e("../util/debug"),m=e("../dataflow/changeset"),g=function(e,t,n,r){this._el=null,this._model=null,this._width=this.__width=t||500,this._height=this.__height=n||300,this._bgcolor=null,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._streamer=null,this._changeset=null,this._renderers={canvas:u,svg:d},this._io=u,this._api={}},y=g.prototype;y.model=function(e){return arguments.length?(this._model!==e&&(this._model=e,this._streamer=new o(e),this._changeset=m.create(),this._handler&&this._handler.model(e)),this):this._model},y.data=function(e){var t=this;return arguments.length?s.isString(e)?r.call(t,e):(s.isObject(e)&&s.keys(e).forEach(function(n){var i=r.call(t,n);e[n](i)}),this):t._model.dataValues()},y.signal=function(e,t){var n=this._model,r=this._changeset,i=this._streamer,a=e;if(!arguments.length)return n.signalValues();if(1==arguments.length&&s.isString(e))return n.signalValues(e);if(s.keys(r.data).length>0)throw"New data values are not reflected in the visualization. Please call view.update() before updating signal values.";return 2==arguments.length&&(a={},a[e]=t),s.keys(a).forEach(function(e){i.addListener(n.signal(e).value(a[e])),r.signals[e]=1,r.reflow=!0}),this},y.width=function(e){return arguments.length?(this.__width!==e&&(this._width=this.__width=e,this.initialize(),this._strict&&(this._autopad=1)),this):this.__width},y.height=function(e){return arguments.length?(this.__height!==e&&(this._height=this.__height=e,this.initialize(),this._strict&&(this._autopad=1)),this):this.__height},y.background=function(e){return arguments.length?(this._bgcolor!==e&&(this._bgcolor=e,this.initialize()),this):this._bgcolor},y.padding=function(e){return arguments.length?(this._padding!==e&&(s.isString(e)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===e):(this._autopad=0,this._padding=e,this._strict=!1),this._el&&(this._renderer.resize(this._width,this._height,e),this._handler&&this._handler.padding(e))),this):this._padding},y.autopad=function(e){if(this._autopad<1)return this;this._autopad=0;var t=this._padding,n=this.model().scene().bounds,r=h.autopadInset,i=n.x1<0?Math.ceil(-n.x1)+r:0,a=n.y1<0?Math.ceil(-n.y1)+r:0,s=n.x2>this._width?Math.ceil(+n.x2-this._width)+r:0,n=n.y2>this._height?Math.ceil(+n.y2-this._height)+r:0;return t={left:i,top:a,right:s,bottom:n},this._strict?(this._autopad=0,this._padding=t,this._width=Math.max(0,this.__width-(i+s)),this._height=Math.max(0,this.__height-(a+n)),this._model.width(this._width).height(this._height).reset(),this.initialize().update({props:"enter"}).update({props:"update"})):this.padding(t).update(e),this},y.viewport=function(e){return arguments.length?(this._viewport!==e&&(this._viewport=e,this.initialize()),this):this._viewport},y.renderer=function(e){if(!arguments.length)return this._renderer;if(this._renderers[e])e=this._renderers[e];else{if(s.isString(e))throw new Error("Unknown renderer: "+e);if(!e)throw new Error("No renderer specified")}return this._io!==e&&(this._io=e,this._renderer=null,this.initialize(),this._build&&this.render()),this},y.initialize=function(e){var t,n=this,r=n._width,i=n._height,s=n._padding,o=n._bgcolor;return arguments.length&&null!==e||(e=this._el?this._el.parentNode:null)?(a.select(e).select("div.vega").remove(),this._el=e=a.select(e).append("div").attr("class","vega").style("position","relative").node(),n._viewport&&a.select(e).style("width",(n._viewport[0]||r)+"px").style("height",(n._viewport[1]||i)+"px").style("overflow","auto"),n._renderer=(n._renderer||new this._io.Renderer).initialize(e,r,i,s,o),t=n._handler,n._handler=(new this._io.Handler).initialize(e,s,n).model(n._model),t?t.handlers().forEach(function(e){n._handler.on(e.type,e.handler)}):l(this),this):this},y.update=function(e){e=e||{};var t=this,n=e.duration?new f(e.duration,e.ease):null,r=t._changeset;if(n&&(r.trans=n),void 0!==e.props){if(s.keys(r.data).length>0)throw"New data values are not reflected in the visualization. Please call view.update() before updating a specified property set.";r.reflow=!0,r.request=e.props}return t._build=t._build||i.call(this),e.items?(c.update(this._model,e.trans,e.props,e.items),t._renderNode.evaluate(r)):t._streamer.listeners().length?(t._model.propagate(r,t._streamer),t._streamer.disconnect()):t._model.fire(r),t._changeset=m.create(),t.autopad(e)},y.render=function(e){return this._renderer.render(this._model.scene(),e),this},y.on=function(){return this._handler.on.apply(this._handler,arguments),this},y.onSignal=function(e,t){return this._model.signal(e).on(t),this},y.off=function(){return this._handler.off.apply(this._handler,arguments),this},y.offSignal=function(e,t){return this._model.signal(e).off(t),this},g.factory=function(t){var n=e("./HeadlessView");return function(e){e=e||{};var r=t.defs(),i=(e.el?new g:new n).model(t).renderer(e.renderer||"canvas").width(r.width).height(r.height).background(r.background).padding(r.padding);return(e.el||!e.el&&i instanceof n)&&i.initialize(e.el),e.data&&i.data(e.data),i}},t.exports=g}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/Node":34,"../dataflow/changeset":36,"../parse/streams":59,"../render/canvas/index":63,"../render/svg/index":71,"../scene/Encoder":75,"../scene/Transition":79,"../util/config":107,"../util/debug":109,"./HeadlessView":28,datalib:20}],31:[function(e,t,n){function r(e){return i.prototype.init.call(this,e),this._data=[],this.router(!0).collector(!0)}var i=e("./Node"),a=e("./changeset"),s=e("../util/debug"),o=(e("../util/constants"),r.prototype=new i);o.data=function(){return this._data},o.evaluate=function(e){if(s(e,["collecting"]),e.reflow)return e=a.create(e),e.mod=this._data.slice(),e;if(e.rem.length){var t=e.rem.reduce(function(e,t){return e[t._id]=1,e},{});this._data=this._data.filter(function(e){return 1!==t[e._id]})}return e.add.length&&(this._data=this._data.length?this._data.concat(e.add):e.add),e.sort&&this._data.sort(e.sort),e},t.exports=r},{"../util/constants":108,"../util/debug":109,"./Node":34,"./changeset":36}],32:[function(e,t,n){function r(e,t,n){this._graph=e,this._name=t,this._data=[],this._source=null,this._facet=n,this._input=s.create(),this._output=null,this._pipeline=null,this._collector=null,this._revises=!1}function i(e){void 0===e._prev&&(e._prev=c.SENTINEL)}var a=e("datalib"),s=e("./changeset"),o=e("./tuple"),l=e("./Node"),u=e("./Collector"),d=e("../util/debug"),c=e("../util/constants"),f=r.prototype;f.name=function(e){return arguments.length?(this._name=e,this):this._name},f.source=function(e){return arguments.length?this._source=this._graph.data(e):this._source},f.insert=function(e){var t=this._revises?null:void 0;return this._input.add=this._input.add.concat(a.array(e).map(function(e){return o.ingest(e,t)})),this},f.remove=function(e){var t=this._data.filter(e);return this._input.rem=this._input.rem.concat(t),this},f.update=function(e,t,n){{var r=this._input.mod,i=o.idMap(r);this._revises?null:void 0}return this._input.fields[t]=1,this._data.filter(e).forEach(function(e){var a=e[t],s=n(e);a!==s&&(o.set(e,t,s),1!==i[e._id]&&(r.push(e),i[e._id]=1))}),this},f.values=function(e){return arguments.length?(this._input.rem=this._data.slice(),e&&this.insert(e),this):this._collector?this._collector.data():this._data},f.revises=function(e){return arguments.length?(!this._revises&&e&&(this._data.forEach(i),this._input.add.forEach(i)),this._revises=this._revises||e,this):this._revises},f.last=function(){return this._output},f.fire=function(e){return e&&(this._input=e),this._graph.propagate(this._input,this._pipeline[0]),this},f.pipeline=function(e){var t=this;if(!arguments.length)return this._pipeline;e.length&&(t._collector=new u(this._graph),e.push(t._collector),t._revises=e.some(function(e){return e.revises()}));var n=new l(this._graph).router(!0).collector(!0);n.evaluate=function(e){d(e,["input",t._name]);var n,r=t._input,i=s.create(e);return a.keys(r.fields).forEach(function(e){i.fields[e]=1}),e.reflow?i.mod=t._data.slice():(r.rem.length&&(n=o.idMap(r.rem),t._data=t._data.filter(function(e){return 1!==n[e._id]})),r.add.length&&(t._data=t._data.concat(r.add)),t._input=s.create(),i.add=r.add,i.mod=r.mod,i.rem=r.rem),i.facet=t._facet,i},e.unshift(n);var r=new l(this._graph).router(!0).collector(!0);return r.evaluate=function(e){d(e,["output",t._name]);var n=s.create(e,!0);return t._facet&&(t._facet.values=t.values(),e.facet=null),t._output=e,n.data[t._name]=1,n},e.push(r),this._pipeline=e,this._graph.connect(t._pipeline),this},f.listener=function(){var e=new l(this._graph).router(!0),t=this,n=this._revises?null:void 0;return e.evaluate=function(e){t._srcMap=t._srcMap||{};var r=t._srcMap,i=s.create(e);return i.add=e.add.map(function(e){return r[e._id]=o.derive(e,void 0!==e._prev?e._prev:n)}),i.mod=e.mod.map(function(e){return r[e._id]}),i.rem=e.rem.map(function(e){var t=r[e._id];return r[e._id]=null,t}),t._input=i},e.addListener(this._pipeline[0]),e},f.addListener=function(e){return e instanceof r?this._collector?this._collector.addListener(e.listener()):this._pipeline[0].addListener(e.listener()):this._pipeline[this._pipeline.length-1].addListener(e),this},f.removeListener=function(e){this._pipeline[this._pipeline.length-1].removeListener(e)},f.listeners=function(e){return e?this._collector?this._collector.listeners():this._pipeline[0].listeners():this._pipeline[this._pipeline.length-1].listeners()},t.exports=r},{"../util/constants":108,"../util/debug":109,"./Collector":31,"./Node":34,"./changeset":36,"./tuple":37,datalib:20}],33:[function(e,t,n){function r(){}function i(e){var t=this;return s.isArray(e)?e.map(function(e){t._signals[e]}):this._signals[e]}function a(e,t){var n,r,i,a;for(i=0,a=e.length;a>i;++i)n=e[i],n.collector()&&(r=n),t(n,r,i)}var s=e("datalib"),o=e("heap"),l=e("./Datasource"),u=e("./Signal"),d=(e("./changeset"),e("../util/debug")),c=e("../util/constants"),f=r.prototype;f.init=function(){this._stamp=0,this._rank=0,this._data={},this._signals={},this.doNotPropagate={}},f.data=function(e,t,n){var r=this._data;return arguments.length?1===arguments.length?r[e]:r[e]=new l(this,e,n).pipeline(t):s.keys(r).map(function(e){return r[e]})},f.dataValues=function(e){var t=this;return arguments.length||(e=s.keys(this._data)),s.isArray(e)?e.reduce(function(e,n){return e[n]=t._data[n].values(),e},{}):this._data[e].values()},f.signal=function(e,t){return 1===arguments.length?i.call(this,e):this._signals[e]=new u(this,e,t)},f.signalValues=function(e){var t=this;return arguments.length||(e=s.keys(this._signals)),s.isArray(e)?e.reduce(function(e,n){return e[n]=t._signals[n].value(),e},{}):this._signals[e].value()},f.signalRef=function(e){s.isArray(e)||(e=s.field(e));var t=this.signal(e.shift()).value();if(e.length>0){var n=Function("s","return s["+e.map(s.str).join("][")+"]");t=n.call(null,t)}return t};var h=function(e,t){return e.rank==t.rank?e.pulse.reflow?1:-1:e.rank-t.rank};f.propagate=function(e,t){var n,r,i,a,s,l,u,c,f=new o(h);if(e.stamp)throw"Pulse already has a non-zero stamp";for(e.stamp=++this._stamp,f.push({node:t,pulse:e,rank:t.rank()});f.size()>0;)if(n=f.pop(),i=n.node,a=n.pulse,s=n.rank,r=i._listeners,c=a.reflow&&i.last()>=a.stamp,!c)if(s==i.rank()){if(a=this.evaluate(a,i),a!==this.doNotPropagate)for(l=0,u=r.length;u>l;l++)f.push({node:r[l],pulse:a,rank:r[l]._rank})}else d(a,["Rank mismatch",s,i.rank()]),f.push({node:i,pulse:a,rank:i.rank()})},f.connect=function(e){d({},["connecting"]);var t=this;return a(e,function(n,r,i){var a=n.dependency(c.DATA),s=n.dependency(c.SIGNALS);a.length>0&&a.forEach(function(e){t.data(e).revises(n.revises()).addListener(r)}),s.length>0&&s.forEach(function(e){t.signal(e).addListener(r)}),i>0&&e[i-1].addListener(e[i])}),e},f.disconnect=function(e){d({},["disconnecting"]);var t=this;return a(e,function(e,n,r){var i=e.dependency(c.DATA),a=e.dependency(c.SIGNALS);i.length>0&&i.forEach(function(e){t.data(e).removeListener(n)}),a.length>0&&a.forEach(function(e){t.signal(e).removeListener(n)}),e.disconnect()}),e},f.reevaluate=function(e,t){var n=!e.reflow||e.reflow&&t.last()>=e.stamp,r=!!e.add.length||!!e.rem.length||t.router();return r=r||!n,r||t.reevaluate(e)},f.evaluate=function(e,t){return this.reevaluate(e,t)?(e=t.evaluate(e),t.last(e.stamp),e):e},t.exports=r},{"../util/constants":108,"../util/debug":109,"./Datasource":32,"./Signal":35,"./changeset":36,datalib:20,heap:26}],34:[function(e,t,n){function r(e){return e&&this.init(e),this}var i=e("datalib"),a=e("../util/constants"),s=[a.DATA,a.FIELDS,a.SCALES,a.SIGNALS],o=1,l=r.prototype;l.init=function(e){return this._id=o++,this._graph=e,this._rank=++e._rank,this._stamp=0,this._listeners=[],this._registered={},this._deps={data:[],fields:[],scales:[],signals:[]},this._isRouter=!1,this._isCollector=!1,this._revises=!1,this},l.rank=function(){return this._rank},l.last=function(e){return arguments.length?(this._stamp=e,this):this._stamp},l.dependency=function(e,t){var n=this._deps[e];if(1===arguments.length)return n;if(null===t)for(;n.length>0;)n.pop();else!i.isArray(t)&&n.indexOf(t)<0?n.push(t):n.push.apply(n,i.array(t));return this},l.router=function(e){return arguments.length?(this._isRouter=!!e,this):this._isRouter},l.collector=function(e){return arguments.length?(this._isCollector=!!e,this):this._isCollector},l.revises=function(e){return arguments.length?(this._revises=!!e,this):this._revises},l.listeners=function(){return this._listeners},l.addListener=function(e){if(!(e instanceof r))throw"Listener is not a Node";if(this._registered[e._id])return this;if(this._listeners.push(e),this._registered[e._id]=1,this._rank>e._rank)for(var t=[e];t.length;){var n=t.splice(0,1)[0];n._rank=++this._graph._rank,t.push.apply(t,n._listeners)}return this},l.removeListener=function(e){for(var t=!1,n=0,r=this._listeners.length;r>n&&!t;n++)this._listeners[n]===e&&(this._listeners.splice(n,1),this._registered[e._id]=null,t=!0);return t},l.disconnect=function(){this._listeners=[],this._registered={}},l.evaluate=function(e){return e},l.reevaluate=function(e){var t=this,n=!1;return s.some(function(r){return n=n||t._deps[r].some(function(t){return!!e[r][t]})})},t.exports=r},{"../util/constants":108,datalib:20}],35:[function(e,t,n){function r(e,t,n){return i.prototype.init.call(this,e),this._name=t,this._value=n,this._handlers=[],this}var i=e("./Node"),a=e("./changeset"),s=r.prototype=new i;s.name=function(){return this._name},s.value=function(e){return arguments.length?(this._value=e,this):this._value},s.evaluate=function(e){return e.signals[this._name]?e:this._graph.doNotPropagate},s.fire=function(e){e||(e=a.create(null,!0)),e.signals[this._name]=1,this._graph.propagate(e,this)},s.on=function(e){var t=this,n=new i(this._graph);return n.evaluate=function(n){return e(t.name(),t.value()),n},this._handlers.push({handler:e,node:n}),this.addListener(n)},s.off=function(e){for(var t=this,n=this._handlers,r=n.length;--r>=0;)e&&n[r].handler!==e||t.removeListener(n.splice(r,1)[0].node);return this},t.exports=r},{"./Node":34,"./changeset":36}],36:[function(e,t,n){function r(e,t){var n={};return o(e,n),n.add=[],n.mod=[],n.rem=[],n.reflow=t,n}function a(e){e._prev=void 0===e._prev?void 0:l.SENTINEL}function s(e){for(i=0,len=e.add.length;i<len;++i)a(e.add[i]);for(i=0,len=e.mod.length;i<len;++i)a(e.mod[i])}function o(e,t){t.stamp=e?e.stamp:0,t.sort=e?e.sort:null,t.facet=e?e.facet:null,t.trans=e?e.trans:null,t.request=e?e.request:null,u.forEach(function(n){t[n]=e?e[n]:{}})}var l=e("../util/constants"),u=[l.DATA,l.FIELDS,l.SCALES,l.SIGNALS];t.exports={create:r,copy:o,finalize:s}},{"../util/constants":108}],37:[function(e,t,n){function r(e,t){return e=d.isObject(e)?e:{data:e},e._id=f++,e._prev=void 0!==t?t||c.SENTINEL:void 0,e}function i(e,t){return r(Object.create(e),t)}function a(e,t,n){var r=e[t];r!==n&&(s(e,t),e[t]=n)}function s(e,t){void 0!==e._prev&&(e._prev=e._prev===c.SENTINEL?{}:e._prev,e._prev[t]=e[t])}function o(e){return e._prev&&e._prev!==c.SENTINEL}function l(){f=1}function u(e){return e.reduce(function(e,t){return e[t._id]=1,e},{})}var d=e("datalib"),c=e("../util/constants"),f=1;t.exports={ingest:r,derive:i,set:a,set_prev:s,has_prev:o,reset:l,idMap:u}},{"../util/constants":108,datalib:20}],38:[function(e,t,n){var r=e("datalib");t.exports=function(t){function n(e){var t={fn:i(e),signals:r.keys(f),fields:r.keys(h)};return f={},h={},t}function i(e){if(e instanceof String)return e;var t=p[e.type];if(null==t)throw new Error("Unsupported type: "+e.type);return t(e)}t=t||{};var a=t.constants||e("./constants"),s=(t.functions||e("./functions"))(i),o=t.idWhiteList?r.toMap(t.idWhiteList):null,l=t.idBlackList?r.toMap(t.idBlackList):null,u=0,d="d",c="sg.",f={},h={},p={Literal:function(e){return e.raw},Identifier:function(e){var t=e.name;if(u>0)return t;if(a.hasOwnProperty(t))return a[t];if(o)return o.hasOwnProperty(t)?t:(f[t]=1,c+t);if(l&&l.hasOwnProperty(t))throw new Error("Illegal identifier: "+t);return t},Program:function(e){return e.body.map(i).join("\n")},MemberExpression:function(e){var t=!e.computed,n=i(e.object);t&&(u+=1);var r=i(e.property);return n===d&&(h[r]=1),t&&(u-=1),n+(t?"."+r:"["+r+"]")},CallExpression:function(e){if("Identifier"!==e.callee.type)throw new Error("Illegal callee type: "+e.callee.type);var t=e.callee.name,n=e.arguments,r=s.hasOwnProperty(t)&&s[t];

if(!r)throw new Error("Unrecognized function: "+t);return r instanceof Function?r(n):r+"("+n.map(i).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(i).join(",")+"]"},BinaryExpression:function(e){return"("+i(e.left)+e.operator+i(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+i(e.argument)+")"},UpdateExpression:function(e){return"("+(prefix?e.operator+i(e.argument):i(e.argument)+e.operator)+")"},ConditionalExpression:function(e){return"("+i(e.test)+"?"+i(e.consequent)+":"+i(e.alternate)+")"},LogicalExpression:function(e){return"("+i(e.left)+e.operator+i(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(i).join(",")+"}"},Property:function(e){u+=1;var t=i(e.key);return u-=1,t+":"+i(e.value)},ExpressionStatement:function(e){return i(e.expression)}};return n}},{"./constants":39,"./functions":40,datalib:20}],39:[function(e,t,n){t.exports={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"}},{}],40:[function(e,t,n){e("datalib");t.exports=function(e){function t(t,n,r,i){var a=e(n[0]);return r&&(a=r+"("+a+")",dl.startsWith(r,"new ")&&(a="("+a+")")),a+"."+t+(0>i?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}var n="new Date",r="String",i="RegExp";return{isNaN:"isNaN",isFinite:"isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",now:"Date.now",datetime:"new Date",date:function(e){return t("getDate",e,n,0)},day:function(e){return t("getDay",e,n,0)},year:function(e){return t("getFullYear",e,n,0)},month:function(e){return t("getMonth",e,n,0)},hours:function(e){return t("getHours",e,n,0)},minutes:function(e){return t("getMinutes",e,n,0)},seconds:function(e){return t("getSeconds",e,n,0)},milliseconds:function(e){return t("getMilliseconds",e,n,0)},time:function(e){return t("getTime",e,n,0)},timezoneoffset:function(e){return t("getTimezoneOffset",e,n,0)},utcdate:function(e){return t("getUTCDate",e,n,0)},utcday:function(e){return t("getUTCDay",e,n,0)},utcyear:function(e){return t("getUTCFullYear",e,n,0)},utcmonth:function(e){return t("getUTCMonth",e,n,0)},utchours:function(e){return t("getUTCHours",e,n,0)},utcminutes:function(e){return t("getUTCMinutes",e,n,0)},utcseconds:function(e){return t("getUTCSeconds",e,n,0)},utcmilliseconds:function(e){return t("getUTCMilliseconds",e,n,0)},length:function(e){return t("length",e,null,-1)},indexof:function(e){return t("indexOf",e,null)},lastindexof:function(e){return t("lastIndexOf",e,null)},parseFloat:"parseFloat",parseInt:"parseInt",upper:function(e){return t("toUpperCase",e,r,0)},lower:function(e){return t("toLowerCase",e,r,0)},slice:function(e){return t("slice",e,r)},substring:function(e){return t("substring",e,r)},test:function(e){return t("test",e,i)},"if":function(t){if(t.length<3)throw new Error("Missing arguments to if function.");if(t.length>3)throw new Error("Too many arguments to if function.");var n=t.map(e);return n[0]+"?"+n[1]+":"+n[2]}}}},{datalib:20}],41:[function(e,t,n){var r=e("./parser"),i=e("./codegen");t.exports={parse:function(e,t){return r.parse("("+e+")",t)},code:function(e){return i(e)}}},{"./codegen":38,"./parser":42}],42:[function(e,t,n){t.exports=function(){"use strict";function e(e,t){if(!e)throw new Error("ASSERT: "+t)}function t(e){return e>=48&&57>=e}function n(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function r(e){return"01234567".indexOf(e)>=0}function i(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function a(e){return 10===e||13===e||8232===e||8233===e}function s(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||92===e||e>=128&&Ee.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function o(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||e>=48&&57>=e||92===e||e>=128&&Ee.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function l(e){switch(e){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}function u(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function d(e){if(Ae&&u(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function c(){var e,t;for(t=0===Le;Ce>Le;)if(e=Se.charCodeAt(Le),i(e))++Le;else{if(!a(e))break;++Le,13===e&&10===Se.charCodeAt(Le)&&++Le,++Te,Me=Le,t=!0}}function f(e){var t,r,i,a=0;for(r="u"===e?4:2,t=0;r>t;++t){if(!(Ce>Le&&n(Se[Le])))return"";i=Se[Le++],a=16*a+"0123456789abcdef".indexOf(i.toLowerCase())}return String.fromCharCode(a)}function h(){var e,t,r,i;for(e=Se[Le],t=0,"}"===e&&$({},ke.UnexpectedToken,"ILLEGAL");Ce>Le&&(e=Se[Le++],n(e));)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&$({},ke.UnexpectedToken,"ILLEGAL"),65535>=t?String.fromCharCode(t):(r=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(r,i))}function p(){var e,t;for(e=Se.charCodeAt(Le++),t=String.fromCharCode(e),92===e&&(117!==Se.charCodeAt(Le)&&$({},ke.UnexpectedToken,"ILLEGAL"),++Le,e=f("u"),e&&"\\"!==e&&s(e.charCodeAt(0))||$({},ke.UnexpectedToken,"ILLEGAL"),t=e);Ce>Le&&(e=Se.charCodeAt(Le),o(e));)++Le,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==Se.charCodeAt(Le)&&$({},ke.UnexpectedToken,"ILLEGAL"),++Le,e=f("u"),e&&"\\"!==e&&o(e.charCodeAt(0))||$({},ke.UnexpectedToken,"ILLEGAL"),t+=e);return t}function m(){var e,t;for(e=Le++;Ce>Le;){if(t=Se.charCodeAt(Le),92===t)return Le=e,p();if(!o(t))break;++Le}return Se.slice(e,Le)}function g(){var e,t,n;return e=Le,t=92===Se.charCodeAt(Le)?p():m(),n=1===t.length?_e.Identifier:d(t)?_e.Keyword:"null"===t?_e.NullLiteral:"true"===t||"false"===t?_e.BooleanLiteral:_e.Identifier,{type:n,value:t,lineNumber:Te,lineStart:Me,start:e,end:Le}}function y(){var e,t,n,r,i=Le,a=Se.charCodeAt(Le),s=Se[Le];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Le,Ne.tokenize&&(40===a?Ne.openParenToken=Ne.tokens.length:123===a&&(Ne.openCurlyToken=Ne.tokens.length)),{type:_e.Punctuator,value:String.fromCharCode(a),lineNumber:Te,lineStart:Me,start:i,end:Le};default:if(e=Se.charCodeAt(Le+1),61===e)switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Le+=2,{type:_e.Punctuator,value:String.fromCharCode(a)+String.fromCharCode(e),lineNumber:Te,lineStart:Me,start:i,end:Le};case 33:case 61:return Le+=2,61===Se.charCodeAt(Le)&&++Le,{type:_e.Punctuator,value:Se.slice(i,Le),lineNumber:Te,lineStart:Me,start:i,end:Le}}}return r=Se.substr(Le,4),">>>="===r?(Le+=4,{type:_e.Punctuator,value:r,lineNumber:Te,lineStart:Me,start:i,end:Le}):(n=r.substr(0,3),">>>"===n||"<<="===n||">>="===n?(Le+=3,{type:_e.Punctuator,value:n,lineNumber:Te,lineStart:Me,start:i,end:Le}):(t=n.substr(0,2),s===t[1]&&"+-<>&|".indexOf(s)>=0||"=>"===t?(Le+=2,{type:_e.Punctuator,value:t,lineNumber:Te,lineStart:Me,start:i,end:Le}):"<>=!+-*%&|^/".indexOf(s)>=0?(++Le,{type:_e.Punctuator,value:s,lineNumber:Te,lineStart:Me,start:i,end:Le}):void $({},ke.UnexpectedToken,"ILLEGAL")))}function v(e){for(var t="";Ce>Le&&n(Se[Le]);)t+=Se[Le++];return 0===t.length&&$({},ke.UnexpectedToken,"ILLEGAL"),s(Se.charCodeAt(Le))&&$({},ke.UnexpectedToken,"ILLEGAL"),{type:_e.NumericLiteral,value:parseInt("0x"+t,16),lineNumber:Te,lineStart:Me,start:e,end:Le}}function _(e){for(var n="0"+Se[Le++];Ce>Le&&r(Se[Le]);)n+=Se[Le++];return(s(Se.charCodeAt(Le))||t(Se.charCodeAt(Le)))&&$({},ke.UnexpectedToken,"ILLEGAL"),{type:_e.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:Te,lineStart:Me,start:e,end:Le}}function b(){var n,i,a;if(a=Se[Le],e(t(a.charCodeAt(0))||"."===a,"Numeric literal must start with a decimal digit or a decimal point"),i=Le,n="","."!==a){if(n=Se[Le++],a=Se[Le],"0"===n){if("x"===a||"X"===a)return++Le,v(i);if(r(a))return _(i);a&&t(a.charCodeAt(0))&&$({},ke.UnexpectedToken,"ILLEGAL")}for(;t(Se.charCodeAt(Le));)n+=Se[Le++];a=Se[Le]}if("."===a){for(n+=Se[Le++];t(Se.charCodeAt(Le));)n+=Se[Le++];a=Se[Le]}if("e"===a||"E"===a)if(n+=Se[Le++],a=Se[Le],("+"===a||"-"===a)&&(n+=Se[Le++]),t(Se.charCodeAt(Le)))for(;t(Se.charCodeAt(Le));)n+=Se[Le++];else $({},ke.UnexpectedToken,"ILLEGAL");return s(Se.charCodeAt(Le))&&$({},ke.UnexpectedToken,"ILLEGAL"),{type:_e.NumericLiteral,value:parseFloat(n),lineNumber:Te,lineStart:Me,start:i,end:Le}}function x(){var t,n,i,s,o,l,u,d,c="",p=!1;for(u=Te,d=Me,t=Se[Le],e("'"===t||'"'===t,"String literal must starts with a quote"),n=Le,++Le;Ce>Le;){if(i=Se[Le++],i===t){t="";break}if("\\"===i)if(i=Se[Le++],i&&a(i.charCodeAt(0)))++Te,"\r"===i&&"\n"===Se[Le]&&++Le,Me=Le;else switch(i){case"u":case"x":"{"===Se[Le]?(++Le,c+=h()):(l=Le,o=f(i),o?c+=o:(Le=l,c+=i));break;case"n":c+="\n";break;case"r":c+="\r";break;case"t":c+="	";break;case"b":c+="\b";break;case"f":c+="\f";break;case"v":c+="";break;default:r(i)?(s="01234567".indexOf(i),0!==s&&(p=!0),Ce>Le&&r(Se[Le])&&(p=!0,s=8*s+"01234567".indexOf(Se[Le++]),"0123".indexOf(i)>=0&&Ce>Le&&r(Se[Le])&&(s=8*s+"01234567".indexOf(Se[Le++]))),c+=String.fromCharCode(s)):c+=i}else{if(a(i.charCodeAt(0)))break;c+=i}}return""!==t&&$({},ke.UnexpectedToken,"ILLEGAL"),{type:_e.StringLiteral,value:c,octal:p,startLineNumber:u,startLineStart:d,lineNumber:Te,lineStart:Me,start:n,end:Le}}function w(e,t){var n,r=e;t.indexOf("u")>=0&&(r=r.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t){return parseInt(t,16)<=1114111?"x":void $({},ke.InvalidRegExp)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{n=new RegExp(r)}catch(i){$({},ke.InvalidRegExp)}try{return new RegExp(e,t)}catch(a){return null}}function k(){var t,n,r,i,s;for(t=Se[Le],e("/"===t,"Regular expression literal must start with a slash"),n=Se[Le++],r=!1,i=!1;Ce>Le;)if(t=Se[Le++],n+=t,"\\"===t)t=Se[Le++],a(t.charCodeAt(0))&&$({},ke.UnterminatedRegExp),n+=t;else if(a(t.charCodeAt(0)))$({},ke.UnterminatedRegExp);else if(r)"]"===t&&(r=!1);else{if("/"===t){i=!0;break}"["===t&&(r=!0)}return i||$({},ke.UnterminatedRegExp),s=n.substr(1,n.length-2),{value:s,literal:n}}function E(){var e,t,n,r;for(t="",n="";Ce>Le&&(e=Se[Le],o(e.charCodeAt(0)));)if(++Le,"\\"===e&&Ce>Le)if(e=Se[Le],"u"===e){if(++Le,r=Le,e=f("u"))for(n+=e,t+="\\u";Le>r;++r)t+=Se[r];else Le=r,n+="u",t+="\\u";U({},ke.UnexpectedToken,"ILLEGAL")}else t+="\\",U({},ke.UnexpectedToken,"ILLEGAL");else n+=e,t+=e;return{value:n,literal:t}}function S(){var e,t,n,r;return Pe=null,c(),e=Le,t=k(),n=E(),r=w(t.value,n.value),Ne.tokenize?{type:_e.RegularExpression,value:r,regex:{pattern:t.value,flags:n.value},lineNumber:Te,lineStart:Me,start:e,end:Le}:{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:Le}}function A(){var e,t,n,r;return c(),e=Le,t={start:{line:Te,column:Le-Me}},n=S(),t.end={line:Te,column:Le-Me},Ne.tokenize||(Ne.tokens.length>0&&(r=Ne.tokens[Ne.tokens.length-1],r.range[0]===e&&"Punctuator"===r.type&&("/"===r.value||"/="===r.value)&&Ne.tokens.pop()),Ne.tokens.push({type:"RegularExpression",value:n.literal,regex:n.regex,range:[e,Le],loc:t})),n}function L(e){return e.type===_e.Identifier||e.type===_e.Keyword||e.type===_e.BooleanLiteral||e.type===_e.NullLiteral}function T(){var e,t;if(e=Ne.tokens[Ne.tokens.length-1],!e)return A();if("Punctuator"===e.type){if("]"===e.value)return y();if(")"===e.value)return t=Ne.tokens[Ne.openParenToken-1],!t||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?y():A();if("}"===e.value){if(Ne.tokens[Ne.openCurlyToken-3]&&"Keyword"===Ne.tokens[Ne.openCurlyToken-3].type){if(t=Ne.tokens[Ne.openCurlyToken-4],!t)return y()}else{if(!Ne.tokens[Ne.openCurlyToken-4]||"Keyword"!==Ne.tokens[Ne.openCurlyToken-4].type)return y();if(t=Ne.tokens[Ne.openCurlyToken-5],!t)return A()}return y()}return A()}return"Keyword"===e.type&&"this"!==e.value?A():y()}function M(){var e;return c(),Le>=Ce?{type:_e.EOF,lineNumber:Te,lineStart:Me,start:Le,end:Le}:(e=Se.charCodeAt(Le),s(e)?g():40===e||41===e||59===e?y():39===e||34===e?x():46===e?t(Se.charCodeAt(Le+1))?b():y():t(e)?b():Ne.tokenize&&47===e?T():y())}function C(){var e,t,n,r;return c(),e={start:{line:Te,column:Le-Me}},t=M(),e.end={line:Te,column:Le-Me},t.type!==_e.EOF&&(n=Se.slice(t.start,t.end),r={type:be[t.type],value:n,range:[t.start,t.end],loc:e},t.regex&&(r.regex={pattern:t.regex.pattern,flags:t.regex.flags}),Ne.tokens.push(r)),t}function P(){var e;return e=Pe,Le=e.end,Te=e.lineNumber,Me=e.lineStart,Pe="undefined"!=typeof Ne.tokens?C():M(),Le=e.end,Te=e.lineNumber,Me=e.lineStart,e}function I(){var e,t,n;e=Le,t=Te,n=Me,Pe="undefined"!=typeof Ne.tokens?C():M(),Le=e,Te=t,Me=n}function N(){this.line=Te,this.column=Le-Me}function O(){this.start=new N,this.end=null}function j(e){this.start=e.type===_e.StringLiteral?{line:e.startLineNumber,column:e.start-e.startLineStart}:{line:e.lineNumber,column:e.start-e.lineStart},this.end=null}function D(){Le=Pe.start,Pe.type===_e.StringLiteral?(Te=Pe.startLineNumber,Me=Pe.startLineStart):(Te=Pe.lineNumber,Me=Pe.lineStart),Ne.range&&(this.range=[Le,0]),Ne.loc&&(this.loc=new O)}function z(e){Ne.range&&(this.range=[e.start,0]),Ne.loc&&(this.loc=new j(e))}function q(){var e,t,n,r;return e=Le,t=Te,n=Me,c(),r=Te!==t,Le=e,Te=t,Me=n,r}function $(t,n){var r,i=Array.prototype.slice.call(arguments,2),a=n.replace(/%(\d)/g,function(t,n){return e(n<i.length,"Message reference must be in range"),i[n]});throw"number"==typeof t.lineNumber?(r=new Error("Line "+t.lineNumber+": "+a),r.index=t.start,r.lineNumber=t.lineNumber,r.column=t.start-Me+1):(r=new Error("Line "+Te+": "+a),r.index=Le,r.lineNumber=Te,r.column=Le-Me+1),r.description=a,r}function U(){try{$.apply(null,arguments)}catch(e){if(!Ne.errors)throw e;Ne.errors.push(e)}}function R(e){if(e.type===_e.EOF&&$(e,ke.UnexpectedEOS),e.type===_e.NumericLiteral&&$(e,ke.UnexpectedNumber),e.type===_e.StringLiteral&&$(e,ke.UnexpectedString),e.type===_e.Identifier&&$(e,ke.UnexpectedIdentifier),e.type===_e.Keyword){if(l(e.value))$(e,ke.UnexpectedReserved);else if(Ae&&u(e.value))return void U(e,ke.StrictReservedWord);$(e,ke.UnexpectedToken,e.value)}$(e,ke.UnexpectedToken,e.value)}function F(e){var t=P();(t.type!==_e.Punctuator||t.value!==e)&&R(t)}function V(e){if(Ne.errors){var t=Pe;t.type!==_e.Punctuator&&t.value!==e?U(t,ke.UnexpectedToken,t.value):P()}else F(e)}function G(e){return Pe.type===_e.Punctuator&&Pe.value===e}function W(e){return Pe.type===_e.Keyword&&Pe.value===e}function B(){var e;return 59===Se.charCodeAt(Le)||G(";")?void P():(e=Te,c(),void(Te===e&&(Pe.type===_e.EOF||G("}")||R(Pe))))}function H(){var e=[],t=new D;for(F("[");!G("]");)G(",")?(P(),e.push(null)):(e.push(ue()),G("]")||F(","));return P(),t.finishArrayExpression(e)}function Y(){var e,t=new D;return e=P(),e.type===_e.StringLiteral||e.type===_e.NumericLiteral?(Ae&&e.octal&&U(e,ke.StrictOctalLiteral),t.finishLiteral(e)):t.finishIdentifier(e.value)}function X(){var e,t,n,r,i=new D;return e=Pe,e.type===_e.Identifier?(n=Y(),F(":"),r=ue(),i.finishProperty("init",n,r)):e.type!==_e.EOF&&e.type!==_e.Punctuator?(t=Y(),F(":"),r=ue(),i.finishProperty("init",t,r)):void R(e)}function K(){var e,t,n,r,i=[],a={},s=String,o=new D;for(F("{");!G("}");)e=X(),t=e.key.type===xe.Identifier?e.key.name:s(e.key.value),r="init"===e.kind?we.Data:"get"===e.kind?we.Get:we.Set,n="$"+t,Object.prototype.hasOwnProperty.call(a,n)?(a[n]===we.Data?Ae&&r===we.Data?U({},ke.StrictDuplicateProperty):r!==we.Data&&U({},ke.AccessorDataProperty):r===we.Data?U({},ke.AccessorDataProperty):a[n]&r&&U({},ke.AccessorGetSet),a[n]|=r):a[n]=r,i.push(e),G("}")||V(",");return F("}"),o.finishObjectExpression(i)}function J(){var e;return F("("),++Ie.parenthesisCount,e=de(),F(")"),e}function Q(){var e,t,n,r;if(G("("))return J();if(G("["))return H();if(G("{"))return K();if(e=Pe.type,r=new D,e===_e.Identifier||Oe[Pe.value])n=r.finishIdentifier(P().value);else if(e===_e.StringLiteral||e===_e.NumericLiteral)Ae&&Pe.octal&&U(Pe,ke.StrictOctalLiteral),n=r.finishLiteral(P());else{if(e===_e.Keyword)throw new Error("Disabled.");e===_e.BooleanLiteral?(t=P(),t.value="true"===t.value,n=r.finishLiteral(t)):e===_e.NullLiteral?(t=P(),t.value=null,n=r.finishLiteral(t)):G("/")||G("/=")?(n=r.finishLiteral("undefined"!=typeof Ne.tokens?A():S()),I()):R(P())}return n}function Z(){var e=[];if(F("("),!G(")"))for(;Ce>Le&&(e.push(ue()),!G(")"));)V(",");return F(")"),e}function ee(){var e,t=new D;return e=P(),L(e)||R(e),t.finishIdentifier(e.value)}function te(){return F("."),ee()}function ne(){var e;return F("["),e=de(),F("]"),e}function re(){var e,t,n,r,i=Ie.allowIn;for(r=Pe,Ie.allowIn=!0,e=Q();;)if(G("."))n=te(),e=new z(r).finishMemberExpression(".",e,n);else if(G("("))t=Z(),e=new z(r).finishCallExpression(e,t);else{if(!G("["))break;n=ne(),e=new z(r).finishMemberExpression("[",e,n)}return Ie.allowIn=i,e}function ie(){var e;if(e=re(),Pe.type===_e.Punctuator&&(G("++")||G("--"))&&!q())throw new Error("Disabled.");return e}function ae(){var e,t,n;if(Pe.type!==_e.Punctuator&&Pe.type!==_e.Keyword)t=ie();else{if(G("++")||G("--"))throw new Error("Disabled.");if(G("+")||G("-")||G("~")||G("!"))n=Pe,e=P(),t=ae(),t=new z(n).finishUnaryExpression(e.value,t);else{if(W("delete")||W("void")||W("typeof"))throw new Error("Disabled.");t=ie()}}return t}function se(e,t){var n=0;if(e.type!==_e.Punctuator&&e.type!==_e.Keyword)return 0;switch(e.value){case"||":n=1;break;case"&&":n=2;break;case"|":n=3;break;case"^":n=4;break;case"&":n=5;break;case"==":case"!=":case"===":case"!==":n=6;break;case"<":case">":case"<=":case">=":case"instanceof":n=7;break;case"in":n=t?7:0;break;case"<<":case">>":case">>>":n=8;break;case"+":case"-":n=9;break;case"*":case"/":case"%":n=11}return n}function oe(){var e,t,n,r,i,a,s,o,l,u;if(e=Pe,l=ae(),r=Pe,i=se(r,Ie.allowIn),0===i)return l;for(r.prec=i,P(),t=[e,Pe],s=ae(),a=[l,r,s];(i=se(Pe,Ie.allowIn))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)s=a.pop(),o=a.pop().value,l=a.pop(),t.pop(),n=new z(t[t.length-1]).finishBinaryExpression(o,l,s),a.push(n);r=P(),r.prec=i,a.push(r),t.push(Pe),n=ae(),a.push(n)}for(u=a.length-1,n=a[u],t.pop();u>1;)n=new z(t.pop()).finishBinaryExpression(a[u-1].value,a[u-2],n),u-=2;return n}function le(){var e,t,n,r,i;return i=Pe,e=oe(),G("?")&&(P(),t=Ie.allowIn,Ie.allowIn=!0,n=ue(),Ie.allowIn=t,F(":"),r=ue(),e=new z(i).finishConditionalExpression(e,n,r)),e}function ue(){var e,t,n,r;return e=Ie.parenthesisCount,r=Pe,t=Pe,n=le()}function de(){var e;if(e=ue(),G(","))throw new Error("Disabled.");return e}function ce(e){var t=de();return B(),e.finishExpressionStatement(t)}function fe(){var e,t,n=Pe.type;if(n===_e.EOF&&R(Pe),n===_e.Punctuator&&"{"===Pe.value)throw new Error("Disabled.");if(t=new D,n===_e.Punctuator)switch(Pe.value){case";":throw new Error("Disabled.");case"(":return ce(t)}else if(n===_e.Keyword)throw new Error("Disabled.");return e=de(),B(),t.finishExpressionStatement(e)}function he(){if(Pe.type===_e.Keyword)switch(Pe.value){case"const":case"let":throw new Error("Disabled.");case"function":throw new Error("Disabled.");default:return fe()}return Pe.type!==_e.EOF?fe():void 0}function pe(){for(var e,t,n,r,i=[];Ce>Le&&(t=Pe,t.type===_e.StringLiteral)&&(e=he(),i.push(e),e.expression.type===xe.Literal);)n=Se.slice(t.start+1,t.end-1),"use strict"===n?(Ae=!0,r&&U(r,ke.StrictOctalLiteral)):!r&&t.octal&&(r=t);for(;Ce>Le&&(e=he(),"undefined"!=typeof e);)i.push(e);return i}function me(){var e,t;return c(),I(),t=new D,Ae=!0,e=pe(),t.finishProgram(e)}function ge(){var e,t,n,r=[];for(e=0;e<Ne.tokens.length;++e)t=Ne.tokens[e],n={type:t.type,value:t.value},t.regex&&(n.regex={pattern:t.regex.pattern,flags:t.regex.flags}),Ne.range&&(n.range=t.range),Ne.loc&&(n.loc=t.loc),r.push(n);Ne.tokens=r}function ye(e,t){var n,r;n=String,"string"==typeof e||e instanceof String||(e=n(e)),Se=e,Le=0,Te=Se.length>0?1:0,Me=0,Ce=Se.length,Pe=null,Ie={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Ne={},t=t||{},t.tokens=!0,Ne.tokens=[],Ne.tokenize=!0,Ne.openParenToken=-1,Ne.openCurlyToken=-1,Ne.range="boolean"==typeof t.range&&t.range,Ne.loc="boolean"==typeof t.loc&&t.loc,"boolean"==typeof t.tolerant&&t.tolerant&&(Ne.errors=[]);try{if(I(),Pe.type===_e.EOF)return Ne.tokens;for(P();Pe.type!==_e.EOF;)try{P()}catch(i){if(Ne.errors){Ne.errors.push(i);break}throw i}ge(),r=Ne.tokens,"undefined"!=typeof Ne.errors&&(r.errors=Ne.errors)}catch(a){throw a}finally{Ne={}}return r}function ve(e,t){var n,r;r=String,"string"==typeof e||e instanceof String||(e=r(e)),Se=e,Le=0,Te=Se.length>0?1:0,Me=0,Ce=Se.length,Pe=null,Ie={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Ne={},"undefined"!=typeof t&&(Ne.range="boolean"==typeof t.range&&t.range,Ne.loc="boolean"==typeof t.loc&&t.loc,Ne.loc&&null!==t.source&&void 0!==t.source&&(Ne.source=r(t.source)),"boolean"==typeof t.tokens&&t.tokens&&(Ne.tokens=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(Ne.errors=[]));try{n=me(),"undefined"!=typeof Ne.tokens&&(ge(),n.tokens=Ne.tokens),"undefined"!=typeof Ne.errors&&(n.errors=Ne.errors)}catch(i){throw i}finally{Ne={}}return n}var _e,be,xe,we,ke,Ee,Se,Ae,Le,Te,Me,Ce,Pe,Ie,Ne;_e={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},be={},be[_e.BooleanLiteral]="Boolean",be[_e.EOF]="<end>",be[_e.Identifier]="Identifier",be[_e.Keyword]="Keyword",be[_e.NullLiteral]="Null",be[_e.NumericLiteral]="Numeric",be[_e.Punctuator]="Punctuator",be[_e.StringLiteral]="String",be[_e.RegularExpression]="RegularExpression",xe={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BinaryExpression:"BinaryExpression",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ExpressionStatement:"ExpressionStatement",Identifier:"Identifier",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression"},we={Data:1,Get:2,Set:4},ke={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},Ee={NonAsciiIdentifierStart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),NonAsciiIdentifierPart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԯԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠ-ࢲࣤ-ॣ०-९ॱ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟ෦-෯ෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤞᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧ᪰-᪽ᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶ᳸᳹ᴀ-᷵᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚝꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꧠ-ꧾꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︭︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")},z.prototype=D.prototype={finish:function(){Ne.range&&(this.range[1]=Le),Ne.loc&&(this.loc.end=new N,Ne.source&&(this.loc.source=Ne.source))},finishArrayExpression:function(e){return this.type=xe.ArrayExpression,this.elements=e,this.finish(),this},finishAssignmentExpression:function(e,t,n){return this.type=xe.AssignmentExpression,this.operator=e,this.left=t,this.right=n,this.finish(),this},finishBinaryExpression:function(e,t,n){return this.type="||"===e||"&&"===e?xe.LogicalExpression:xe.BinaryExpression,this.operator=e,this.left=t,this.right=n,this.finish(),this},finishCallExpression:function(e,t){return this.type=xe.CallExpression,this.callee=e,this.arguments=t,this.finish(),this},finishConditionalExpression:function(e,t,n){return this.type=xe.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=n,this.finish(),this},finishExpressionStatement:function(e){return this.type=xe.ExpressionStatement,this.expression=e,this.finish(),this},finishIdentifier:function(e){return this.type=xe.Identifier,this.name=e,this.finish(),this},finishLiteral:function(e){return this.type=xe.Literal,this.value=e.value,this.raw=Se.slice(e.start,e.end),e.regex&&("//"==this.raw&&(this.raw="/(?:)/"),this.regex=e.regex),this.finish(),this},finishMemberExpression:function(e,t,n){return this.type=xe.MemberExpression,this.computed="["===e,this.object=t,this.property=n,this.finish(),this},finishObjectExpression:function(e){return this.type=xe.ObjectExpression,this.properties=e,this.finish(),this},finishProgram:function(e){return this.type=xe.Program,this.body=e,this.finish(),this},finishProperty:function(e,t,n){return this.type=xe.Property,this.key=t,this.value=n,this.kind=e,this.finish(),this},finishUnaryExpression:function(e,t){return this.type="++"===e||"--"===e?xe.UpdateExpression:xe.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0,this.finish(),this}};var Oe={"if":1,"this":1};return{tokenize:ye,parse:ve}}()},{}],43:[function(e,t,n){function r(e,t,n,r){(t||[]).forEach(function(t,a){n[a]=n[a]||s(e),i(t,a,n[a],r)})}function i(e,t,n,r){void 0!==e.scale&&n.scale(r.scale(e.scale)),n.orient(e.orient||l[e.type]),n.offset(e.offset||0),n.layer(e.layer||"front"),n.grid(e.grid||!1),n.title(e.title||null),n.titleOffset(null!=e.titleOffset?e.titleOffset:o.axis.titleOffset),n.tickValues(e.values||null),n.tickFormat(e.format||null),n.tickSubdivide(e.subdivide||0),n.tickPadding(e.tickPadding||o.axis.padding);var i=[];if(void 0!==e.tickSize)for(var s=0;3>s;++s)i.push(e.tickSize);else{var u=o.axis.tickSize;i=[u,u,u]}null!=e.tickSizeMajor&&(i[0]=e.tickSizeMajor),null!=e.tickSizeMinor&&(i[1]=e.tickSizeMinor),null!=e.tickSizeEnd&&(i[2]=e.tickSizeEnd),i.length&&n.tickSize.apply(n,i),n.tickCount(e.ticks||o.axis.ticks);var d=e.properties;d&&d.ticks?(n.majorTickProperties(d.majorTicks?a.extend({},d.ticks,d.majorTicks):d.ticks),n.minorTickProperties(d.minorTicks?a.extend({},d.ticks,d.minorTicks):d.ticks)):(n.majorTickProperties(d&&d.majorTicks||{}),n.minorTickProperties(d&&d.minorTicks||{})),n.tickLabelProperties(d&&d.labels||{}),n.titleProperties(d&&d.title||{}),n.gridLineProperties(d&&d.grid||{}),n.domainProperties(d&&d.axis||{})}var a=e("datalib"),s=e("../scene/axis"),o=e("../util/config"),l={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};t.exports=r,r.schema={defs:{axis:{type:"object",properties:{type:{"enum":["x","y"]},scale:{type:"string"},orient:{"enum":["top","bottom","left","right"]},title:{type:"string"},titleOffset:{type:"number"},format:{type:"string"},ticks:{type:"number"},values:{type:"array",items:{type:["string","number"]}},subdivide:{type:"number"},tickPadding:{type:"number"},tickSize:{type:"number"},tickSizeMajor:{type:"number"},tickSizeMinor:{type:"number"},tickSizeEnd:{type:"number"},offset:{oneOf:[{type:"number"},{type:"object",properties:{scale:{type:"string"},value:{type:["string","number"]}},required:["scale","value"],additionalProperties:!1}]},layer:{"enum":["front","back"],"default":"front"},grid:{type:"boolean"},properties:{type:"object",properties:{ticks:{$ref:"#/defs/propset"},majorTicks:{$ref:"#/defs/propset"},minorTicks:{$ref:"#/defs/propset"},labels:{$ref:"#/defs/propset"},title:{$ref:"#/defs/propset"},grid:{$ref:"#/defs/propset"},axis:{$ref:"#/defs/propset"}},additionalProperties:!1}},additionalProperties:!1,required:["type","scale"]}}}},{"../scene/axis":80,"../util/config":107,datalib:20}],44:[function(e,t,n){(function(e){var n="undefined"!=typeof window?window.d3:"undefined"!=typeof e?e.d3:null;t.exports=function(e){return null==e?null:n.rgb(e)+""}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],45:[function(e,t,n){function r(e,t,n){function s(t){return function(r,a){r?i.error("LOADING FAILED: "+t.url+" "+r):e.data(t.name).values(i.read(a,t.format)),0===--o&&n()}}var o=0;return(t||[]).forEach(function(t){t.url&&(o+=1,i.load(i.extend({url:t.url},a.load),s(t))),r.datasource(e,t);

}),0===o&&setTimeout(n,1),t}var i=e("datalib"),a=e("../util/config"),s=e("./transforms"),o=e("./modify");r.datasource=function(e,t){var n=(t.transform||[]).map(function(t){return s(e,t)}),r=(t.modify||[]).map(function(n){return o(e,n,t)}),a=e.data(t.name,r.concat(n));return t.values?a.values(i.read(t.values,t.format)):t.source&&(a.source(t.source).revises(a.revises()).addListener(a),e.removeListener(a.pipeline()[0])),a},t.exports=r,r.schema={defs:{data:{title:"Input data set definition",type:"object",allOf:[{properties:{name:{type:"string"},transform:{$ref:"#/defs/transform"},format:{type:"object",oneOf:[{properties:{type:{"enum":["json"]},parse:{type:"object",additionalProperties:{"enum":["number","boolean","date","string"]}},property:{type:"string"}},additionalProperties:!1},{properties:{type:{"enum":["csv","tsv"]},parse:{type:"object",additionalProperties:{"enum":["number","boolean","date","string"]}}},additionalProperties:!1},{oneOf:[{properties:{type:{"enum":["topojson"]},feature:{type:"string"}},additionalProperties:!1},{properties:{type:{"enum":["topojson"]},mesh:{type:"string"}},additionalProperties:!1}]},{properties:{type:{"enum":["treejson"]},children:{type:"string"},parse:{type:"object",additionalProperties:{"enum":["number","boolean","date","string"]}}},additionalProperties:!1}]}},required:["name"]},{oneOf:[{properties:{source:{type:"string"}},required:["source"]},{properties:{values:{type:"array"}},required:["values"]},{properties:{url:{type:"string"}},required:["url"]}]}]}}}},{"../util/config":107,"./modify":53,"./transforms":60,datalib:20}],46:[function(e,t,n){function r(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n}function i(e,t,n,r,i,a){this.message=e,this.expected=t,this.found=n,this.offset=r,this.line=i,this.column=a,this.name="SyntaxError"}function a(e){function t(t){function n(t,n,r){var i,a;for(i=n;r>i;i++)a=e.charAt(i),"\n"===a?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===a||"\u2028"===a||"\u2029"===a?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return $e!==t&&($e>t&&($e=0,Ue={line:1,column:1,seenCR:!1}),n(Ue,$e,t),$e=t),Ue}function n(e){Re>ze||(ze>Re&&(Re=ze,Fe=[]),Fe.push(e))}function r(n,r,a){function s(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function n(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var r,i,a,s=new Array(e.length);for(a=0;a<e.length;a++)s[a]=e[a].description;return r=e.length>1?s.slice(0,-1).join(", ")+" or "+s[e.length-1]:s[0],i=t?'"'+n(t)+'"':"end of input","Expected "+r+" but "+i+" found."}var l=t(a),u=a<e.length?e.charAt(a):null;return null!==r&&s(r),new i(null!==n?n:o(r,u),r,u,a,l.line,l.column)}function a(){var e;return e=s()}function s(){var t,r,i,a,l,u;return t=ze,r=o(),r!==v?(i=m(),i!==v?(44===e.charCodeAt(ze)?(a=w,ze++):(a=v,0===Ve&&n(k)),a!==v?(l=m(),l!==v?(u=s(),u!==v?(qe=t,r=E(r,u),t=r):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x),t===v&&(t=ze,r=o(),r!==v&&(qe=t,r=S(r)),t=r),t}function o(){var t,r,i,a,s,u,d,c,f,h,p,g,y,_;return t=ze,91===e.charCodeAt(ze)?(r=A,ze++):(r=v,0===Ve&&n(L)),r!==v?(i=m(),i!==v?(a=l(),a!==v?(s=m(),s!==v?(44===e.charCodeAt(ze)?(u=w,ze++):(u=v,0===Ve&&n(k)),u!==v?(d=m(),d!==v?(c=l(),c!==v?(f=m(),f!==v?(93===e.charCodeAt(ze)?(h=T,ze++):(h=v,0===Ve&&n(M)),h!==v?(p=m(),p!==v?(62===e.charCodeAt(ze)?(g=C,ze++):(g=v,0===Ve&&n(P)),g!==v?(y=m(),y!==v?(_=o(),_!==v?(qe=t,r=I(a,c,_),t=r):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x),t===v&&(t=l()),t}function l(){var e,t,n,r;if(e=ze,t=u(),t!==v){if(n=[],r=h(),r!==v)for(;r!==v;)n.push(r),r=h();else n=x;n!==v?(qe=e,t=N(t,n),e=t):(ze=e,e=x)}else ze=e,e=x;return e===v&&(e=ze,t=u(),t!==v&&(qe=e,t=O(t)),e=t),e}function u(){var t,r,i,a;if(t=ze,r=d(),r===v&&(r=c()),r===v&&(r=j),r!==v?(i=f(),i!==v?(qe=t,r=D(r,i),t=r):(ze=t,t=x)):(ze=t,t=x),t===v){if(t=ze,r=[],z.test(e.charAt(ze))?(i=e.charAt(ze),ze++):(i=v,0===Ve&&n(q)),i!==v)for(;i!==v;)r.push(i),z.test(e.charAt(ze))?(i=e.charAt(ze),ze++):(i=v,0===Ve&&n(q));else r=x;r!==v&&(qe=t,r=$(r)),t=r,t===v&&(t=ze,40===e.charCodeAt(ze)?(r=U,ze++):(r=v,0===Ve&&n(R)),r!==v?(i=s(),i!==v?(41===e.charCodeAt(ze)?(a=F,ze++):(a=v,0===Ve&&n(V)),a!==v?(qe=t,r=G(i),t=r):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x))}return t}function d(){var t,r,i,a;return t=ze,46===e.charCodeAt(ze)?(r=W,ze++):(r=v,0===Ve&&n(B)),r!==v?(i=p(),i!==v?(58===e.charCodeAt(ze)?(a=H,ze++):(a=v,0===Ve&&n(Y)),a!==v?(qe=t,r=X(i),t=r):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x),t}function c(){var t,r,i,a;return t=ze,35===e.charCodeAt(ze)?(r=K,ze++):(r=v,0===Ve&&n(J)),r!==v?(i=p(),i!==v?(58===e.charCodeAt(ze)?(a=H,ze++):(a=v,0===Ve&&n(Y)),a!==v?(qe=t,r=Q(i),t=r):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x),t}function f(){var t;return e.substr(ze,9)===Z?(t=Z,ze+=9):(t=v,0===Ve&&n(ee)),t===v&&(e.substr(ze,7)===te?(t=te,ze+=7):(t=v,0===Ve&&n(ne)),t===v&&(e.substr(ze,5)===re?(t=re,ze+=5):(t=v,0===Ve&&n(ie)),t===v&&(e.substr(ze,8)===ae?(t=ae,ze+=8):(t=v,0===Ve&&n(se)),t===v&&(e.substr(ze,5)===oe?(t=oe,ze+=5):(t=v,0===Ve&&n(le)),t===v&&(e.substr(ze,7)===ue?(t=ue,ze+=7):(t=v,0===Ve&&n(de)),t===v&&(e.substr(ze,8)===ce?(t=ce,ze+=8):(t=v,0===Ve&&n(fe)),t===v&&(e.substr(ze,5)===he?(t=he,ze+=5):(t=v,0===Ve&&n(pe)),t===v&&(e.substr(ze,10)===me?(t=me,ze+=10):(t=v,0===Ve&&n(ge)),t===v&&(e.substr(ze,9)===ye?(t=ye,ze+=9):(t=v,0===Ve&&n(ve)),t===v&&(e.substr(ze,8)===_e?(t=_e,ze+=8):(t=v,0===Ve&&n(be)),t===v&&(e.substr(ze,9)===xe?(t=xe,ze+=9):(t=v,0===Ve&&n(we)),t===v&&(e.substr(ze,10)===ke?(t=ke,ze+=10):(t=v,0===Ve&&n(Ee)),t===v&&(e.substr(ze,10)===Se?(t=Se,ze+=10):(t=v,0===Ve&&n(Ae)),t===v&&(e.substr(ze,9)===Le?(t=Le,ze+=9):(t=v,0===Ve&&n(Te)),t===v&&(e.substr(ze,8)===Me?(t=Me,ze+=8):(t=v,0===Ve&&n(Ce))))))))))))))))),t}function h(){var t,r,i,a;return t=ze,91===e.charCodeAt(ze)?(r=A,ze++):(r=v,0===Ve&&n(L)),r!==v?(i=p(),i!==v?(93===e.charCodeAt(ze)?(a=T,ze++):(a=v,0===Ve&&n(M)),a!==v?(qe=t,r=Pe(i),t=r):(ze=t,t=x)):(ze=t,t=x)):(ze=t,t=x),t}function p(){var t,r,i;if(t=ze,r=[],Ie.test(e.charAt(ze))?(i=e.charAt(ze),ze++):(i=v,0===Ve&&n(Ne)),i!==v)for(;i!==v;)r.push(i),Ie.test(e.charAt(ze))?(i=e.charAt(ze),ze++):(i=v,0===Ve&&n(Ne));else r=x;return r!==v&&(qe=t,r=Oe(r)),t=r}function m(){var t,r;for(t=[],je.test(e.charAt(ze))?(r=e.charAt(ze),ze++):(r=v,0===Ve&&n(De));r!==v;)t.push(r),je.test(e.charAt(ze))?(r=e.charAt(ze),ze++):(r=v,0===Ve&&n(De));return t}var g,y=arguments.length>1?arguments[1]:{},v={},_={start:a},b=a,x=v,w=",",k={type:"literal",value:",",description:'","'},E=function(e,t){return[e].concat(t)},S=function(e){return[e]},A="[",L={type:"literal",value:"[",description:'"["'},T="]",M={type:"literal",value:"]",description:'"]"'},C=">",P={type:"literal",value:">",description:'">"'},I=function(e,t,n){return{start:e,end:t,middle:n}},N=function(e,t){return e.filters=t,e},O=function(e){return e},j=null,D=function(e,t){return{event:t,target:e}},z=/^[:a-zA-z0-9_\-]/,q={type:"class",value:"[:a-zA-z0-9_\\-]",description:"[:a-zA-z0-9_\\-]"},$=function(e){return{signal:e.join("")}},U="(",R={type:"literal",value:"(",description:'"("'},F=")",V={type:"literal",value:")",description:'")"'},G=function(e){return{stream:e}},W=".",B={type:"literal",value:".",description:'"."'},H=":",Y={type:"literal",value:":",description:'":"'},X=function(e){return{type:"class",value:e}},K="#",J={type:"literal",value:"#",description:'"#"'},Q=function(e){return{type:"id",value:e}},Z="mousedown",ee={type:"literal",value:"mousedown",description:'"mousedown"'},te="mouseup",ne={type:"literal",value:"mouseup",description:'"mouseup"'},re="click",ie={type:"literal",value:"click",description:'"click"'},ae="dblclick",se={type:"literal",value:"dblclick",description:'"dblclick"'},oe="wheel",le={type:"literal",value:"wheel",description:'"wheel"'},ue="keydown",de={type:"literal",value:"keydown",description:'"keydown"'},ce="keypress",fe={type:"literal",value:"keypress",description:'"keypress"'},he="keyup",pe={type:"literal",value:"keyup",description:'"keyup"'},me="mousewheel",ge={type:"literal",value:"mousewheel",description:'"mousewheel"'},ye="mousemove",ve={type:"literal",value:"mousemove",description:'"mousemove"'},_e="mouseout",be={type:"literal",value:"mouseout",description:'"mouseout"'},xe="mouseover",we={type:"literal",value:"mouseover",description:'"mouseover"'},ke="mouseenter",Ee={type:"literal",value:"mouseenter",description:'"mouseenter"'},Se="touchstart",Ae={type:"literal",value:"touchstart",description:'"touchstart"'},Le="touchmove",Te={type:"literal",value:"touchmove",description:'"touchmove"'},Me="touchend",Ce={type:"literal",value:"touchend",description:'"touchend"'},Pe=function(e){return e},Ie=/^['"a-zA-Z0-9_.><=! \t\-]/,Ne={type:"class",value:"['\"a-zA-Z0-9_.><=! \\t\\-]",description:"['\"a-zA-Z0-9_.><=! \\t\\-]"},Oe=function(e){return e.join("")},je=/^[ \t\r\n]/,De={type:"class",value:"[ \\t\\r\\n]",description:"[ \\t\\r\\n]"},ze=0,qe=0,$e=0,Ue={line:1,column:1,seenCR:!1},Re=0,Fe=[],Ve=0;if("startRule"in y){if(!(y.startRule in _))throw new Error("Can't start parsing from rule \""+y.startRule+'".');b=_[y.startRule]}if(g=b(),g!==v&&ze===e.length)return g;throw g!==v&&ze<e.length&&n({type:"end",description:"end of input"}),r(null,Fe,Re)}r(i,Error),t.exports={SyntaxError:i,parse:a}},{}],47:[function(e,t,n){var r=e("datalib"),i=e("../expression"),a=function(){var e=i.parse,t=i.code({idWhiteList:["d","e","i","p","sg"]});return function(n){var r=t(e(n));return r.fn=Function("d","e","i","p","sg",'"use strict"; return ('+r.fn+");"),r}}();a.eval=function(e,t,n,i,a,s,o){return o=e.signalValues(r.array(o)),t.call(null,n,i,a,s,o)},t.exports=a},{"../expression":41,datalib:20}],48:[function(e,t,n){t.exports={axes:e("./axes"),background:e("./background"),data:e("./data"),events:e("./events"),expr:e("./expr"),interactors:e("./interactors"),legends:e("./legends"),mark:e("./mark"),marks:e("./marks"),modify:e("./modify"),padding:e("./padding"),predicates:e("./predicates"),properties:e("./properties"),signals:e("./signals"),spec:e("./spec"),streams:e("./streams"),transforms:e("./transforms")}},{"./axes":43,"./background":44,"./data":45,"./events":46,"./expr":47,"./interactors":49,"./legends":50,"./mark":51,"./marks":52,"./modify":53,"./padding":54,"./predicates":55,"./properties":56,"./signals":57,"./spec":58,"./streams":59,"./transforms":60}],49:[function(e,t,n){var r=e("datalib"),i=e("../util/config"),a=e("../util/constants");t.exports=function(e,t,n){function s(e){return function(t,n){if(t)r.error("LOADING FAILED: "+e.url);else{var i=r.isObject(n)?n:JSON.parse(n);o(e.name,i)}0==--g&&l()}}function o(e,t){y={},v={},t.signals&&b.push.apply(b,c(e,t.signals)),t.predicates&&x.push.apply(x,f(e,t.predicates)),p(e,t.marks)}function l(){r.keys(_).length>0&&u(t.marks),t.signals=r.array(t.signals),t.predicates=r.array(t.predicates),t.signals.unshift.apply(t.signals,b),t.predicates.unshift.apply(t.predicates,x),n()}function u(e){var t,n,i,s;for(e=r.array(e),i=0,s=e.length;s>i;i++)t=e[i],(n=_[t.type])?(e[i]=r.duplicate(n),t.from&&(e[i].from=t.from),t.properties&&[a.ENTER,a.UPDATE,a.EXIT].forEach(function(a){e[i].properties[a]=r.extend(n.properties[a],t.properties[a])})):t.marks&&u(t.marks)}function d(e,t){return r.isString(t)?t+"_"+e:(r.keys(t).forEach(function(n){var r=new RegExp("\\b"+n+"\\b","g");e=e.replace(r,t[n])}),e)}function c(e,t){return t=r.array(t),t.forEach(function(t){t.name=y[t.name]=d(t.name,e)}),t.forEach(function(e){(e.streams||[]).forEach(function(e){e.type=d(e.type,y),e.expr=d(e.expr,y)})}),t}function f(e,t){return t=r.array(t),t.forEach(function(t){t.name=v[t.name]=d(t.name,e),[t.operands,t.range].forEach(function(e){(e||[]).forEach(function(e){e.signal?e.signal=d(e.signal,y):e.predicate&&h(e)})})}),t}function h(e){e.predicate=v[e.predicate],r.keys(e.input).forEach(function(t){var n=e.input[t];n.signal&&(n.signal=d(n.signal,y))})}function p(e,t){(t||[]).forEach(function(t){m(t.properties.enter),m(t.properties.update),m(t.properties.exit),_[d(t.name,e)]=t})}function m(e){r.keys(e).forEach(function(t){var n=e[t];n.signal?n.signal=d(n.signal,y):n.rule&&n.rule.forEach(function(e){e.signal&&(e.signal=d(e.signal,y)),e.predicate&&h(e)})})}var g=0,y={},v={},_={},b=[],x=[];return(t.interactors||[]).forEach(function(e){e.url&&(g+=1,r.load(r.extend({url:e.url},i.load),s(e)))}),0===g&&setTimeout(l,1),t}},{"../util/config":107,"../util/constants":108,datalib:20}],50:[function(e,t,n){function r(e,t,n,r){(t||[]).forEach(function(t,s){n[s]=n[s]||a(e),i(t,s,n[s],r)})}function i(e,t,n,r){n.size(e.size?r.scale(e.size):null),n.shape(e.shape?r.scale(e.shape):null),n.fill(e.fill?r.scale(e.fill):null),n.stroke(e.stroke?r.scale(e.stroke):null),e.orient&&n.orient(e.orient),null!=e.offset&&n.offset(e.offset),n.title(e.title||null),n.values(e.values||null),n.format(void 0!==e.format?e.format:null);var i=e.properties;n.titleProperties(i&&i.title||{}),n.labelProperties(i&&i.labels||{}),n.legendProperties(i&&i.legend||{}),n.symbolProperties(i&&i.symbols||{}),n.gradientProperties(i&&i.gradient||{})}{var a=e("../scene/legend");e("../util/config")}t.exports=r,r.schema={defs:{legend:{type:"object",properties:{size:{type:"string"},shape:{type:"string"},fill:{type:"string"},stroke:{type:"string"},orient:{"enum":["left","right"],"default":"right"},title:{type:"string"},format:{type:"string"},values:{type:"array"},properties:{type:"object",properties:{title:{$ref:"#/defs/propset"},labels:{$ref:"#/defs/propset"},symbols:{$ref:"#/defs/propset"},gradient:{$ref:"#/defs/propset"},legend:{$ref:"#/defs/propset"}},additionalProperties:!1}},additionalProperties:!1,anyOf:[{required:"size"},{required:"shape"},{required:"fill"},{required:"stroke"}]}}}},{"../scene/legend":81,"../util/config":107}],51:[function(e,t,n){function r(e,t){var n=t.properties,s=t.marks;return i.keys(n).forEach(function(r){n[r]=a(e,t.type,n[r])}),t.delay&&(t.delay=a(e,t.type,{delay:t.delay})),s&&(t.marks=s.map(function(t){return r(e,t)})),t}var i=e("datalib"),a=e("./properties");t.exports=r,r.schema={defs:{mark:{type:"object",properties:{name:{type:"string"},key:{type:"string"},type:{"enum":["rect","symbol","path","arc","area","line","rule","image","text","group"]},from:{type:"object",properties:{data:{type:"string"},mark:{type:"string"},transform:{$ref:"#/defs/transform"}},oneOf:[{required:["data"]},{required:["mark"]}],additionalProperties:!1},delay:{$ref:"#/refs/numberValue"},ease:{"enum":["linear","quad","cubic","sin","exp","circle","bounce"].reduce(function(e,t){return["in","out","in-out","out-in"].forEach(function(n){e.push(t+"-"+n)}),e},[])},properties:{type:"object",properties:{enter:{$ref:"#/defs/propset"},update:{$ref:"#/defs/propset"},exit:{$ref:"#/defs/propset"}},additionalProperties:!1,anyOf:[{required:["enter"]},{required:["update"]}]}},additionalProperties:!1,required:["type"]}}}},{"./properties":56,datalib:20}],52:[function(e,t,n){function r(e,t,n,r){return{type:"group",width:n,height:r,scales:t.scales||[],axes:t.axes||[],legends:t.legends||[],marks:(t.marks||[]).map(function(t){return i(e,t)})}}var i=e("./mark");t.exports=r,r.schema={defs:{container:{type:"object",properties:{axes:{type:"array",items:{$ref:"#/defs/axis"}},legends:{type:"array",items:{$ref:"#/defs/legend"}},marks:{type:"array",items:{anyOf:[{$ref:"#/defs/groupMark"},{$ref:"#/defs/mark"}]}}}},groupMark:{allOf:[{$ref:"#/defs/mark"},{$ref:"#/defs/container"},{properties:{type:{"enum":["group"]}},required:["type"]}]}}}},{"./mark":51}],53:[function(e,t,n){var r=e("datalib"),i=e("../dataflow/Node"),a=e("../dataflow/tuple"),s=e("../util/debug"),o=e("../util/constants"),l=function(e,t,n,r){for(var i=n.length-1;i>=0;--i)n[i][e]==t&&r.push.apply(r,n.splice(i,1))};t.exports=function(e,t,n){var u=t.signal?r.field(t.signal):null,d=u?u[0]:null,c=t.predicate?e.predicate(t.predicate.name||t.predicate):null,f=null===c,h=new i(e).router(t.type===o.CLEAR);return h.evaluate=function(r){if(null!==c){var i=e.dataValues(c.data||[]);f=c.call(c,{},i,e.signalValues(c.signals||[]),e._predicates)}if(s(r,[t.type+"ing",f]),!f)return r;var d={},h=u?e.signalRef(t.signal):null,p=e.data(n.name),m=p.revises()?null:void 0,g=null;if(d[t.field]=h,t.type===o.ADD)g=a.ingest(d,m),r.add.push(g),p._data.push(g);else if(t.type===o.REMOVE)l(t.field,h,r.add,r.rem),l(t.field,h,r.mod,r.rem),p._data=p._data.filter(function(e){return e[t.field]!==h});else if(t.type===o.TOGGLE){var y=[],v=[];l(t.field,h,r.rem,y),l(t.field,h,r.add,v),l(t.field,h,r.mod,v),0==y.length&&0==v.length&&y.push(a.ingest(d)),r.add.push.apply(r.add,y),p._data.push.apply(p._data,y),r.rem.push.apply(r.rem,v),p._data=p._data.filter(function(e){return-1===v.indexOf(e)})}else t.type===o.CLEAR&&(r.rem.push.apply(r.rem,r.add),r.rem.push.apply(r.rem,r.mod),r.add=[],r.mod=[],p._data=[]);return r.fields[t.field]=1,r},d&&h.dependency(o.SIGNALS,d),c&&h.dependency(o.SIGNALS,c.signals),h}},{"../dataflow/Node":34,"../dataflow/tuple":37,"../util/constants":108,"../util/debug":109,datalib:20}],54:[function(e,t,n){var r=e("datalib");t.exports=function(e){if(null==e)return"auto";if(r.isString(e))return"strict"===e?"strict":"auto";if(r.isObject(e))return e;var t=r.isNumber(e)?e:20;return{top:t,left:t,right:t,bottom:t}}},{datalib:20}],55:[function(e,t,n){var r=e("datalib");t.exports=function(e,t){function n(e,t){var n=r.field(e),i="signals["+n.map(r.str).join("][")+"]";return t[n.shift()]=1,i}function i(t){var i=[],a=[],s={},o={};return r.array(t).forEach(function(t,l){var u="o"+l,d="";if(void 0!==t.value)d=r.str(t.value);else if(t.arg)d="args["+r.str(t.arg)+"]";else if(t.signal)d=n(t.signal,s);else if(t.predicate){var c=t.predicate,f=c&&(c.name||c),h=e.predicate(f),p="predicates["+r.str(f)+"]";h.signals.forEach(function(e){s[e]=1}),h.data.forEach(function(e){o[e]=1}),r.isObject(c)&&r.keys(c).forEach(function(e){if("name"!==e){var t=c[e];d+="args["+r.str(e)+"] = ",t.signal?d+=n(t.signal,s):t.arg&&(d+="args["+r.str(t.arg)+"]"),d+=", "}}),d+=p+".call("+p+", args, db, signals, predicates)"}i.push(u),a.push(u+"=("+d+")")}),{code:"var "+i.join(", ")+";\n"+a.join(";\n")+";\n",signals:r.keys(s),data:r.keys(o)}}function a(e){var t=i(e.operands);return"="==e.type&&(e.type="=="),{code:t.code+"return "+["o0","o1"].join(e.type)+";",signals:t.signals,data:t.data}}function s(e){for(var t=i(e.operands),n=[],r=0,a=e.operands.length;n.push("o"+r++)<a;);return"and"==e.type?e.type="&&":"or"==e.type&&(e.type="||"),{code:t.code+"return "+n.join(e.type)+";",signals:t.signals,data:t.data}}function o(e){var t=[e.item],n="";e.range&&t.push.apply(t,e.range),e.scale&&(n=l(e.scale,t));var a=i(t);if(n=a.code+n,e.data){var s=r.field(e.field).map(r.str);n+="var where = function(d) { return d["+s.join("][")+"] == o0 };\n",n+="return db["+r.str(e.data)+"].filter(where).length > 0;"}else e.range&&(e.scale&&(n+="o1 = scale(o1);\no2 = scale(o2);\n"),n+="return o1 < o2 ? o1 <= o0 && o0 <= o2 : o2 <= o0 && o0 <= o1");return{code:n,signals:a.signals,data:a.data.concat(e.data?[e.data]:[])}}function l(e,t){var n="var scale = ",i=t.length;return r.isString(e)?(t.push({value:e}),n+="this.root().scale(o"+i+")"):e.arg?(t.push(e),n+="o"+i):e.name&&(t.push(r.isString(e.name)?{value:e.name}:e.name),n+="(this.isFunction(o"+i+") ? o"+i+" : ",e.scope?(t.push(e.scope),n+="(o"+(i+1)+".scale || this.root().scale)(o"+i+")"):n+="this.root().scale(o"+i+")",n+=")"),e.invert===!0&&(n+=".invert"),n+";\n"}var u={"=":a,"==":a,"!=":a,">":a,">=":a,"<":a,"<=":a,and:s,"&&":s,or:s,"||":s,"in":o};return(t||[]).forEach(function(t){var n=u[t.type](t),i=Function("args","db","signals","predicates",n.code);i.root=function(){return e.scene().items[0]},i.isFunction=r.isFunction,i.signals=n.signals,i.data=n.data,e.predicate(t.name,i)}),t}},{datalib:20}],56:[function(e,t,n){(function(n){function r(e,t,n){var r,o,l,u,d="",p=c.keys(n),g={},y={signals:{},scales:{},data:{},fields:{},reflow:!1};for(d+="var o = trans ? {} : item;\n",r=0,o=p.length;o>r;++r)u=n[l=p[r]],d+=r>0?"\n  ":"  ",u.rule?(u=a(e,l,u.rule),d+="\n  "+u.code):(u=s(l,u),d+="this.tpl.set(o, "+c.str(l)+", "+u.val+");"),g[l]=!0,m.forEach(function(e){null!=u[e]&&c.array(u[e]).forEach(function(t){y[e][t]=1})}),y.reflow=y.reflow||u.reflow;g.x2&&(g.x?(d+="\n  if (o.x > o.x2) { var t = o.x;this.tpl.set(o, 'x', o.x2);this.tpl.set(o, 'x2', t); };",d+="\n  this.tpl.set(o, 'width', (o.x2 - o.x));"):d+=g.width?"\n  this.tpl.set(o, 'x', (o.x2 - o.width));":"\n  this.tpl.set(o, 'x', o.x2);"),g.xc&&(d+=g.width?"\n  this.tpl.set(o, 'x', (o.xc - o.width/2));":"\n  this.tpl.set(o, 'x', o.xc);"),g.y2&&(g.y?(d+="\n  if (o.y > o.y2) { var t = o.y;this.tpl.set(o, 'y', o.y2);this.tpl.set(o, 'y2', t);};",d+="\n  this.tpl.set(o, 'height', (o.y2 - o.y));"):d+=g.height?"\n  this.tpl.set(o, 'y', (o.y2 - o.height));":"\n  this.tpl.set(o, 'y', o.y2);"),g.yc&&(d+=g.height?"\n  this.tpl.set(o, 'y', (o.yc - o.height/2));":"\n  this.tpl.set(o, 'y', o.yc);"),i(t,g)&&(d+="\n  item.touch();"),d+="\n  if (trans) trans.interpolate(item, o);";try{var v=Function("item","group","trans","db","signals","predicates",d);return v.tpl=h,v.util=c,v.d3=f,{encode:v,signals:c.keys(y.signals),scales:c.keys(y.scales),data:c.keys(y.data),fields:c.keys(y.fields),reflow:y.reflow}}catch(_){c.error(_),c.log(d)}}function i(e,t){return t.path||("area"===e||"line"===e)&&(t.x||t.x2||t.width||t.y||t.y2||t.height||t.tension||t.interpolate)}function a(e,t,n){var r=[],i=[],a=[],o=[],l="";return(n||[]).forEach(function(u,d){var f,h=u.predicate,p=h&&(h.name||h),m=e.predicate(p),g="predicates["+c.str(p)+"]",y=[],v=t+"_arg"+d;c.isObject(h)&&c.keys(h).forEach(function(e){if("name"!==e){var t=s(d,h[e]);y.push(c.str(e)+": "+t.val),t.signals&&r.push.apply(r,c.array(t.signals)),t.scales&&i.push.apply(i,c.array(t.scales))}}),f=s(t,u),f.signals&&r.push.apply(r,c.array(f.signals)),f.scales&&i.push.apply(i,c.array(f.scales)),p?(r.push.apply(r,m.signals),a.push.apply(a,m.data),o.push(v+" = {"+y.join(", ")+"}"),l+="if("+g+".call("+g+","+v+", db, signals, predicates)) {\n    this.tpl.set(o, "+c.str(t)+", "+f.val+");\n",l+=n[d+1]?"  } else ":"  }"):l+="{\n    this.tpl.set(o, "+c.str(t)+", "+f.val+");\n  }"}),l="var "+o.join(",\n      ")+";\n  "+l,{code:l,signals:r,scales:i,data:a}}function s(e,t){if(null==t)return null;if("fill"===e||"stroke"===e){if(t.c)return o("hcl",t.h,t.c,t.l);if(t.h||t.s)return o("hsl",t.h,t.s,t.l);if(t.l||t.a)return o("lab",t.l,t.a,t.b);if(t.r||t.g||t.b)return o("rgb",t.r,t.g,t.b)}var n=null,r=null,i={},a={},s={},d=[],f=[],h=!1;return void 0!==t.template&&(n=c.template.source(t.template,"item.datum")),void 0!==t.value&&(n=c.str(t.value)),void 0!==t.signal&&(i=c.field(t.signal),n="signals["+i.map(c.str).join("][")+"]",d.push(i.shift())),void 0!==t.field&&(t.field=c.isString(t.field)?{datum:t.field}:t.field,a=l(t.field),n=a.val),void 0!==t.scale&&(s=u(t.scale),r=s.val,n=null!==n||t.band||t.mult||t.offset?r+(t.band?".rangeBand()":"("+(null!==n?n:"item.datum.data")+")"):r),n="("+(t.mult?c.number(t.mult)+" * ":"")+n+")"+(t.offset?" + "+c.number(t.offset):""),{val:n,signals:d.concat(c.array(a.signals)).concat(c.array(s.signals)),fields:f.concat(c.array(a.fields)).concat(c.array(s.fields)),scales:t.scale?t.scale.name||t.scale:null,reflow:h||a.reflow||s.reflow}}function o(e,t,n,r){var i=t?s("",t):p.color[e][0],a=n?s("",n):p.color[e][1],o=r?s("",r):p.color[e][2];return signals=[],scales=[],[i,a,o].forEach(function(e){e.signals&&signals.push.apply(signals,e.signals),e.scales&&scales.push(e.scales)}),{val:"(this.d3."+e+"("+[i.val,a.val,o.val].join(",")+') + "")',signals:signals,scales:scales}}function l(e){if(c.isString(e))return{val:c.field(e).map(c.str).join("][")};var t=e.level,n=(e.group||e.parent)&&t,r=n?Array(t).join("group.mark."):"",i=l(e.datum||e.group||e.parent||e.signal),a=i.val,s=i.fields||[],o=i.signals||[],u=i.reflow||!1;return e.datum?(a="item.datum["+a+"]",s.push(e.datum)):e.group?(a=r+"group["+a+"]",u=!0):e.parent?(a=r+"group.datum["+a+"]",u=!0):e.signal&&(a="signals["+a+"]",o.push(c.field(e.signal)[0]),u=!0),{val:a,fields:s,signals:o,reflow:u}}function u(e){var t=null,n=null;return t=c.isString(e)?c.str(e):e.name?c.isString(e.name)?c.str(e.name):(n=l(e.name)).val:(n=l(e)).val,t="group.scale("+t+")",e.invert&&(t+=".invert"),n?(n.val=t,n):{val:t}}function d(e){return e=c.isArray(e)?{"enum":e}:{type:e},{type:"object",allOf:[{$ref:"#/refs/valueModifiers"},{oneOf:[{$ref:"#/refs/signal",required:["signal"]},{properties:{value:e},required:["value"]},{properties:{field:{$ref:"#/refs/field"}},required:["field"]}]}]}}var c=e("datalib"),f="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,h=e("../dataflow/tuple"),p=e("../util/config"),m=["signals","scales","data","fields"];t.exports=r,r.schema={refs:{signal:{title:"SignalRef",type:"object",properties:{signal:{type:"string"}},required:["signal"]},field:{title:"FieldRef",oneOf:[{type:"string"},{oneOf:[{$ref:"#/refs/signal"},{type:"object",properties:{datum:{$ref:"#/refs/field"}},required:["datum"],additionalProperties:!1},{type:"object",properties:{group:{$ref:"#/refs/field"},level:{type:"number"}},required:["group"],additionalProperties:!1},{type:"object",properties:{parent:{$ref:"#/refs/field"},level:{type:"number"}},required:["parent"],additionalProperties:!1}]}]},scale:{title:"ScaleRef",oneOf:[{$ref:"#/refs/field"},{type:"object",properties:{name:{$ref:"#/refs/field"},invert:{type:"boolean","default":!1}}}]},valueModifiers:{properties:{mult:{type:"number"},offset:{type:"number"},scale:{$ref:"#/refs/scale"},band:{type:"boolean"}}},value:d({}),numberValue:d("number"),stringValue:d("string"),booleanValue:d("boolean"),arrayValue:d("array"),colorValue:{title:"ColorRef",oneOf:[{$ref:"#/refs/stringValue"},{type:"object",properties:{r:{$ref:"#/refs/numberValue"},g:{$ref:"#/refs/numberValue"},b:{$ref:"#/refs/numberValue"}},required:["r","g","b"]},{type:"object",properties:{h:{$ref:"#/refs/numberValue"},s:{$ref:"#/refs/numberValue"},l:{$ref:"#/refs/numberValue"}},required:["h","s","l"]},{type:"object",properties:{l:{$ref:"#/refs/numberValue"},a:{$ref:"#/refs/numberValue"},b:{$ref:"#/refs/numberValue"}},required:["l","a","b"]},{type:"object",properties:{h:{$ref:"#/refs/numberValue"},c:{$ref:"#/refs/numberValue"},l:{$ref:"#/refs/numberValue"}},required:["h","c","l"]}]}},defs:{propset:{title:"Mark property set",type:"object",properties:{x:{$ref:"#/refs/numberValue"},x2:{$ref:"#/refs/numberValue"},width:{$ref:"#/refs/numberValue"},y:{$ref:"#/refs/numberValue"},y2:{$ref:"#/refs/numberValue"},height:{$ref:"#/refs/numberValue"},opacity:{$ref:"#/refs/numberValue"},fill:{$ref:"#/refs/colorValue"},fillOpacity:{$ref:"#/refs/numberValue"},stroke:{$ref:"#/refs/colorValue"},strokeWidth:{$ref:"#/refs/numberValue"},strokeOpacity:{$ref:"#/refs/numberValue"},strokeDash:{$ref:"#/refs/arrayValue"},strokeDashOffset:{$ref:"#/refs/numberValue"},size:{$ref:"#/refs/numberValue"},shape:d(["circle","square","cross","diamond","triangle-up","triangle-down"]),path:{$ref:"#/refs/stringValue"},innerRadius:{$ref:"#/refs/numberValue"},outerRadius:{$ref:"#/refs/numberValue"},startAngle:{$ref:"#/refs/numberValue"},endAngle:{$ref:"#/refs/numberValue"},interpolate:d(["linear","step-before","step-after","basis","basis-open","cardinal","cardinal-open","monotone"]),tension:{$ref:"#/refs/numberValue"},url:{$ref:"#/refs/stringValue"},align:d(["left","right","center"]),baseline:d(["top","middle","bottom"]),text:{$ref:"#/refs/stringValue"},dx:{$ref:"#/refs/numberValue"},dy:{$ref:"#/refs/numberValue"},radius:{$ref:"#/refs/numberValue"},theta:{$ref:"#/refs/numberValue"},angle:{$ref:"#/refs/numberValue"},font:{$ref:"#/refs/stringValue"},fontSize:{$ref:"#/refs/numberValue"},fontWeight:{$ref:"#/refs/numberValue"},fontStyle:{$ref:"#/refs/stringValue"}},additionalProperties:!1}}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":37,"../util/config":107,datalib:20}],57:[function(e,t,n){function r(e,t){return(t||[]).forEach(function(t){var n=e.signal(t.name,t.init);t.init&&t.init.expr&&(t.init.expr=a(t.init.expr),n.value(i(e,t.init))),t.expr&&(t.expr=a(t.expr),n.evaluate=function(r){var a=i(e,t);return a!==n.value()?(n.value(a),r.signals[t.name]=1,r):e.doNotPropagate},n.dependency(s.SIGNALS,t.expr.signals),t.expr.signals.forEach(function(t){e.signal(t).addListener(n)}))}),t}function i(e,t){var n=t.expr,r=a.eval(e,n.fn,null,null,null,null,n.signals);return t.scale?scale(e,t,r):r}var a=e("./expr"),s=e("../util/constants");r.scale=function o(e,t,n){var r=t.scale,i=r.name||r.signal||r,a=r.scope?e.signalRef(r.scope.signal):null;a&&a.scale||(a=a&&a.mark?a.mark.group:e.scene().items[0]);var o=a.scale(i);return o?r.invert?o.invert(n):o(n):n},t.exports=r},{"../util/constants":108,"./expr":47}],58:[function(e,t,n){function r(e,t,n){e=i.duplicate(e),n=n||s.factory;var r=e.width||500,p=e.height||500,m=e.viewport||null,g=new a;h(g,e,function(){g.defs({width:r,height:p,viewport:m,background:o(e.background),padding:l(e.padding),signals:d(g,e.signals),predicates:c(g,e.predicates),marks:u(g,e,r,p),data:f(g,e.data,function(){t(n(g))})})})}var i=e("datalib"),a=e("../core/Model"),s=e("../core/View"),o=e("../parse/background"),l=e("../parse/padding"),u=e("../parse/marks"),d=e("../parse/signals"),c=e("../parse/predicates"),f=e("../parse/data"),h=e("../parse/interactors");t.exports=r,r.schema={defs:{spec:{title:"Vega visualization specification",type:"object",allOf:[{$ref:"#/defs/container"},{properties:{data:{type:"array",items:{$ref:"#/defs/data"}}}}]}}}},{"../core/Model":29,"../core/View":30,"../parse/background":44,"../parse/data":45,"../parse/interactors":49,"../parse/marks":52,"../parse/padding":54,"../parse/predicates":55,"../parse/signals":57,datalib:20}],59:[function(e,t,n){(function(n){var r=e("datalib"),i="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,a=e("../dataflow/Node"),s=e("./signals"),o=e("../dataflow/changeset"),l=e("./events"),u=e("./expr"),d=e("../util/constants"),c="start",f="middle",h="end";t.exports=function(e){function t(e,t,n,r){var i=new a(g);i.evaluate=function(i){if(!i.signals[t.signal])return g.doNotPropagate;var a=u.eval(g,n.fn,null,null,null,null,n.signals);return r.scale&&(a=s.scale(g,r,a)),a!==e.value()&&(e.value(a),i.signals[e.name()]=1,i.reflow=!0),i},i.dependency(d.SIGNALS,t.signal),i.addListener(e),g.signal(t.signal).addListener(i)}function n(e,t,n,i){var s=t.filters||[],o=t.target;o&&s.push("i."+o.type+"=="+r.str(o.value)),v[t.event]=v[t.event]||[],v[t.event].push({signal:e,exp:n,filters:s.map(function(e){return u(e)}),spec:i}),_[t.event]=_[t.event]||new a(g),_[t.event].addListener(e)}function p(e,r,i,s){var o=e.name(),l=u("true"),d={};d[c]=g.signal(o+c,!1),d[f]=g.signal(o+f,!1),d[h]=g.signal(o+h,!1);var p=new a(g);p.evaluate=function(t){return d[c].value()===!0&&d[h].value()===!1?t.signals[o+c]?g.doNotPropagate:(d[f].value()!==e.value()&&(e.value(d[f].value()),t.signals[o]=1),t):(d[h].value()===!0&&(d[c].value(!1),d[h].value(!1)),g.doNotPropagate)},p.addListener(e),[c,f,h].forEach(function(e){var a=e==f?i:l,o=e==f?s:{};r[e].event?n(d[e],r[e],a,o):r[e].signal?t(d[e],r[e],a,o):r[e].stream&&m(d[e],r[e].stream,a,o),d[e].addListener(p)})}function m(e,r,i,a){r.forEach(function(r){r.event?n(e,r,i,a):r.signal?t(e,r,i,a):r.start?p(e,r,i,a):r.stream&&m(e,r.stream,i,a)})}var g=e.model(),y=g.defs().signals,v={},_={};(y||[]).forEach(function(e){var t=g.signal(e.name);e.expr||(e.streams||[]).forEach(function(e){var n=l.parse(e.type),r=u(e.expr);m(t,n,r,e)})}),r.keys(v).forEach(function(t){var n=v[t],r=_[t];

e.on(t,function(t,a){var l,d,c,f,h,p=o.create(null,!0),m=e.padding(),y=!1;t.preventDefault(),f=i.mouse((i.event=t,e._el)),a=a||{},h=a.datum||{};var v={x:f[0]-m.left,y:f[1]-m.top};for(c=0;c<n.length;c++)d=n[c],y=d.filters.some(function(e){return!u.eval(g,e.fn,h,t,a,v,e.signals)}),y||(l=u.eval(g,d.exp.fn,h,t,a,v,d.exp.signals),d.spec.scale&&(l=s.scale(g,d.spec,l)),l!==d.signal.value()&&(d.signal.value(l),p.signals[d.signal.name()]=1));g.propagate(p,r)})})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/Node":34,"../dataflow/changeset":36,"../util/constants":108,"./events":46,"./expr":47,"./signals":57,datalib:20}],60:[function(e,t,n){function r(e,t){var n=new a[t.type](e);return t.output&&n.output(t.output),i.keys(t).forEach(function(e){"type"!==e&&"output"!==e&&("transform"!==e||"facet"!==t.type)&&n.param(e,t[e])}),n}var i=e("datalib"),a=e("../transforms/index");t.exports=r,r.schema={defs:{transform:{type:"array",items:{oneOf:i.keys(a).map(function(e){return a[e].schema})}}}}},{"../transforms/index":103,datalib:20}],61:[function(e,t,n){(function(n){function r(e){var t=e.indexOf(".");return 0>t?e:e.slice(0,t)}var i=e("datalib"),a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,s=e("./marks"),o=function(e,t){this._active=null,this._down=null,this._handlers={},e&&this.initialize(e),t&&this.model(t)},l=o.prototype;l.initialize=function(e,t,n){this._el=a.select(e).node(),this._canvas=a.select(e).select("canvas.marks").node(),this._padding=t,this._obj=n||null;var r=this._canvas,i=this;return u.forEach(function(e){r.addEventListener(e,function(t){l[e].call(i,t)})}),this},l.padding=function(e){return this._padding=e,this},l.model=function(e){return arguments.length?(this._model=e,this):this._model},l.handlers=function(){var e=this._handlers;return i.keys(e).reduce(function(t,n){return e[n].reduce(function(e,t){return e.push(t),e},t)},[])};var u=["mouseup","dblclick","wheel","keydown","keypress","keyup","mousewheel","touchstart"];u.forEach(function(e){l[e]=function(t){this.fire(e,t)}}),u.push("mousedown"),u.push("mousemove"),u.push("mouseout"),u.push("click"),u.push("touchmove"),u.push("touchend"),l.touchmove=l.mousemove=function(e){var t=this._padding,n=e.target.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,a=this._active,s=this.pick(this._model.scene(),r,i,r-t.left,i-t.top);return s===a?(this.fire("mousemove",e),void("touchmove"==e.type&&this.fire("touchmove",e))):(a&&(this.fire("mouseout",e),"touchend"==e.type&&this.fire("touchend",e)),this._active=s,void(s&&(this.fire("mouseover",e),"touchstart"==e.type&&this.fire("touchstart",e))))},l.touchend=l.mouseout=function(e){this._active&&(this.fire("mouseout",e),this.fire("touchend",e)),this._active=null},l.mousedown=function(e){this._down=this._active,this.fire("mousedown",e)},l.click=function(e){this._down===this._active&&(this.fire("click",e),this._down=null)},l.DOMMouseScroll=function(e){this.fire("mousewheel",e)},l.fire=function(e,t){var n=this._active,r=this._handlers[e];if(r)for(var i=0,a=r.length;a>i;++i)r[i].handler.call(this._obj,t,n)},l.on=function(e,t){var n=r(e),i=this._handlers;return i=i[n]||(i[n]=[]),i.push({type:e,handler:t}),this},l.off=function(e,t){var n=r(e),i=this._handlers[n];if(i){for(var a=i.length;--a>=0;)i[a].type===e&&(t&&i[a].handler!==t||i.splice(a,1));return this}},l.context=function(){return this._canvas.getContext("2d")},l.pick=function(e,t,n,r,i){var a=this.context(),o=e.marktype,l=s.pick[o];return l.call(this,a,e,t,n,r,i)},t.exports=o}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./marks":64,datalib:20}],62:[function(e,t,n){(function(n){function r(e,t){var n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=n/r;if(n!==r){var a=e.width,s=e.height;e.setAttribute("width",a*i),e.setAttribute("height",s*i),e.style.width=a+"px",e.style.height=s+"px"}return i}function i(e){if(!e.vgLineDash){var t=[];e.setLineDash?(e.vgLineDash=function(e){this.setLineDash(e||t)},e.vgLineDashOffset=function(e){this.lineDashOffset=e}):void 0!==e.webkitLineDash?(e.vgLineDash=function(e){this.webkitLineDash=e||t},e.vgLineDashOffset=function(e){this.webkitLineDashOffset=e}):void 0!==e.mozDash?(e.vgLineDash=function(e){this.mozDash=e},e.vgLineDashOffset=function(e){}):(e.vgLineDash=function(e){},e.vgLineDashOffset=function(e){})}}function a(e,t){for(var n=new d(t);null!=(e=e.mark.group);)n.translate(e.x||0,e.y||0);return n}function s(e){return e?u.array(e).reduce(function(e,t){return e.union(a(t,t.bounds)).union(a(t,t["bounds:prev"]))},new d):null}function o(e,t){var n=null;return t&&(n=new d(t).round(),e.beginPath(),e.rect(n.x1,n.y1,n.width(),n.height()),e.clip()),n}var l="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,u=e("datalib"),d=e("../../util/Bounds"),c=e("../../util/config"),f=e("./marks"),h=function(){this._ctx=null,this._el=null,this._bgcolor=null,this._imgload=0},p=h.prototype;p.initialize=function(e,t,n,r,i){if(this._el=e,this.background(i),!e)return this;var a=l.select(e).selectAll("canvas.marks").data([1]);return a.enter().append("canvas").attr("class","marks"),a.exit().remove(),this.resize(t,n,r)},p.background=function(e){return this._bgcolor=e,this},p.resize=function(e,t,n){if(this._width=e,this._height=t,this._padding=n,this._el){var a=l.select(this._el).select("canvas.marks");a.attr("width",e+n.left+n.right).attr("height",t+n.top+n.bottom);var s;this._ctx=a.node().getContext("2d"),this._ctx._ratio=s=r(a.node(),this._ctx)||1,this._ctx.setTransform(s,0,0,s,s*n.left,s*n.top)}return i(this._ctx),this},p.context=function(e){return e?(this._ctx=e,this):this._ctx},p.element=function(){return this._el},p.pendingImages=function(){return this._imgload},p.render=function(e,t){var n,r=this._ctx,i=this._padding,a=this._width+i.left+i.right,l=this._height+i.top+i.bottom,u=null;this._scene=e,r.save(),u=o(r,s(t)),this.clear(-i.left,-i.top,a,l),this.draw(r,e,u),t&&(r.restore(),r.save(),n=o(r,s(t)),u.encloses(n)||(this.clear(-i.left,-i.top,a,l),this.draw(r,e,n))),r.restore(),this._scene=null},p.draw=function(e,t,n){var r=t.marktype,i=f.draw[r];i.call(this,e,t,n)},p.clear=function(e,t,n,r){var i=this._ctx;i.clearRect(e,t,n,r),null!=this._bgcolor&&(i.fillStyle=this._bgcolor,i.fillRect(e,t,n,r))},p.renderAsync=function(e){var t=this;t._async_id&&clearTimeout(t._async_id),t._async_id=setTimeout(function(){t.render(e),delete t._async_id},50)},p.loadImage=function(e){var t,r=this,i=r._scene,a=null;if(u.isNode)r._imgload+=1,a=new("undefined"!=typeof window?window.canvas:"undefined"!=typeof n?n.canvas:null).Image,u.load(u.extend({url:e},c.load),function(t,n){return r._imgload-=1,t?void u.error(t):(u.log("LOAD IMAGE: "+e),a.src=n,void(a.loaded=!0))});else{if(a=new Image,t=u.load.sanitizeUrl(u.extend({url:e},c.load)),!t)return;r._imgload+=1,a.onload=function(){u.log("LOAD IMAGE: "+t),a.loaded=!0,r._imgload-=1,r.renderAsync(i)},a.src=t}return a},t.exports=h}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/Bounds":104,"../../util/config":107,"./marks":64,datalib:20}],63:[function(e,t,n){t.exports={Handler:e("./Handler"),Renderer:e("./Renderer")}},{"./Handler":61,"./Renderer":62}],64:[function(e,t,n){function r(e){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:C.render.fontSize)+"px "+(e.font||C.render.font)}function i(e,t){var n=t.x||0,r=t.y||0,i=t.innerRadius||0,a=t.outerRadius||0,s=(t.startAngle||0)-Math.PI/2,o=(t.endAngle||0)-Math.PI/2;e.beginPath(),0===i?e.moveTo(n,r):e.arc(n,r,i,s,o,0),e.arc(n,r,a,o,s,1),e.closePath()}function a(e,t){var n=t[0],r=n.mark,i=r.pathCache||(r.pathCache=I(P.area(t)));N(e,i)}function s(e,t){var n=t[0],r=n.mark,i=r.pathCache||(r.pathCache=I(P.line(t)));N(e,i)}function o(e,t){if(null!=t.path){var n=t.pathCache||(t.pathCache=I(t.path));return N(e,n,t.x,t.y)}}function l(e,t){e.beginPath();var n,r,i,a,s=null!=t.size?t.size:100,o=t.x,l=t.y;if(null==t.shape||"circle"===t.shape)return n=Math.sqrt(s/Math.PI),e.arc(o,l,n,0,2*Math.PI,0),void e.closePath();switch(t.shape){case"cross":n=Math.sqrt(s/5)/2,r=3*n,e.moveTo(o-r,l-n),e.lineTo(o-n,l-n),e.lineTo(o-n,l-r),e.lineTo(o+n,l-r),e.lineTo(o+n,l-n),e.lineTo(o+r,l-n),e.lineTo(o+r,l+n),e.lineTo(o+n,l+n),e.lineTo(o+n,l+r),e.lineTo(o-n,l+r),e.lineTo(o-n,l+n),e.lineTo(o-r,l+n);break;case"diamond":a=Math.sqrt(s/(2*j)),i=a*j,e.moveTo(o,l-a),e.lineTo(o+i,l),e.lineTo(o,l+a),e.lineTo(o-i,l);break;case"square":r=Math.sqrt(s),n=r/2,e.rect(o-n,l-n,r,r);break;case"triangle-down":i=Math.sqrt(s/O),a=i*O/2,e.moveTo(o,l+a),e.lineTo(o+i,l-a),e.lineTo(o-i,l-a);break;case"triangle-up":i=Math.sqrt(s/O),a=i*O/2,e.moveTo(o,l-a),e.lineTo(o+i,l+a),e.lineTo(o-i,l+a)}e.closePath()}function u(e,t){var n=t[0],r=n.strokeWidth,i=n.strokeCap;e.lineWidth=null!=r?r:C.render.lineWidth,e.lineCap=null!=i?i:C.render.lineCap,s(e,t)}function d(e,t){var n=t.x||0,r=t.y||0,i=null!=t.x2?t.x2:n,a=null!=t.y2?t.y2:r,s=t.strokeWidth,o=t.strokeCap;e.lineWidth=null!=s?s:C.render.lineWidth,e.lineCap=null!=o?o:C.render.lineCap,e.beginPath(),e.moveTo(n,r),e.lineTo(i,a)}function c(e,t,n,r){var i,a,s,o=n.fill,l=n.stroke;e(t,r),i=null==n.opacity?1:n.opacity,0!=i&&(o||l)&&(o&&(t.globalAlpha=i*(null==n.fillOpacity?1:n.fillOpacity),t.fillStyle=b(t,n,o),t.fill()),l&&(s=null!=(s=n.strokeWidth)?s:C.render.lineWidth,s>0&&(t.globalAlpha=i*(null==n.strokeOpacity?1:n.strokeOpacity),t.strokeStyle=b(t,n,l),t.lineWidth=s,t.lineCap=null!=(a=n.strokeCap)?a:C.render.lineCap,t.vgLineDash(n.strokeDash||null),t.vgLineDashOffset(n.strokeDashOffset||0),t.stroke())))}function f(e,t,n,r){var i,a,s;for(i=0,a=n.items.length;a>i;++i)s=n.items[i],(!r||r.intersects(s.bounds))&&c(e,t,s,s)}function h(e,t,n){if(t.items.length)for(var r,i,a,s,o,l,u,d,c,f,h=t.items,p=0,m=h.length;m>p;++p)r=h[p],(!n||n.intersects(r.bounds))&&(u=r.x||0,d=r.y||0,c=r.width||0,f=r.height||0,s=null==r.opacity?1:r.opacity,0!=s&&((i=r.fill)&&(e.globalAlpha=s*(null==r.fillOpacity?1:r.fillOpacity),e.fillStyle=b(e,r,i),e.fillRect(u,d,c,f)),(a=r.stroke)&&(l=null!=(l=r.strokeWidth)?l:C.render.lineWidth,l>0&&(e.globalAlpha=s*(null==r.strokeOpacity?1:r.strokeOpacity),e.strokeStyle=b(e,r,a),e.lineWidth=l,e.lineCap=null!=(o=r.strokeCap)?o:C.render.lineCap,e.vgLineDash(r.strokeDash||null),e.vgLineDashOffset(r.strokeDashOffset||0),e.strokeRect(u,d,c,f)))))}function p(e,t,n){if(t.items.length)for(var r,i,a,s,o,l,u,d,c,f=t.items,h=0,p=f.length;p>h;++h)r=f[h],(!n||n.intersects(r.bounds))&&(l=r.x||0,u=r.y||0,d=null!=r.x2?r.x2:l,c=null!=r.y2?r.y2:u,a=null==r.opacity?1:r.opacity,0!=a&&(i=r.stroke)&&(o=null!=(o=r.strokeWidth)?o:C.render.lineWidth,o>0&&(e.globalAlpha=a*(null==r.strokeOpacity?1:r.strokeOpacity),e.strokeStyle=b(e,r,i),e.lineWidth=o,e.lineCap=null!=(s=r.strokeCap)?s:C.render.lineCap,e.vgLineDash(r.strokeDash||null),e.vgLineDashOffset(r.strokeDashOffset||0),e.beginPath(),e.moveTo(l,u),e.lineTo(d,c),e.stroke())))}function m(e,t,n){if(t.items.length)for(var r,i=this,a=t.items,s=0,o=a.length;o>s;++s)if(r=a[s],!n||n.intersects(r.bounds)){r.image&&r.image.url===r.url||(r.image=i.loadImage(r.url),r.image.url=r.url);var l,u,d,c,f;d=r.width||r.image&&r.image.width||0,c=r.height||r.image&&r.image.height||0,l=(r.x||0)-("center"===r.align?d/2:"right"===r.align?d:0),u=(r.y||0)-("middle"===r.baseline?c/2:"bottom"===r.baseline?c:0),r.image.loaded&&(e.globalAlpha=null!=(f=r.opacity)?f:1,e.drawImage(r.image,l,u,d,c))}}function g(e,t,n){if(t.items.length)for(var i,a,s,o,l,u,d,c,f,h=t.items,p=0,m=h.length;m>p;++p)i=h[p],(!n||n.intersects(i.bounds))&&(e.font=r(i),e.textAlign=i.align||"left",e.textBaseline=i.baseline||"alphabetic",o=null==i.opacity?1:i.opacity,0!=o&&(u=i.x||0,d=i.y||0,(c=i.radius)&&(f=(i.theta||0)-Math.PI/2,u+=c*Math.cos(f),d+=c*Math.sin(f)),i.angle?(e.save(),e.translate(u,d),e.rotate(i.angle*Math.PI/180),u=i.dx||0,d=i.dy||0):(u+=i.dx||0,d+=i.dy||0),(a=i.fill)&&(e.globalAlpha=o*(null==i.fillOpacity?1:i.fillOpacity),e.fillStyle=b(e,i,a),e.fillText(i.text,u,d)),(s=i.stroke)&&(l=null!=(l=i.strokeWidth)?l:1,l>0&&(e.globalAlpha=o*(null==i.strokeOpacity?1:i.strokeOpacity),e.strokeStyle=b(e,i,s),e.lineWidth=l,e.strokeText(i.text,u,d))),i.angle&&e.restore()))}function y(e){return function(t,n,r){f(e,t,n,r)}}function v(e){return function(t,n,r){n.items.length&&(!r||r.intersects(n.items[0].bounds))&&c(e,t,n.items[0],n.items)}}function _(e,t,n){if(t.items.length){var r,i,a,s,o,l,u,d,c,f=t.items,p=this;for(h(e,t,n),l=0,u=f.length;u>l;++l){for(r=f[l],i=r.axisItems||[],a=r.legendItems||[],s=r.x||0,o=r.y||0,e.save(),e.translate(s,o),r.clip&&(e.beginPath(),e.rect(0,0,r.width||0,r.height||0),e.clip()),n&&n.translate(-s,-o),d=0,c=i.length;c>d;++d)"back"===i[d].def.layer&&p.draw(e,i[d],n);for(d=0,c=r.items.length;c>d;++d)p.draw(e,r.items[d],n);for(d=0,c=i.length;c>d;++d)"back"!==i[d].def.layer&&p.draw(e,i[d],n);for(d=0,c=a.length;c>d;++d)p.draw(e,a[d],n);n&&n.translate(s,o),e.restore()}}}function b(e,t,n){return n.id?x(e,n,t.bounds):n}function x(e,t,n){var r,i,a=n.width(),s=n.height(),o=n.x1+t.x1*a,l=n.y1+t.y1*s,u=n.x1+t.x2*a,d=n.y1+t.y2*s,c=e.createLinearGradient(o,l,u,d),f=t.stops;for(r=0,i=f.length;i>r;++r)c.addColorStop(f[r].offset,f[r].color);return c}function w(e,t,n,r,i,a){if(0===t.items.length||t.bounds&&!t.bounds.contains(i,a))return!1;var s,o,l,u,d,c,f,h=t.items,p=this;for(c=h.length;--c>=0;){for(o=h[c],u=o.x||0,d=o.y||0,e.save(),e.translate(u,d),f=o.items.length;--f>=0;)if(s=o.items[f],s.interactive!==!1&&(l=p.pick(s,n,r,i-u,a-d)))return e.restore(),l;e.restore()}return t.interactive?k(z.group,e,t,n,r,i,a):!1}function k(e,t,n,r,i,a,s){if(!n.items.length)return!1;var o,l,u;for(1!==t._ratio&&(r*=t._ratio,i*=t._ratio),u=n.items.length;--u>=0;)if(o=n.items[u],l=o.bounds,(!l||l.contains(a,s))&&l&&e(t,o,r,i,a,s))return o;return!1}function E(e,t,n,r,i,a){if(!t.items.length)return!1;var s,o=t.items;return s=o[0].bounds,s&&!s.contains(i,a)?!1:(1!==e._ratio&&(n*=e._ratio,r*=e._ratio),z.area(e,o,n,r)?o[0]:!1)}function S(e,t,n,r,i,a){if(!t.items.length)return!1;var s,o=t.items;return s=o[0].bounds,s&&!s.contains(i,a)?!1:(1!==e._ratio&&(n*=e._ratio,r*=e._ratio),z.line(e,o,n,r)?o[0]:!1)}function A(e){return function(t,n,r,i,a,s){return k(e,t,n,r,i,a,s)}}function L(e,t,n,r,i,a){if(!t.fontSize)return!1;if(!t.angle)return!0;var s=M.text(t,D,!0),o=-t.angle*Math.PI/180,l=Math.cos(o),u=Math.sin(o),n=t.x,r=t.y,d=l*i-u*a+(n-n*l+r*u),c=u*i+l*a+(r-n*u-r*l);return s.contains(d,c)}var T=e("../../util/Bounds"),M=e("../../util/boundscalc"),C=e("../../util/config"),P=e("./path"),I=P.parse,N=P.render,O=(Math.PI/2,Math.sqrt(3)),j=Math.tan(30*Math.PI/180),D=new T,z={text:L,rect:function(e,t,n,r){return!0},image:function(e,t,n,r){return!0},group:function(e,t,n,r){return t.fill||t.stroke},rule:function(e,t,n,r){return e.isPointInStroke?(d(e,t),e.isPointInStroke(n,r)):!1},line:function(e,t,n,r){return e.isPointInStroke?(u(e,t),e.isPointInStroke(n,r)):!1},arc:function(e,t,n,r){return i(e,t),e.isPointInPath(n,r)},area:function(e,t,n,r){return a(e,t),e.isPointInPath(n,r)},path:function(e,t,n,r){return o(e,t),e.isPointInPath(n,r)},symbol:function(e,t,n,r){return l(e,t),e.isPointInPath(n,r)}};t.exports={draw:{group:_,area:v(a),line:v(s),arc:y(i),path:y(o),symbol:y(l),rect:h,rule:p,text:g,image:m,drawOne:v,drawAll:y},pick:{group:w,area:E,line:S,arc:A(z.arc),path:A(z.path),symbol:A(z.symbol),rect:A(z.rect),rule:A(z.rule),text:A(z.text),image:A(z.image),pickAll:k}}},{"../../util/Bounds":104,"../../util/boundscalc":106,"../../util/config":107,"./path":65}],65:[function(e,t,n){(function(n){function r(e){var t,n,r,i=[];e=e.slice().replace(g[0],"###$1").split(g[1]).slice(1);for(var a,s,o=0,l=e.length;l>o;o++){t=e[o],n=t.slice(1).trim().replace(g[2],"$1###-").split(g[3]),s=[t.charAt(0)];for(var a=0,u=n.length;u>a;a++)r=parseFloat(n[a]),isNaN(r)||s.push(r);var d=s[0].toLowerCase(),c=m[d];if(s.length-1>c)for(var f=1,h=s.length;h>f;f+=c)i.push([s[0]].concat(s.slice(f,f+c)));else i.push(s)}return i}function i(e,t,n,r,i,a,l){for(var u=r[0],d=r[1],c=r[2],f=r[3],h=r[4],p=r[5],m=r[6],g=s(p,m,u,d,f,h,c,t,n),y=0;y<g.length;y++){var v=o.apply(null,g[y]);e.bezierCurveTo.apply(e,v),i.add(v[0]-a,v[1]-l),i.add(v[2]-a,v[3]-l),i.add(v[4]-a,v[5]-l)}}function a(e,t,n,r){for(var i=n[0],a=n[1],l=n[2],u=n[3],d=n[4],c=n[5],f=n[6],h=s(c,f,i,a,u,d,l,e,t),p=0;p<h.length;p++){var m=o.apply(null,h[p]);r.add(m[0],m[1]),r.add(m[2],m[3]),r.add(m[4],m[5])}}function s(e,t,n,r,i,a,s,o,l){if(f=_.call(arguments),y[f])return y[f];var u=s*(Math.PI/180),d=Math.sin(u),c=Math.cos(u);n=Math.abs(n),r=Math.abs(r);var h=c*(o-e)*.5+d*(l-t)*.5,p=c*(l-t)*.5-d*(o-e)*.5,m=h*h/(n*n)+p*p/(r*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);var g=c/n,v=d/n,b=-d/r,x=c/r,w=g*o+v*l,k=b*o+x*l,E=g*e+v*t,S=b*e+x*t,A=(E-w)*(E-w)+(S-k)*(S-k),L=1/A-.25;0>L&&(L=0);var T=Math.sqrt(L);a==i&&(T=-T);var M=.5*(w+E)-T*(S-k),C=.5*(k+S)+T*(E-w),P=Math.atan2(k-C,w-M),I=Math.atan2(S-C,E-M),N=I-P;0>N&&1==a?N+=2*Math.PI:N>0&&0==a&&(N-=2*Math.PI);for(var O=Math.ceil(Math.abs(N/(.5*Math.PI+.001))),j=[],D=0;O>D;D++){var z=P+D*N/O,q=P+(D+1)*N/O;j[D]=[M,C,z,q,n,r,d,c]}return y[f]=j}function o(e,t,n,r,i,a,s,o){if(f=_.call(arguments),v[f])return v[f];var l=o*i,u=-s*a,d=s*i,c=o*a,h=Math.cos(n),p=Math.sin(n),m=Math.cos(r),g=Math.sin(r),y=.5*(r-n),b=Math.sin(.5*y),x=8/3*b*b/Math.sin(y),w=e+h-x*p,k=t+p+x*h,E=e+m,S=t+g,A=E+x*g,L=S-x*m;return v[f]=[l*w+u*k,d*w+c*k,l*A+u*L,d*A+c*L,l*E+u*S,d*E+c*S]}function l(e,t,n,r){var a,s,o,l,u,d=null,c=0,f=0,h=0,m=0,g=new p;void 0==n&&(n=0),void 0==r&&(r=0),e.beginPath();for(var y=0,v=t.length;v>y;++y){switch(a=t[y],a[0]){case"l":c+=a[1],f+=a[2],e.lineTo(c+n,f+r),g.add(c,f);break;case"L":c=a[1],f=a[2],e.lineTo(c+n,f+r),g.add(c,f);break;case"h":c+=a[1],e.lineTo(c+n,f+r),g.add(c,f);break;case"H":c=a[1],e.lineTo(c+n,f+r),g.add(c,f);break;case"v":f+=a[1],e.lineTo(c+n,f+r),g.add(c,f);break;case"V":f=a[1],e.lineTo(c+n,f+r),g.add(c,f);break;case"m":c+=a[1],f+=a[2],e.moveTo(c+n,f+r),g.add(c,f);break;case"M":c=a[1],f=a[2],e.moveTo(c+n,f+r),g.add(c,f);break;case"c":s=c+a[5],o=f+a[6],h=c+a[3],m=f+a[4],e.bezierCurveTo(c+a[1]+n,f+a[2]+r,h+n,m+r,s+n,o+r),g.add(c+a[1],f+a[2]),g.add(h,m),g.add(s,o),c=s,f=o;break;case"C":c=a[5],f=a[6],h=a[3],m=a[4],e.bezierCurveTo(a[1]+n,a[2]+r,h+n,m+r,c+n,f+r),g.add(a[1],a[2]),g.add(h,m),g.add(c,f);break;case"s":s=c+a[3],o=f+a[4],h=2*c-h,m=2*f-m,e.bezierCurveTo(h+n,m+r,c+a[1]+n,f+a[2]+r,s+n,o+r),g.add(h,m),g.add(c+a[1],f+a[2]),g.add(s,o),h=c+a[1],m=f+a[2],c=s,f=o;break;case"S":s=a[3],o=a[4],h=2*c-h,m=2*f-m,e.bezierCurveTo(h+n,m+r,a[1]+n,a[2]+r,s+n,o+r),c=s,f=o,g.add(a[1],a[2]),g.add(h,m),g.add(s,o),h=a[1],m=a[2];break;case"q":s=c+a[3],o=f+a[4],h=c+a[1],m=f+a[2],e.quadraticCurveTo(h+n,m+r,s+n,o+r),c=s,f=o,g.add(h,m),g.add(s,o);break;case"Q":s=a[3],o=a[4],e.quadraticCurveTo(a[1]+n,a[2]+r,s+n,o+r),c=s,f=o,h=a[1],m=a[2],g.add(h,m),g.add(s,o);break;case"t":s=c+a[1],o=f+a[2],null===d[0].match(/[QqTt]/)?(h=c,m=f):"t"===d[0]?(h=2*c-l,m=2*f-u):"q"===d[0]&&(h=2*c-h,m=2*f-m),l=h,u=m,e.quadraticCurveTo(h+n,m+r,s+n,o+r),c=s,f=o,h=c+a[1],m=f+a[2],g.add(h,m),g.add(s,o);break;case"T":s=a[1],o=a[2],h=2*c-h,m=2*f-m,e.quadraticCurveTo(h+n,m+r,s+n,o+r),c=s,f=o,g.add(h,m),g.add(s,o);break;case"a":i(e,c+n,f+r,[a[1],a[2],a[3],a[4],a[5],a[6]+c+n,a[7]+f+r],g,n,r),c+=a[6],f+=a[7];break;case"A":i(e,c+n,f+r,[a[1],a[2],a[3],a[4],a[5],a[6]+n,a[7]+r],g,n,r),c=a[6],f=a[7];break;case"z":case"Z":e.closePath()}d=a}return g.translate(n,r)}function u(e,t){for(var n,r,i,s,o,l=null,u=0,d=0,c=0,f=0,h=0,p=e.length;p>h;++h){switch(n=e[h],n[0]){case"l":u+=n[1],d+=n[2],t.add(u,d);break;case"L":u=n[1],d=n[2],t.add(u,d);break;case"h":u+=n[1],t.add(u,d);break;case"H":u=n[1],t.add(u,d);break;case"v":d+=n[1],t.add(u,d);break;case"V":d=n[1],t.add(u,d);break;case"m":u+=n[1],d+=n[2],t.add(u,d);break;case"M":u=n[1],d=n[2],t.add(u,d);break;case"c":r=u+n[5],i=d+n[6],c=u+n[3],f=d+n[4],t.add(u+n[1],d+n[2]),t.add(c,f),t.add(r,i),u=r,d=i;break;case"C":u=n[5],d=n[6],c=n[3],f=n[4],t.add(n[1],n[2]),t.add(c,f),t.add(u,d);break;case"s":r=u+n[3],i=d+n[4],c=2*u-c,f=2*d-f,t.add(c,f),t.add(u+n[1],d+n[2]),t.add(r,i),c=u+n[1],f=d+n[2],u=r,d=i;break;case"S":r=n[3],i=n[4],c=2*u-c,f=2*d-f,u=r,d=i,t.add(n[1],n[2]),t.add(c,f),t.add(r,i),c=n[1],f=n[2];break;case"q":r=u+n[3],i=d+n[4],c=u+n[1],f=d+n[2],u=r,d=i,t.add(c,f),t.add(r,i);break;case"Q":r=n[3],i=n[4],u=r,d=i,c=n[1],f=n[2],t.add(c,f),t.add(r,i);break;case"t":r=u+n[1],i=d+n[2],null===l[0].match(/[QqTt]/)?(c=u,f=d):"t"===l[0]?(c=2*u-s,f=2*d-o):"q"===l[0]&&(c=2*u-c,f=2*d-f),s=c,o=f,u=r,d=i,c=u+n[1],f=d+n[2],t.add(c,f),t.add(r,i);break;case"T":r=n[1],i=n[2],c=2*u-c,f=2*d-f,u=r,d=i,t.add(c,f),t.add(r,i);break;case"a":a(u,d,[n[1],n[2],n[3],n[4],n[5],n[6]+u,n[7]+d],t),u+=n[6],d+=n[7];break;case"A":a(u,d,[n[1],n[2],n[3],n[4],n[5],n[6],n[7]],t),u=n[6],d=n[7];break;case"z":case"Z":}l=n}return t}function d(e){var t,n=e[0];return t="horizontal"===n.orient?h.svg.area().y(function(e){return e.y}).x0(function(e){return e.x}).x1(function(e){return e.x+e.width}):h.svg.area().x(function(e){return e.x}).y1(function(e){return e.y}).y0(function(e){return e.y+e.height}),n.interpolate&&t.interpolate(n.interpolate),null!=n.tension&&t.tension(n.tension),t(e)}function c(e){var t=e[0],n=h.svg.line().x(function(e){return e.x}).y(function(e){return e.y});return t.interpolate&&n.interpolate(t.interpolate),null!=t.tension&&n.tension(t.tension),n(e)}var f,h="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,p=e("../../util/Bounds"),m={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},g=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],y={},v={},_=Array.prototype.join;t.exports={parse:r,render:l,bounds:u,area:d,line:c}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/Bounds":104}],66:[function(e,t,n){(function(n){var r=("undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,e("datalib")),i=(e("../../util/config"),e("./svg")),a=function(){this._builder=null},s=a.prototype;s.initialize=function(e,t,n,r){return this._builder=new i,this.resize(t,n,r)},s.resize=function(e,t,n){this._width=e,this._height=t,this._padding=n||{top:0,left:0,bottom:0,right:0},this._autopad=r.isString(this._padding)?1:0;var i=this._width,a=this._height,n=this._padding;return this._builder.initialize(null,i,a,n),this},s.render=function(e,t){return this._builder.render(e),this},s.svg=function(){return this._builder.svg()},t.exports=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/config":107,"./svg":68,datalib:20}],67:[function(e,t,n){t.exports={Renderer:e("./Renderer")}},{"./Renderer":66}],68:[function(e,t,n){(function(n){function r(e,t,n){var r="<"+e;if(t)for(var i in t){var a=t[i];null!=a&&(r+=" "+i+'="'+a+'"')}return n&&(r+=" "+n),r+">"}function i(e){return"</"+e+">"}function a(e){return e=null==e?"":String(e),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(e){return String(e).replace(/\"/g,"'")}function o(e){var t=(e.width||0,e.height||0,e.mark.interactive===!1?'style="pointer-events: none;"':'style=""');return r("rect",{"class":"background"},t)+i("rect")}function l(e,t){var n=e.x||0,r=e.y||0,i={transform:"translate("+n+","+r+")"};if(e.clip){var a={width:e.width||0,height:e.height||0},s=e.clip_id||(e.clip_id="clip"+q++);t.clipping[s]=a,i["clip-path"]="url(#"+s+")"}return i}function u(e){var t=e.x||0,n=e.y||0;return{transform:"translate("+t+","+n+")",d:N(e)}}function d(e){if(e.length){var t=e[0],n="horizontal"===t.orient?j:O;return n.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),{d:n(e)}}}function c(e){if(e.length){var t=e[0];return D.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),{d:D(e)}}}function f(e){var t=e.x||0,n=e.y||0;return{transform:"translate("+t+","+n+")",d:e.path}}function h(e){return{x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}function p(e){var t=e.x||0,n=e.y||0;return{x1:t,y1:n,x2:null!=e.x2?e.x2:t,y2:null!=e.y2?e.y2:n}}function m(e){var t=e.x||0,n=e.y||0;return{transform:"translate("+t+","+n+")",d:z(e)}}function g(e){var t=e.width||e.image&&e.image.width||0,n=e.height||e.image&&e.image.height||0,r=e.x-("center"===e.align?t/2:"right"===e.align?t:0),i=e.y-("middle"===e.baseline?n/2:"bottom"===e.baseline?n:0),a=M.load.baseURL+e.url;return{"xlink:href":a,x:r,y:i,width:t,height:n}}function y(e){var t=e.x||0,n=e.y||0,r=e.dx||0,i=e.dy||0,a=e.angle||0,s=e.radius||0,o=$[e.align||"left"],l="top"===e.baseline?".9em":"middle"===e.baseline?".35em":0;if(s){var u=(e.theta||0)-Math.PI/2;t+=s*Math.cos(u),n+=s*Math.sin(u)}return{x:t+r,y:n+i,"text-anchor":o,transform:a?"rotate("+a+" "+t+","+n+")":null,dy:l?l:null}}function v(e){var t="type-"+e.type;return e.name&&(t+=" "+e.name),t}function _(e){return e.x||0}function b(e){return e.y||0}function x(e){return e.x+e.width||0}function w(e){return e.y+e.height||0}function k(e){return null==e.size?100:e.size}function E(e){return e.shape||"circle"}function S(e,t,n){var r,i,a,s,o,l=e.mark?e:e.length?e[0]:null;if(null===l)return null;var u="";for("text"===t&&(u+="font: "+A(l)+";"),r=0,i=R.length;i>r;++r)a=R[r],s=U[a],o=l[a],null==o?"fill"===s&&(u+="fill: none;"):(o.id&&(n.gradient[o.id]=o,o="url("+window.location.href+"#"+o.id+")"),u+=(u.length?" ":"")+s+": "+o+";");return'style="'+u+'"'}function A(e){var t=(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:M.render.fontSize)+"px "+(e.font&&s(e.font)||M.render.font);return t}var L="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,T=e("datalib"),M=e("../../util/config"),C=function(){this._gid=0,this._text={head:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}},P=C.prototype;P.initialize=function(e,t,n,a){var s=this._text;s.head=r("svg",{"class":"marks",width:t+a.left+a.right,height:n+a.top+a.bottom},M.svgNamespace),s.root=r("g",{transform:"translate("+a.left+","+a.top+")"}),s.foot=i("g")+i("svg")},P.svg=function(){var e=this._text;return e.head+e.defs+e.root+e.body+e.foot},P.buildDefs=function(){var e,t,n=this._defs,a=T.keys(n.gradient),s=T.keys(n.clipping),o="";for(e=0;e<a.length;++e){var l=a[e],u=n.gradient[l],d=u.stops;for(o+=r("linearGradient",{id:l,x1:u.x1,x2:u.x2,y1:u.y1,y2:u.y2}),t=0;t<d.length;++t)o+=r("stop",{offset:d[t].offset,"stop-color":d[t].color})+i("stop");o+=i("linearGradient")}for(e=0;e<s.length;++e){var l=s[e],u=n.clipping[l];o+=r("clipPath",{id:l}),o+=r("rect",{x:0,y:0,width:u.width,height:u.height})+i("rect"),o+=i("clipPath")}return o.length>0?r("defs")+o+i("defs"):""},P.render=function(e){this._gid=0,this._text.body=this.draw(e),this._text.defs=this.buildDefs()},P.draw=function(e){var t=I[e.marktype];if(t){var n,s,o=t[0],l=t[1],u=t[2]||!1,d=u?[e.items]:e.items,c=this._defs,f="",h=v(e.def),p=null;for("type-rule"===h||"type-path"===h?p='style="pointer-events: none;"':"type-group"!==h&&(p='style=""'),f+=r("g",{id:"g"+ ++this._gid,"class":v(e.def)},p),n=0;n<d.length;++n){var s="g"===o?null:S(d[n],o,c);f+=r(o,l(d[n],c),s),"text"===o&&(f+=a(d[n].text)),"g"===o&&(f+=this.drawGroup(d[n])),f+=i(o)}return f+i("g")}};var I={group:["g",l],area:["path",d,!0],line:["path",c,!0],arc:["path",u],path:["path",f],symbol:["path",m],rect:["rect",h],rule:["line",p],text:["text",y],image:["image",g]};P.drawGroup=function(e){var t,n,r="",i=e.axisItems||[],a=e.items,s=e.legendItems||[];for(r+=o(e),t=0,n=i.length;n>t;++t)"back"===i[t].def.layer&&(r+=this.draw(i[t]));for(t=0,n=a.length;n>t;++t)r+=this.draw(a[t]);for(t=0,n=i.length;n>t;++t)"back"!==i[t].def.layer&&(r+=this.draw(i[t]));for(t=0,n=s.length;n>t;++t)r+=this.draw(s[t]);return r};var N=L.svg.arc(),O=L.svg.area().x(_).y1(b).y0(w),j=L.svg.area().y(b).x0(x).x1(_),D=L.svg.line().x(_).y(b),z=L.svg.symbol().type(E).size(k),q=0,$={left:"start",center:"middle",right:"end"},U={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},R=T.keys(U);t.exports=C}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/config":107,datalib:20}],69:[function(e,t,n){function r(e){var t=this;return function(n){var r=n.target,i=r.__data__;i&&(i=i.mark?i:i[0]),e.call(t._obj,n,i)}}function i(e){var t=e.indexOf(".");return 0>t?e:e.slice(0,t)}var a=e("datalib"),s=function(e,t){this._active=null,this._handlers={},e&&this.initialize(e),t&&this.model(t)},o=s.prototype;o.initialize=function(e,t,n){return this._el=d3.select(e).node(),this._svg=d3.select(e).select("svg.marks").node(),this._padding=t,this._obj=n||null,this},o.padding=function(e){return this._padding=e,this},o.model=function(e){return arguments.length?(this._model=e,this):this._model},o.handlers=function(){var e=this._handlers;return a.keys(e).reduce(function(t,n){return e[n].reduce(function(e,t){return e.push(t),e},t)},[])},o.on=function(e,t){var n=i(e),a=this._handlers,s=d3.select(this._svg).node(),o={type:e,handler:t,svg:r.call(this,t)};return a=a[n]||(a[n]=[]),a.push(o),s.addEventListener(n,o.svg),this},o.off=function(e,t){var n=i(e),r=this._handlers[n],a=d3.select(this._svg).node();if(r){for(var s=r.length;--s>=0;)r[s].type===e&&(t&&r[s].handler!==t||(a.removeEventListener(n,r[s].svg),r.splice(s,1)));return this}},t.exports=s},{datalib:20}],70:[function(e,t,n){(function(n){var r="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,i=e("datalib"),a=e("./marks"),s=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={gradient:{},clipping:{}}},o=s.prototype;o.initialize=function(e,t,n,i,a){return this._el=e,r.select(e).select("svg.marks").remove(),this._svg=r.select(e).append("svg").attr("class","marks"),null!=a&&this._svg.style("background-color",a),this._ctx=this._svg.append("g"),this.resize(t,n,i)},o.resize=function(e,t,n){return this._width=e,this._height=t,this._padding=n,this._svg.attr("width",e+n.left+n.right).attr("height",t+n.top+n.bottom),this._ctx.attr("transform","translate("+n.left+","+n.top+")"),this},o.context=function(){return this._ctx},o.element=function(){return this._el},o.updateDefs=function(){var e,t,n=this._svg,a=this._defs,s=i.keys(a.gradient),o=i.keys(a.clipping),l=n.select("defs");return 0===s.length&&0==o.length?void l.remove():(l.empty()&&(l=n.insert("defs",":first-child")),e=l.selectAll("linearGradient").data(s,i.identity),e.enter().append("linearGradient").attr("id",i.identity),e.exit().remove(),e.each(function(e){var t=a.gradient[e],n=r.select(this);n.attr({x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2}),stop=n.selectAll("stop").data(t.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color})}),t=l.selectAll("clipPath").data(o,i.identity),t.enter().append("clipPath").attr("id",i.identity),t.exit().remove(),void t.each(function(e){var t=a.clipping[e],n=r.select(this).selectAll("rect").data([1]);n.enter().append("rect"),n.attr("x",0).attr("y",0).attr("width",t.width).attr("height",t.height)}))},o.render=function(e,t){a.current=this,t?this.renderItems(i.array(t)):this.draw(this._ctx,e,-1),this.updateDefs(),delete a.current},o.renderItems=function(e){var t,n,r,i,s;for(i=0,s=e.length;s>i;++i)t=e[i],n=t._svg,r=t.mark.marktype,t=a.nested[r]?t.mark.items:t,a.update[r].call(n,t),a.style.call(n,t)},o.draw=function(e,t,n){var r=t.marktype,i=a.draw[r];i.call(this,e,t,n)},t.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./marks":72,datalib:20}],71:[function(e,t,n){arguments[4][63][0].apply(n,arguments);

},{"./Handler":69,"./Renderer":70,dup:63}],72:[function(e,t,n){(function(n){function r(e){return e.x||0}function i(e){return e.y||0}function a(e){return e.x+e.width||0}function s(e){return e.y+e.height||0}function o(e){return null==e.size?100:e.size}function l(e){return e.shape||"circle"}function u(e){var t,n,r,i,a,s=e.mark?e:e.length?e[0]:null;if(null!==s)for(t=0,n=q.length;n>t;++t)r=q[t],i=z[r],a=s[r],null==a?"fill"===i?this.style.setProperty(i,"none",null):this.style.removeProperty(i):(a.id&&($.current._defs.gradient[a.id]=a,a="url("+window.location.href+"#"+a.id+")"),this.style.setProperty(i,a+"",null))}function d(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),this.setAttribute("d",M(e))}function c(e){if(e.length){var t=e[0],n="horizontal"===t.orient?P:C;n.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),this.setAttribute("d",n(e))}}function f(e){if(e.length){var t=e[0];I.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),this.setAttribute("d",I(e))}}function h(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),null!=e.path&&this.setAttribute("d",e.path)}function p(e){this.setAttribute("x",e.x||0),this.setAttribute("y",e.y||0),this.setAttribute("width",e.width||0),this.setAttribute("height",e.height||0)}function m(e){var t=e.x||0,n=e.y||0;this.setAttribute("x1",t),this.setAttribute("y1",n),this.setAttribute("x2",null!=e.x2?e.x2:t),this.setAttribute("y2",null!=e.y2?e.y2:n)}function g(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),this.setAttribute("d",N(e))}function y(e){var t=e.width||e.image&&e.image.width||0,n=e.height||e.image&&e.image.height||0,r=e.x-("center"===e.align?t/2:"right"===e.align?t:0),i=e.y-("middle"===e.baseline?n/2:"bottom"===e.baseline?n:0),a=A.load.sanitizeUrl(A.extend({url:e.url},T.load));a&&this.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.setAttribute("x",r),this.setAttribute("y",i),this.setAttribute("width",t),this.setAttribute("height",n)}function v(e){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:T.render.fontSize)+"px "+(e.font||T.render.font)}function _(e){var t=e.x||0,n=e.y||0,r=e.dx||0,i=e.dy||0,a=e.angle||0,s=e.radius||0,o=D[e.align||"left"],l="top"===e.baseline?".9em":"middle"===e.baseline?".35em":0;if(s){var u=(e.theta||0)-Math.PI/2;t+=s*Math.cos(u),n+=s*Math.sin(u)}this.setAttribute("x",t+r),this.setAttribute("y",n+i),this.setAttribute("text-anchor",o),a?this.setAttribute("transform","rotate("+a+" "+t+","+n+")"):this.removeAttribute("transform"),l?this.setAttribute("dy",l):this.removeAttribute("dy"),this.textContent=e.text,this.style.setProperty("font",v(e),null)}function b(e){var t=e.x||0,n=e.y||0;if(this.setAttribute("transform","translate("+t+","+n+")"),e.clip){var r={width:e.width||0,height:e.height||0},i=e.clip_id||(e.clip_id="clip"+j++);$.current._defs.clipping[i]=r,this.setAttribute("clip-path","url(#"+i+")")}}function x(e){var t=e.width||0,n=e.height||0;this.setAttribute("width",t),this.setAttribute("height",n)}function w(e){var t="type-"+e.type;return e.name&&(t+=" "+e.name),t}function k(e,t,n){return function(r,i,a){E(r,i,a,e,t,n)}}function E(e,t,n,r,i,a){var s=a?[t.items]:t.items,o=t.interactive===!1?"none":null,l=e.node().childNodes,d="g"!==r,c=(c=l[n+1])?L.select(c):e.append("g").attr("id","g"+ ++O).attr("class",w(t.def)),f=c.attr("id"),h="#"+f+" > "+r,p=c.selectAll(h).data(s),m=p.enter().append(r);return d?(c.style("pointer-events",o),m.each(function(e){e.mark?e._svg=this:e.length&&(e[0]._svg=this)})):m.append("rect").attr("class","background").style("pointer-events",o),p.exit().remove(),p.each(i),d?p.each(u):c.selectAll(h+" > rect.background").each(x).each(u),c}function S(e,t,n){var r,i,a,s=E(e,t,n,"g",b),o=s.node().childNodes,l=o.length;for(r=0;l>r;++r){var u=o[r].__data__.items,d=o[r].__data__.legendItems||[],c=o[r].__data__.axisItems||[],f=L.select(o[r]),h=0;for(i=0,a=c.length;a>i;++i)"back"===c[i].def.layer&&S.call(this,f,c[i],h++);for(i=0,a=u.length;a>i;++i)this.draw(f,u[i],h++);for(i=0,a=c.length;a>i;++i)"back"!==c[i].def.layer&&S.call(this,f,c[i],h++);for(i=0,a=d.length;a>i;++i)S.call(this,f,d[i],h++)}}var A=e("datalib"),L="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,T=e("../../util/config"),M=L.svg.arc(),C=L.svg.area().x(r).y1(i).y0(s),P=L.svg.area().y(i).x0(a).x1(r),I=L.svg.line().x(r).y(i),N=L.svg.symbol().type(l).size(o),O=0,j=0,D={left:"start",center:"middle",right:"end"},z={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},q=A.keys(z),$=t.exports={update:{group:p,area:c,line:f,arc:d,path:h,symbol:g,rect:p,rule:m,text:_,image:y},nested:{area:!0,line:!0},style:u,draw:{group:S,area:k("path",c,!0),line:k("path",f,!0),arc:k("path",d),path:k("path",h),symbol:k("path",g),rect:k("rect",p),rule:k("line",m),text:k("text",_),image:k("image",y),draw:k},current:null}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../util/config":107,datalib:20}],73:[function(e,t,n){function r(e,t){return this._mark=t,a.prototype.init.call(this,e).router(!0)}var i=e("datalib"),a=e("../dataflow/Node"),s=e("./Encoder"),o=e("../util/boundscalc"),l=e("../util/constants"),u=e("../util/debug"),d=r.prototype=new a;d.evaluate=function(e){u(e,["bounds",this._mark.marktype]);var t,n,r,a,d,c;if(hasLegends=this._mark.marktype==l.GROUP&&i.array(this._mark.def.legends).length>0,o.mark(this._mark,null,!hasLegends),hasLegends){for(t=0,n=this._mark.items.length;n>t;++t)for(d=this._mark.items[t],d._legendPositions=null,r=0,a=d.legendItems.length;a>r;++r)c=d.legendItems[r],s.update(this._graph,e.trans,"vg_legendPosition",c.items),o.mark(c,null,!0);o.mark(this._mark,null,!0)}return e.reflow=!0,e},t.exports=r},{"../dataflow/Node":34,"../util/boundscalc":106,"../util/constants":108,"../util/debug":109,"./Encoder":75,datalib:20}],74:[function(e,t,n){function r(){return arguments.length?this.init.apply(this,arguments):this}function i(){var e,t,n,r,i,a=this._def.from,s=a.mark;s?(t=["vg",this._parent_id,s].join("_"),n={name:t,transform:a.transform,modify:a.modify}):(e=this._graph.data(this._from),t=["vg",this._from,this._def.type,e.listeners(!0).length].join("_"),n={name:t,source:this._from,transform:a.transform,modify:a.modify}),this._from=t,this._ds=m.datasource(this._graph,n);var o=this._ds.revises();if(s)r=this.sibling(s).revises(o),r._isSuper?r.addListener(this._ds.listener()):r._bounder.addListener(this._ds.listener());else{var i=this._ds.source().revises(o).last();input=y.create(i),input.add=i.add,input.mod=i.mod,input.rem=i.rem,input.stamp=null,this._graph.propagate(input,this._ds.listener())}}function a(){var e=this._revises?null:void 0,t=g.ingest(new p(this._mark),e);return this._def.width&&g.set(t,"width",this._def.width),this._def.height&&g.set(t,"height",this._def.height),t}function s(e,t,n,r,i,s){var o,l,u,d,c,f;for(o=0,u=e.length;u>o;++o)c=e[o],d=t?this._map[l=t(c)]:i[o],f=d?!1:(d=a.call(this),!0),d.status=f?_.ENTER:_.UPDATE,d.datum=c,g.set(d,"key",l),this._map[l]=d,n.push(d),f?r.add.push(d):(!s||s&&s[c._id])&&r.mod.push(d)}function o(e,t,n){var r,i,a,o,l=y.create(e),d=u(this._def.key||"_id"),c=(e.add,e.mod),f=e.rem,h=[];for(r=0,a=f.length;a>r;++r)o=this._map[i=d(f[r])],o.status=_.EXIT,h.push(o),l.rem.push(o),this._map[i]=null;return s.call(this,t,d,h,l,null,g.idMap(n?t:c)),this._mark.items=h,l}function l(e,t,n){var r,i,a,o=y.create(e),l=u(this._def.key),d=this._mark.items||[],c=[];for(r=0,i=d.length;i>r;++r)a=d[r],a.status=_.EXIT,l&&(this._map[a.key]=a);for(s.call(this,t,l,c,o,d,n?g.idMap(t):null),r=0,i=d.length;i>r;++r)a=d[r],a.status===_.EXIT&&(g.set(a,"key",l?a.key:this._items.length),c.splice(0,0,a),o.rem.push(a));return this._mark.items=c,o}function u(e){if(null==e)return null;var t=d.array(e).map(d.accessor);return function(e){for(var n="",r=0,i=t.length;i>r;++r)r>0&&(n+="|"),n+=String(t[r](e));return n}}var d=e("datalib"),c=e("../dataflow/Node"),f=e("./Encoder"),h=e("./Bounder"),p=e("./Item"),m=e("../parse/data"),g=e("../dataflow/tuple"),y=e("../dataflow/changeset"),v=e("../util/debug"),_=e("../util/constants"),b=r.prototype=new c;b.init=function(e,t,n,r,a,s){return c.prototype.init.call(this,e).router(!0).collector(!0),this._def=t,this._mark=n,this._from=(t.from?t.from.data:null)||s,this._ds=d.isString(this._from)?e.data(this._from):null,this._map={},this._revises=!1,n.def=t,n.marktype=t.type,n.interactive=!(t.interactive===!1),n.items=[],this._parent=r,this._parent_id=a,t.from&&(t.from.mark||t.from.transform||t.from.modify)&&i.call(this),this._isSuper=this._def.type!==_.GROUP,this._encoder=new f(this._graph,this._mark),this._bounder=new h(this._graph,this._mark),this._ds&&this._encoder.dependency(_.DATA,this._from),this.dependency(_.DATA,this._encoder.dependency(_.DATA)),this.dependency(_.SCALES,this._encoder.dependency(_.SCALES)),this.dependency(_.SIGNALS,this._encoder.dependency(_.SIGNALS)),this},b.revises=function(e){return arguments.length?(!this._revises&&e&&this._items.forEach(function(e){void 0===e._prev&&(e._prev=_.SENTINEL)}),this._revises=this._revises||e,this):this._revises},b.pipeline=function(){return[this]},b.connect=function(){var e=this;return this._graph.connect(this.pipeline()),this._encoder._scales.forEach(function(t){(t=e._parent.scale(t))&&t.addListener(e)}),this._parent&&(this._isSuper?this.addListener(this._parent._collector):this._bounder.addListener(this._parent._collector)),this},b.disconnect=function(){var e=this;return this._listeners.length?(c.prototype.disconnect.call(this),this._graph.disconnect(this.pipeline()),this._encoder._scales.forEach(function(t){(t=e._parent.scale(t))&&t.removeListener(e)}),this):this},b.sibling=function(e){return this._parent.child(e,this._parent_id)},b.evaluate=function(e){v(e,["building",this._from,this._def.type]);var t,n,r,i,a;return this._ds?(t=y.create(e),i=t.data[a=this._ds.name()],delete t.data[a],n=this._encoder.reevaluate(t),t.data[a]=i,n&&(t.mod=this._mark.items.slice()),r=this._ds.last(),r?r.stamp>this._stamp&&(t=o.call(this,r,this._ds.values(),n)):t.reflow=!0):(n=this._encoder.reevaluate(e),i=d.isFunction(this._def.from)?this._def.from():[_.SENTINEL],t=l.call(this,e,i,n)),t=this._graph.evaluate(t,this._encoder),this._isSuper?this._graph.evaluate(t,this._bounder):t},t.exports=r},{"../dataflow/Node":34,"../dataflow/changeset":36,"../dataflow/tuple":37,"../parse/data":45,"../util/constants":108,"../util/debug":109,"./Bounder":73,"./Encoder":75,"./Item":77,datalib:20}],75:[function(e,t,n){function r(e,t){var n=t.def.properties||{},r=n.enter,i=n.update,a=n.exit;s.prototype.init.call(this,e),this._mark=t;var o=this._scales=[];return r&&o.push.apply(o,r.scales),i&&(this.dependency(l.DATA,i.data),this.dependency(l.SIGNALS,i.signals),this.dependency(l.FIELDS,i.fields),this.dependency(l.SCALES,i.scales),o.push.apply(o,i.scales)),a&&o.push.apply(o,a.scales),this}function i(e,t,n,r,i,a){var s=e.encode;s.call(s,t,t.mark.group||t,n,r,i,a)}var a=e("datalib"),s=e("../dataflow/Node"),o=e("../util/boundscalc"),l=e("../util/constants"),u=e("../util/debug"),d={},c=r.prototype=new s;c.evaluate=function(e){u(e,["encoding",this._mark.def.type]);var t,n,r,a,s=this._graph,o=(this._mark.items,this._mark.def.properties||{}),c=o.enter,f=o.update,h=o.exit,p=this._graph.predicates(),m=s.signalValues(),g=s.dataValues(),y=e.request;if(y){if(a=o[y])for(t=0,n=e.mod.length;n>t;++t)r=e.mod[t],i.call(this,a,r,e.trans,g,m,p);return e}for(t=0,n=e.rem.length;n>t;++t)r=e.rem[t],f&&i.call(this,f,r,e.trans,g,m,p),h&&i.call(this,h,r,e.trans,g,m,p),e.trans&&!h?e.trans.interpolate(r,d):e.trans||r.remove();for(t=0,n=e.add.length;n>t;++t)r=e.add[t],c&&i.call(this,c,r,e.trans,g,m,p),f&&i.call(this,f,r,e.trans,g,m,p),r.status=l.UPDATE;if(f)for(t=0,n=e.mod.length;n>t;++t)r=e.mod[t],i.call(this,f,r,e.trans,g,m,p);return e},c.reevaluate=function(e){var t=this._mark.def.properties||{},n=t.update;return e.request||s.prototype.reevaluate.call(this,e)||(n?n.reflow:!1)},r.update=function(e,t,n,r){r=a.array(r);var s,l,u,d,c,f=e.predicates(),h=e.dataValues(),p=e.signalValues();for(s=0,l=r.length;l>s;++s)u=r[s],d=u.mark.def.properties,c=d&&d[n],c&&(i.call(null,c,u,t,h,p,f),o.item(u))},t.exports=r},{"../dataflow/Node":34,"../util/boundscalc":106,"../util/constants":108,"../util/debug":109,datalib:20}],76:[function(e,t,n){function r(){return this._children={},this._scaler=null,this._recursor=null,this._scales={},this.scale=a.bind(this),arguments.length?this.init.apply(this,arguments):this}function i(e){var t,n,r,i,a,s=this,f=d.array(this._def.marks).length>0,h=d.array(this._def.axes).length>0,p=d.array(this._def.legends).length>0,m=!1;for(t=0,n=e.add.length;n>t;++t)r=e.add[t],f&&o.call(this,e,r),h&&l.call(this,e,r),p&&u.call(this,e,r);for(t=e.add.length-1;t>=0;--t)for(r=e.add[t],j=this._children[r._id].length-1;j>=0;--j)c=this._children[r._id][j],c.builder.connect(),i=c.builder.pipeline(),a=c.builder._def,m=a.type!==_.GROUP,m=m&&void 0!==this._graph.data(c.from),m=m&&1==i[i.length-1].listeners().length,c.inline=m,m?c.builder.evaluate(e):this._recursor.addListener(c.builder);for(t=0,n=e.mod.length;n>t;++t)r=e.mod[t],f&&s._children[r._id].forEach(function(e){e.type!=_.MARK||e.inline||void 0===s._graph.data(e.from)||s._recursor.removeListener(e.builder)}),h&&r.axes.forEach(function(t,n){var r=t.scale();e.scales[r.scaleName]&&t.reset().def()}),p&&r.legends.forEach(function(t,n){var r=t.size()||t.shape()||t.fill()||t.stroke();e.scales[r.scaleName]&&t.reset().def()});for(t=0,n=e.rem.length;n>t;++t)r=e.rem[t],s._children[r._id].forEach(function(e){s._recursor.removeListener(e.builder),e.builder.disconnect()}),delete s._children[r._id];return e}function a(e,t){var n=this;if(2===arguments.length)return n._scales[e]=t,t;for(;null==t&&(t=n._scales[e],n=n.mark?n.mark.group:n._parent););return t}function s(e,t){v(e,["building group",t._id]),t._scales=t._scales||{},t.scale=a.bind(t),t.items=t.items||[],this._children[t._id]=this._children[t._id]||[],t.axes=t.axes||[],t.axisItems=t.axisItems||[],t.legends=t.legends||[],t.legendItems=t.legendItems||[]}function o(e,t){v(e,["building marks",t._id]);var n,i,a,s,o,l,u=this._def.marks;for(s=0,o=u.length;o>s;++s)n=u[s],i=n.from||{},a="vg_"+t.datum._id,t.items[s]={group:t},l=n.type===_.GROUP?new r:new p,l.init(this._graph,n,t.items[s],this,t._id,a),this._children[t._id].push({builder:l,from:i.data||(i.mark?"vg_"+t._id+"_"+i.mark:a),type:_.MARK})}function l(e,t){var n=t.axes,i=t.axisItems,a=this;g(this._graph,this._def.axes,n,t),n.forEach(function(e,n){var s=a._def.axes[n].scale,o=e.def(),l=null;i[n]={group:t,axisDef:o},l=o.type===_.GROUP?new r:new p,l.init(a._graph,o,i[n],a).dependency(_.SCALES,s),a._children[t._id].push({builder:l,type:_.AXIS,scale:s})})}function u(e,t){var n=t.legends,i=t.legendItems,a=this;y(this._graph,this._def.legends,n,t),n.forEach(function(e,n){var s=e.size()||e.shape()||e.fill()||e.stroke(),o=e.def(),l=null;i[n]={group:t,legendDef:o},l=o.type===_.GROUP?new r:new p,l.init(a._graph,o,i[n],a).dependency(_.SCALES,s),a._children[t._id].push({builder:l,type:_.LEGEND,scale:s})})}var d=e("datalib"),f=e("../dataflow/Node"),h=e("../dataflow/Collector"),p=e("./Builder"),m=e("./Scale"),g=e("../parse/axes"),y=e("../parse/legends"),v=e("../util/debug"),_=e("../util/constants"),b=r.prototype=new p;b.init=function(e,t,n,r,a,s){var o,l=this;this._scaler=new f(e),(t.scales||[]).forEach(function(t){t=l.scale(o=t.name,new m(e,t,l)),l.scale(o+":prev",t),l._scaler.addListener(t)}),this._recursor=new f(e),this._recursor.evaluate=i.bind(this);var u=(t.axes||[]).reduce(function(e,t){return e[t.scale]=1,e},{});return u=(t.legends||[]).reduce(function(e,t){return e[t.size||t.shape||t.fill||t.stroke],e},u),this._recursor.dependency(_.SCALES,d.keys(u)),this._collector=new h(e),p.prototype.init.apply(this,arguments)},b.evaluate=function(e){var t=p.prototype.evaluate.apply(this,arguments),n=this;return t.add.forEach(function(e){s.call(n,t,e)}),t},b.pipeline=function(){return[this,this._scaler,this._recursor,this._collector,this._bounder]},b.disconnect=function(){var e=this;return d.keys(e._children).forEach(function(t){e._children[t].forEach(function(t){e._recursor.removeListener(t.builder),t.builder.disconnect()})}),e._children={},p.prototype.disconnect.call(this)},b.child=function(e,t){for(var n,r=this._children[t],i=0,a=r.length;a>i&&(n=r[i],n.type!=_.MARK||n.builder._def.name!=e);++i);return n.builder},t.exports=r},{"../dataflow/Collector":31,"../dataflow/Node":34,"../parse/axes":43,"../parse/legends":50,"../util/constants":108,"../util/debug":109,"./Builder":74,"./Scale":78,datalib:20}],77:[function(e,t,n){function r(e){this.mark=e}var i=r.prototype;i.hasPropertySet=function(e){var t=this.mark.def.properties;return t&&null!=t[e]},i.cousin=function(e,t){if(0===e)return this;e=e||-1;var n=this.mark,r=n.group,i=null==t?n.items.indexOf(this):t,a=r.items.indexOf(n)+e;return r.items[a].items[i]},i.sibling=function(e){if(0===e)return this;e=e||-1;var t=this.mark,n=t.items.indexOf(this)+e;return t.items[n]},i.remove=function(){var e=this,t=e.mark.items,n=t.indexOf(e);return n>=0&&(n===t.length-1?t.pop():t.splice(n,1)),e},i.touch=function(){this.pathCache&&(this.pathCache=null),this.mark.pathCache&&(this.mark.pathCache=null)},t.exports=r},{}],78:[function(e,t,n){(function(n){function r(e,t,n){return this._def=t,this._parent=n,this._updated=!1,_.prototype.init.call(this,e)}function i(e){var t=this._def.name,n=t+":prev",r=a.call(this,e.scale(t)),i=r.type===k.ORDINAL?s:o,l=g.call(this,e);return i.call(this,r,l,e),e.scale(t,r),e.scale(n,e.scale(n)||r),r}function a(e){var t=this._def.type||k.LINEAR;if(!e||t!==e.type){var n=w.scale[t]||v.scale[t];n||y.error("Unrecognized scale type: "+t),(e=n()).type=e.type||t,e.scaleName=this._def.name,e._prev={}}return e}function s(e,t,n){var r,i,a=this._def,s=e._prev,o=!1,l=a.padding||0,u=null==a.outerPadding?l:a.outerPadding;if(y.isObject(a.range)&&!y.isArray(a.range)&&(o=!0,t=h.call(this,k.RANGE,a.range,e,n)),r=h.call(this,k.DOMAIN,a.domain,e,n),r&&!y.equal(s.domain,r)&&(e.domain(r),s.domain=r,this._updated=!0),!y.equal(s.range,t)){if(a.bandWidth){var d=a.bandWidth,c=r.length,f=t[0]||0,p=a.points?l*d:l*d*(c-1)+2*u;t=[f,f+(d*c+p)]}i="string"==typeof t[0],i||t.length>2||1===t.length||o?e.range(t):a.points&&(a.round||null==a.round)?e.rangeRoundPoints(t,l):a.points?e.rangePoints(t,l):a.round||null==a.round?e.rangeRoundBands(t,l,u):e.rangeBands(t,l,u),s.range=t,this._updated=!0}}function o(e,t,n){var r,i,a=this._def,s=e._prev;r=a.type===k.QUANTILE?h.call(this,k.DOMAIN,a.domain,e,n):m.call(this,e,n),r&&!y.equal(s.domain,r)&&(e.domain(r),s.domain=r,this._updated=!0),"height"===a.range&&(t=t.reverse()),y.equal(s.range,t)||(e[a.round&&e.rangeRound?"rangeRound":"range"](t),s.range=t,this._updated=!0,this._stamp>0||(a.exponent&&a.type===k.POWER&&e.exponent(a.exponent),a.clamp&&e.clamp(!0),a.nice&&(a.type===k.TIME?(i=v.time[a.nice],i||y.error("Unrecognized interval: "+i),e.nice(i)):e.nice())))}function l(e){return e.type===k.ORDINAL||e.type===k.QUANTILE}function u(e){return e.fields||y.array(e)}function d(e,t){return y.array(e.field).map(function(e){return e.parent?y.accessor(e.parent)(t.datum):e})}function c(e,t){var n=u(e);return 1==n.length&&1==y.array(n[0].field).length?b.TYPES.TUPLE:l(t)&&e.sort?b.TYPES.MULTI:b.TYPES.VALUE}function f(e,t,n,r){var i,a=u(t),s=c(t,n),o=l(n),f=t.sort,h="_"+e,p=d(a[0],r);if(n[h])return n[h];var m,g,v=n[h]=new b(this._graph).type(s);return o?s===b.TYPES.VALUE?(m=[{name:k.GROUPBY,get:y.identity}],g={"*":k.COUNT}):s===b.TYPES.TUPLE?(m=[{name:k.GROUPBY,get:y.$(p[0])}],g=f?[{name:k.VALUE,get:y.$(i.sort||f.field),ops:[f.stat]}]:{"*":k.COUNT}):(m=k.GROUPBY,g=[{name:k.VALUE,ops:[f.stat]}]):(m=[],g=[{name:k.VALUE,get:s==b.TYPES.TUPLE?y.$(p[0]):y.identity,ops:[k.MIN,k.MAX],as:[k.MIN,k.MAX]}]),v.param("groupby",m).param("summarize",g),v}function h(e,t,n,r){if(null==t)return[];if(y.isArray(t))return t.map(p.bind(this));var i,a,s,o,h,m,g,v=this,_=this._graph,x=u(t),w=c(t,n),E=f.apply(this,arguments),S=t.sort,A=l(n);for(i=0,a=x.length;a>i;++i)if(h=x[i],from=h.data||"vg_"+r.datum._id,data=_.data(from).revises(!0).last(),!(data.stamp<=this._stamp)){for(m=d(h,r),s=0,o=m.length;o>s;++s)g=m[s],w===b.TYPES.VALUE?E.accessors(null,g):w===b.TYPES.MULTI&&E.accessors(g,h.sort||S.field),E.evaluate(data);this.dependency(k.DATA,from),E.dependency(k.SIGNALS).forEach(function(e){v.dependency(k.SIGNALS,e)})}return data=E.aggr().result(),A?(S&&(S=S.order.signal?_.signalRef(S.order.signal):S.order,S=(S==k.DESC?"-":"+")+k.VALUE,S=y.comparator(S),data=data.sort(S)),data.map(function(e){return e[k.GROUPBY]})):(data=data[0],y.isValid(data)?[data[k.MIN],data[k.MAX]]:[])}function p(e){var t,n=e.signal;return n?(this.dependency(k.SIGNALS,(t=y.field(n))[0]),this._graph.signalRef(t)):e}function m(e,t){var n,r=this._def,i=[null,null];return void 0!==r.domain&&(i=y.isObject(r.domain)?h.call(this,k.DOMAIN,r.domain,e,t):i),n=i.length-1,void 0!==r.domainMin&&(i[0]=y.isObject(r.domainMin)?r.domainMin.signal?p.call(this,r.domainMin):h.call(this,k.DOMAIN+k.MIN,r.domainMin,e,t)[0]:r.domainMin),void 0!==r.domainMax&&(i[n]=y.isObject(r.domainMax)?r.domainMax.signal?p.call(this,r.domainMax):h.call(this,k.DOMAIN+k.MAX,r.domainMax,e,t)[1]:r.domainMax),r.type===k.LOG||r.type===k.TIME||!r.zero&&void 0!==r.zero||(i[0]=Math.min(0,i[0]),i[n]=Math.max(0,i[n])),i}function g(e){var t=this._def,n=[null,null];if(void 0!==t.range)if("string"==typeof t.range)if(E[t.range])n=[0,e[t.range]];else{if(!w.range[t.range])return y.error("Unrecogized range: "+t.range),n;n=w.range[t.range]}else if(y.isArray(t.range))n=y.duplicate(t.range).map(p.bind(this));else{if(y.isObject(t.range))return null;n=[0,t.range]}if(void 0!==t.rangeMin&&(n[0]=t.rangeMin.signal?p.call(this,t.rangeMin):t.rangeMin),void 0!==t.rangeMax&&(n[n.length-1]=t.rangeMax.signal?p.call(this,t.rangeMax):t.rangeMax),void 0!==t.reverse){var r=t.reverse;y.isObject(r)&&(r=y.accessor(r.field)(e.datum)),r&&(n=n.reverse())}return n}var y=e("datalib"),v="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,_=e("../dataflow/Node"),b=e("../transforms/Aggregate"),x=e("../dataflow/changeset"),w=(e("../util/debug"),e("../util/config")),k=e("../util/constants"),E={width:1,height:1},S=r.prototype=new _;S.evaluate=function(e){var t=this,n=function(e){i.call(t,e)};return this._updated=!1,e.add.forEach(n),e.mod.forEach(n),this._updated&&(e.scales[this._def.name]=1),x.create(e,!0)},S.dependency=function(e,t){if(2==arguments.length){t=y.array(t);for(var n=0,r=t.length;r>n;++n)this._graph[e==k.DATA?k.DATA:k.SIGNAL](t[n]).addListener(this._parent)}return _.prototype.dependency.call(this,e,t)},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/Node":34,"../dataflow/changeset":36,"../transforms/Aggregate":83,"../util/config":107,"../util/constants":108,"../util/debug":109,datalib:20}],79:[function(e,t,n){function r(e,t){this.duration=e||500,this.ease=t&&d3.ease(t)||d3.ease("cubic-in-out"),this.updates={next:null}}function i(e){for(var t,n,r,i,a,o,l=this.updates,u=l,d=u.next,c=this.duration,f=!0;null!=d;u=d,d=u.next)if(t=d.item,n=t.delay||0,r=(e-n)/c,0>r)f=!1;else{for(r>1&&(r=1),i=d.ease(r),a=0,o=d.length;o>a;++a)t[d[a].property]=d[a](i);t.touch(),s.item(t),1===r?(d.remove&&t.remove(),u.next=d.next,d=u):f=!1}return this.callback(),f}var a=e("../dataflow/tuple"),s=e("../util/boundscalc"),o=e("../util/constants"),l=r.prototype,u={text:1,url:1};l.interpolate=function(e,t,n){var r,i,s,l,d=null;for(r in t)i=e[r],s=t[r],i!==s&&(u[r]||void 0===i?a.set(e,r,s):"number"!=typeof i||isFinite(i)?(l=d3.interpolate(i,s),l.property=r,(d||(d=[])).push(l)):a.set(e,r,s));return null===d&&e.status===o.EXIT&&(d=[]),null!=d&&(d.item=e,d.ease=e.mark.ease||this.ease,d.next=this.updates.next,this.updates.next=d),this},l.start=function(e){for(var t=this,n=t.updates,r=n.next;null!=r;n=r,r=n.next)r.item.status===o.EXIT&&(r.remove=!0);t.callback=e,d3.timer(function(e){return i.call(t,e)})},t.exports=r},{"../dataflow/tuple":37,"../util/boundscalc":106,"../util/constants":108}],80:[function(e,t,n){(function(n){function r(e){function t(){L.type=null}function n(e){return{data:e}}function r(){return D||("log"===k.type?".1s":null)}function a(){var e=r();return k.tickFormat?k.tickFormat(q,e):e?"time"===k.type?g.time.format(e):g.format(e):String}function _(e){var t={major:j,minor:null};return null==t.major&&(t.major=k.ticks?k.ticks(q):k.domain()),t.minor=i(k,t.major,z).map(n),t.major=t.major.map(function(t){return t=n(t),t.label=e(t.data),t}),t}function w(t){var n,r,i;"ordinal"===t.type?(n={scale:t.scaleName,offset:.5+t.rangeBand()/2},r=n):(n={scale:t.scaleName,offset:.5},r={scale:t.scaleName+":prev",offset:.5}),i=s(t),y.extend(W.gridLines,f()),y.extend(W.majorTicks,f()),y.extend(W.minorTicks,f()),y.extend(W.tickLabels,h()),y.extend(W.domain,m()),y.extend(W.title,p()),W.gridLines.properties.enter.stroke={value:v.axis.gridColor},l(E,W.gridLines,r,n,1/0),l(E,W.majorTicks,r,n,P),l(E,W.minorTicks,r,n,I),o(E,W.tickLabels,r,n,P,O),d(E,W.domain,i,N),u(E,W.title,i,A),y.extend(W.gridLines.properties.update,$),y.extend(W.majorTicks.properties.update,R),y.extend(W.minorTicks.properties.update,F),y.extend(W.tickLabels.properties.update,U),y.extend(W.domain.properties.update,G),y.extend(W.title.properties.update,V);var a=[W.gridLines,W.majorTicks,W.minorTicks,W.tickLabels,W.domain,W.title];y.extend(L,{type:"group",interactive:!1,properties:{enter:{encode:c,scales:[t.scaleName],signals:[],data:[]},update:{encode:c,scales:[t.scaleName],signals:[],data:[]}}}),L.marks=a.map(function(t){return b(e,t)})}var k,E=v.axis.orient,S=0,A=v.axis.titleOffset,L={},T="front",M=!1,C=null,P=v.axis.tickSize,I=v.axis.tickSize,N=v.axis.tickSize,O=v.axis.padding,j=null,D=null,z=0,q=v.axis.ticks,$={},U={},R={},F={},V={},G={},W={gridLines:{},majorTicks:{},minorTicks:{},tickLabels:{},domain:{},title:{}},B={};return B.def=function(){L.type||w(k);var e=a(),t=_(e),r=C?[C].map(n):[];return L.marks[0].from=function(){return M?t.major:[]},L.marks[1].from=function(){return t.major},L.marks[2].from=function(){return t.minor},L.marks[3].from=L.marks[1].from,L.marks[4].from=function(){return[1]},L.marks[5].from=function(){return r},L.offset=S,L.orient=E,L.layer=T,L},B.scale=function(e){return arguments.length?(k!==e&&(k=e,t()),B):k},B.orient=function(e){return arguments.length?(E!==e&&(E=e in x?e+"":v.axis.orient,t()),B):E},B.title=function(e){return arguments.length?(C!==e&&(C=e,t()),B):C},B.tickCount=function(e){return arguments.length?(q=e,B):q},B.tickValues=function(e){return arguments.length?(j=e,B):j},B.tickFormat=function(e){return arguments.length?(D!==e&&(D=e,t()),B):D},B.tickSize=function(e,n){if(!arguments.length)return P;var r=arguments.length-1,i=+e,a=r>1?+n:P,s=r>0?+arguments[r]:P;return(P!==i||I!==a||N!==s)&&t(),P=i,I=a,N=s,B},B.tickSubdivide=function(e){return arguments.length?(z=+e,B):z},B.offset=function(e){return arguments.length?(S=y.isObject(e)?e:+e,B):S},B.tickPadding=function(e){return arguments.length?(O!==+e&&(O=+e,t()),B):O},B.titleOffset=function(e){return arguments.length?(A!==+e&&(A=+e,t()),B):A},B.layer=function(e){return arguments.length?(T!==e&&(T=e,t()),B):T},B.grid=function(e){return arguments.length?(M!==e&&(M=e,t()),B):M},B.gridLineProperties=function(e){return arguments.length?($!==e&&($=e),B):$},B.majorTickProperties=function(e){return arguments.length?(R!==e&&(R=e),B):R},B.minorTickProperties=function(e){return arguments.length?(F!==e&&(F=e),B):F},B.tickLabelProperties=function(e){return arguments.length?(U!==e&&(U=e),B):U},B.titleProperties=function(e){return arguments.length?(V!==e&&(V=e),B):V},B.domainProperties=function(e){return arguments.length?(G!==e&&(G=e),B):G},B.reset=function(){return t(),B},B}function i(e,t,n){if(r=[],n&&t.length>1){for(var r,i,s,o=a(e.domain()),l=-1,u=t.length,d=(t[1]-t[0])/++n;++l<u;)for(i=n;--i>0;)(s=+t[l]-i*d)>=o[0]&&r.push(s);for(--l,i=0;++i<n&&(s=+t[l]+i*d)<o[1];)r.push(s)}return r}function a(e){var t=e[0],n=e[e.length-1];return n>t?[t,n]:[n,t]}function s(e){return e.rangeExtent?e.rangeExtent():a(e.range())}function o(e,t,n,r,i,a){i=Math.max(i,0)+a,("left"===e||"top"===e)&&(i*=-1),"top"===e||"bottom"===e?(y.extend(t.properties.enter,{x:n,y:{value:i}}),y.extend(t.properties.update,{x:r,y:{value:i},align:{value:"center"},baseline:{value:k[e]}})):(y.extend(t.properties.enter,{x:{value:i},y:n}),y.extend(t.properties.update,{x:{value:i},y:r,align:{value:w[e]},baseline:{value:"middle"}}))}function l(e,t,n,r,i){var a="left"===e||"top"===e?-1:1;i=i===1/0?"top"===e||"bottom"===e?{field:{group:"height",level:2},mult:-a}:{field:{group:"width",level:2},mult:-a}:{value:a*i},"top"===e||"bottom"===e?(y.extend(t.properties.enter,{x:n,y:{value:0},y2:i}),y.extend(t.properties.update,{x:r,y:{value:0},y2:i}),y.extend(t.properties.exit,{x:r})):(y.extend(t.properties.enter,{x:{value:0},x2:i,y:n}),y.extend(t.properties.update,{x:{value:0},x2:i,y:r}),y.extend(t.properties.exit,{y:r}))}function u(e,t,n,r){var i=~~((n[0]+n[1])/2),a="top"===e||"left"===e?-1:1;"bottom"===e||"top"===e?y.extend(t.properties.update,{x:{value:i},y:{value:a*r},angle:{value:0}}):y.extend(t.properties.update,{x:{value:a*r},y:{value:i},angle:{value:-90}})}function d(e,t,n,r){var i;("top"===e||"left"===e)&&(r=-1*r),i="bottom"===e||"top"===e?"M"+n[0]+","+r+"V0H"+n[1]+"V"+r:"M"+r+","+n[0]+"H0V"+n[1]+"H"+r,t.properties.update.path={value:i}}function c(e,t,n,r,i,a){var s=n?{}:e,o=e.mark.def.offset,l=e.mark.def.orient,u=t.width,d=t.height;if(y.isArray(o)){var c=o[0],f=o[1];switch(l){case"left":_.set(s,"x",-c),_.set(s,"y",f);break;case"right":_.set(s,"x",u+c),_.set(s,"y",f);break;case"bottom":_.set(s,"x",c),_.set(s,"y",d+f);break;case"top":_.set(s,"x",c),_.set(s,"y",-f);break;default:_.set(s,"x",c),_.set(s,"y",f)}}else switch(y.isObject(o)&&(o=-t.scale(o.scale)(o.value)),l){case"left":_.set(s,"x",-o),_.set(s,"y",0);break;case"right":_.set(s,"x",u+o),_.set(s,"y",0);break;case"bottom":_.set(s,"x",0),_.set(s,"y",d+o);break;case"top":_.set(s,"x",0),_.set(s,"y",-o);break;default:_.set(s,"x",0),_.set(s,"y",0)}n&&n.interpolate(e,s)}function f(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:v.axis.tickColor},strokeWidth:{value:v.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function h(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:v.axis.tickLabelColor},font:{value:v.axis.tickLabelFont},fontSize:{value:v.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function p(){return{type:"text",interactive:!0,properties:{enter:{font:{value:v.axis.titleFont},fontSize:{value:v.axis.titleFontSize},fontWeight:{value:v.axis.titleFontWeight},fill:{value:v.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function m(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:v.axis.axisColor},strokeWidth:{value:v.axis.axisWidth}},update:{}}}}var g="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,y=e("datalib"),v=e("../util/config"),_=e("../dataflow/tuple"),b=e("../parse/mark"),x={top:1,right:1,bottom:1,left:1},w={bottom:"center",top:"center",left:"right",right:"left"},k={bottom:"top",top:"bottom",left:"middle",right:"middle"};t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":37,"../parse/mark":51,"../util/config":107,datalib:20}],81:[function(e,t,n){(function(n){function r(e){function t(){w.type=null;

}function n(e,t){return{data:e,index:t}}function r(e){return"ordinal"===e||"quantize"===e||"quantile"===e||"threshold"===e}function v(e){var t,r,i,a=_(k,E,S,A),s=(null==T?e.ticks?e.ticks.apply(e,j):e.domain():T).map(n),o=null==M?e.tickFormat?e.tickFormat.apply(e,j):String:M,l=5,u=c.range(s.length);k?(r=s.map(function(e){return Math.sqrt(k(e.data))}),i=c.max(r),r=r.reduce(function(e,t,n,r){return n>0&&(e[n]=e[n-1]+r[n-1]/2+l),e[n]+=t/2,e},[0]).map(Math.round)):(i=Math.round(Math.sqrt(g.legend.symbolSize)),r=L||(t=U.fontSize)&&t.value+l||g.legend.labelFontSize+l,r=u.map(function(e,t){return Math.round(i/2+t*r)}));var d,f=O;P&&(d=$.fontSize,f+=5+(d&&d.value||g.legend.titleFontSize));for(var h=0,p=r.length;p>h;++h)r[h]+=f;var e={name:"legend",type:"ordinal",points:!0,domain:u,range:r},m=(P?[P]:[]).map(n);return s.forEach(function(e){e.label=o(e.data),e.offset=i}),a.scales=[e],a.marks[0].from=function(){return m},a.marks[1].from=function(){return s},a.marks[2].from=a.marks[1].from,a}function _(t,n,r,u){var d=f.extend(R.titles,s()),c=f.extend(R.symbols,o()),m=f.extend(R.labels,l());return a(c,t,n,r,u),f.extend(d.properties.update,$),f.extend(c.properties.update,z),f.extend(m.properties.update,U),d.properties.enter.x.value+=O,d.properties.enter.y.value+=O,m.properties.enter.x.offset+=O+1,c.properties.enter.x.offset=O+1,m.properties.update.x.offset+=O+1,c.properties.update.x.offset=O+1,f.extend(w,{type:"group",interactive:!1,properties:{enter:h(e,"group",D),vg_legendPosition:{encode:i,signals:[],scales:[],data:[],fields:[]}}}),w.marks=[d,c,m].map(function(t){return p(e,t)}),w}function b(e){var t=x(e),r=e.domain(),i=r.map(n),a=q.width&&q.width.value||g.legend.gradientWidth,s=null==M?e.tickFormat?e.tickFormat.apply(e,j):String:M,o={name:"legend",type:e.type,round:!0,zero:!1,domain:[r[0],r[r.length-1]],range:[O,a+O]};"pow"===e.type&&(o.exponent=e.exponent());var l=(P?[P]:[]).map(n);return i.forEach(function(e,t){e.label=s(e.data),e.align=t==i.length-1?"right":0==t?"left":"center"}),t.scales=[o],t.marks[0].from=function(){return l},t.marks[1].from=function(){return[1]},t.marks[2].from=function(){return i},t}function x(t){var n=f.extend(R.title,s()),r=f.extend(R.gradient,u()),a=f.extend(R.labels,d()),o=new m,l=t.domain(),c=l[0],g=l[l.length-1],y=t.copy().domain([c,g]).range([0,1]),v="linear"!==t.type&&t.ticks?t.ticks.call(t,15):l;c!==v[0]&&v.unshift(c),g!==v[v.length-1]&&v.push(g);for(var _=0,b=v.length;b>_;++_)o.stop(y(v[_]),t(v[_]));r.properties.enter.fill={value:o},f.extend(n.properties.update,$),f.extend(r.properties.update,q),f.extend(a.properties.update,U);var x=r.properties,k=q.height,E=k&&k.value||x.enter.height.value;if(a.properties.enter.y.value=E,a.properties.update.y.value=E,P){var S=n.properties,A=$.fontSize,L=4+(A&&A.value||S.enter.fontSize.value);r.properties.enter.y.value+=L,a.properties.enter.y.value+=L,r.properties.update.y.value+=L,a.properties.update.y.value+=L}return n.properties.enter.x.value+=O,n.properties.enter.y.value+=O,r.properties.enter.x.value+=O,r.properties.enter.y.value+=O,a.properties.enter.y.value+=O,r.properties.update.x.value+=O,r.properties.update.y.value+=O,a.properties.update.y.value+=O,f.extend(w,{type:"group",interactive:!1,properties:{enter:h(e,"group",D),vg_legendPosition:{encode:i,signals:[],scales:[],data:[],fields:[]}}}),w.marks=[n,r,a].map(function(t){return p(e,t)}),w}var w,k=null,E=null,S=null,A=null,L=null,T=null,M=null,C=null,P=void 0,I="right",N=g.legend.offset,O=g.legend.padding,j=[5],D={},z={},q={},$={},U={},R={titles:{},symbols:{},labels:{},gradient:{}},F={},w={};return F.def=function(){var e=k||E||S||A;return M=C?"time"===e.type?c.time.format(C):c.format(C):null,w.type||(w=e!==S&&e!==A||r(e.type)?v(e):b(e)),w.orient=I,w.offset=N,w.padding=O,w},F.size=function(e){return arguments.length?(k!==e&&(k=e,t()),F):k},F.shape=function(e){return arguments.length?(E!==e&&(E=e,t()),F):E},F.fill=function(e){return arguments.length?(S!==e&&(S=e,t()),F):S},F.stroke=function(e){return arguments.length?(A!==e&&(A=e,t()),F):A},F.title=function(e){return arguments.length?(P!==e&&(P=e,t()),F):P},F.format=function(e){return arguments.length?(C!==e&&(C=e,t()),F):C},F.spacing=function(e){return arguments.length?(L!==+e&&(L=+e,t()),F):L},F.orient=function(e){return arguments.length?(I=e in y?e+"":g.legend.orient,F):I},F.offset=function(e){return arguments.length?(N=+e,F):N},F.values=function(e){return arguments.length?(T=e,F):T},F.legendProperties=function(e){return arguments.length?(D=e,F):D},F.symbolProperties=function(e){return arguments.length?(z=e,F):z},F.gradientProperties=function(e){return arguments.length?(q=e,F):q},F.labelProperties=function(e){return arguments.length?(U=e,F):U},F.titleProperties=function(e){return arguments.length?($=e,F):$},F.reset=function(){return t(),F},F}function i(e,t,n,r,i,a){var s,o=n?{}:e,l=e.mark.def.offset,u=e.mark.def.orient,d=2*e.mark.def.padding,c=~~e.bounds.width()+(e.width?0:d),f=~~e.bounds.height()+(e.height?0:d),h=t._legendPositions||(t._legendPositions={right:.5,left:.5});switch(o.x=.5,o.width=c,o.y=h[u],h[u]+=o.height=f,!n&&t.bounds&&(t.bounds.delta=t.bounds.x2-t.width),u){case"left":s=t.bounds?t.bounds.x1:0,o.x+=s-l-c;break;case"right":s=t.width,t.bounds&&(s=n?t.width+t.bounds.delta:t.bounds.x2),o.x+=s+l}n&&n.interpolate(e,o);var p=e.mark.def.properties.enter.encode;p.call(p,e,t,n)}function a(e,t,n,r,i){var a=e.properties.enter,s=e.properties.update;t&&(a.size=s.size={scale:t.scaleName,field:"data"}),n&&(a.shape=s.shape={scale:n.scaleName,field:"data"}),r&&(a.fill=s.fill={scale:r.scaleName,field:"data"}),i&&(a.stroke=s.stroke={scale:i.scaleName,field:"data"})}function s(){var e=g.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{value:0},y:{value:0},fill:{value:e.titleColor},font:{value:e.titleFont},fontSize:{value:e.titleFontSize},fontWeight:{value:e.titleFontWeight},baseline:{value:"top"},text:{field:"data"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function o(){var e=g.legend;return{type:"symbol",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},shape:{value:e.symbolShape},size:{value:e.symbolSize},stroke:{value:e.symbolColor},strokeWidth:{value:e.symbolStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},opacity:{value:1}}}}}function l(){var e=g.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",offset:5},y:{scale:"legend",field:"index"},fill:{value:e.labelColor},font:{value:e.labelFont},fontSize:{value:e.labelFontSize},align:{value:e.labelAlign},baseline:{value:e.labelBaseline},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1},x:{field:"offset",offset:5},y:{scale:"legend",field:"index"}}}}}function u(){var e=g.legend;return{type:"rect",interactive:!1,properties:{enter:{x:{value:0},y:{value:0},width:{value:e.gradientWidth},height:{value:e.gradientHeight},stroke:{value:e.gradientStrokeColor},strokeWidth:{value:e.gradientStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{value:0},y:{value:0},opacity:{value:1}}}}}function d(){var e=g.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{scale:"legend",field:"data"},y:{value:20},dy:{value:2},fill:{value:e.labelColor},font:{value:e.labelFont},fontSize:{value:e.labelFontSize},align:{field:"align"},baseline:{value:"top"},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{scale:"legend",field:"data"},y:{value:20},opacity:{value:1}}}}}var c="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,f=e("datalib"),h=e("../parse/properties"),p=e("../parse/mark"),m=e("../util/Gradient"),g=e("../util/config"),y={right:1,left:1};t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../parse/mark":51,"../parse/properties":56,"../util/Gradient":105,"../util/config":107,datalib:20}],82:[function(e,t,n){t.exports=function r(e,t){var n,i,a,s,o;if(t(e))return!0;var l=["items","axisItems","legendItems"];for(a=0,s=l.length;s>a;++a)if(o=e[l[a]])for(n=0,i=o.length;i>n;++n)if(r(o[n],t))return!0}},{}],83:[function(e,t,n){function r(e){return o.prototype.init.call(this,e).router(!0).revises(!0),o.addParameters(this,{groupby:{type:"array<field>"},summarize:{type:"custom",set:function(e){var t,n,r,i,a,o,l={};if(!s.isArray(i=e)){i=[];for(a in e)o=s.array(e[a]),i.push({name:a,ops:o})}for(t=0,n=i.length;n>t;++t)r=i[t],r.name.signal&&(l[r.name.signal]=1),s.array(r.ops).forEach(function(e){e.signal&&(l[e.signal]=1)});return this._transform._fieldsDef=i,this._transform._aggr=null,this._transform.dependency(f.SIGNALS,s.keys(l)),this._transform}}}),this._fieldsDef=[],this._aggr=null,this._type=p.TUPLE,this._acc={groupby:s["true"],value:s["true"]},this._cache={},this._prev={},this}function i(e){var t=this._acc;return this._type===p.TUPLE?e:this._type===p.VALUE?t.value(e):this._cache[e._id]||(this._cache[e._id]={_id:e._id,groupby:t.groupby(e),value:t.value(e)})}function a(e){var t=this._prev[e._id]||(this._prev[e._id]=Object.create(e));return s.extend(t,e._prev)}var s=e("datalib"),o=e("./Transform"),l=e("./Facetor"),u=e("../dataflow/tuple"),d=e("../dataflow/changeset"),c=e("../util/debug"),f=e("../util/constants"),h=r.prototype=new o,p=r.TYPES={VALUE:1,TUPLE:2,MULTI:3};h.type=function(e){return this._type=e,this},h.accessors=function(e,t){var n=this._acc;n.groupby=s.$(e)||s["true"],n.value=s.$(t)||s["true"]},h.aggr=function(){if(this._aggr)return this._aggr;var e=this._graph,t=this.param("groupby").field,n=this._fieldsDef.map(function(t){var n=s.duplicate(t);return t.get&&(n.get=t.get),n.name=n.name.signal?e.signalRef(n.name.signal):n.name,n.ops=n.ops.signal?e.signalRef(n.ops.signal):s.array(n.ops).map(function(t){return t.signal?e.signalRef(t.signal):t}),n}),r=this._aggr=(new l).groupby(t).stream(!0).summarize(n);return this._type!==p.VALUE&&r.key("_id"),r},h._reset=function(e,t){t.rem.push.apply(t.rem,this.aggr().result()),this.aggr().clear(),this._aggr=null},h.transform=function(e,t){c(e,["aggregate"]);var n=d.create(e);t&&this._reset(e,n);var r=this,s=this._type===p.TUPLE,o=this.aggr();return e.add.forEach(function(e){o._add(s?e:i.call(r,e))}),e.mod.forEach(function(e){if(t)o._add(s?e:i.call(r,e));else if(u.has_prev(e)){var n=a.call(r,e);o._mod(s?e:i.call(r,e),s?n:i.call(r,n))}}),e.rem.forEach(function(e){var t=u.has_prev(e)?a.call(r,e):e;o._rem(s?t:i.call(r,t)),r._cache[e._id]=r._prev[e._id]=null}),o.changes(e,n)};var m=["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","modeskew","min","max","argmin","argmax"];t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Aggregate transform",description:"Compute summary aggregate statistics",type:"object",properties:{type:{"enum":["aggregate"]},groupby:{type:"array",items:{type:"string"},description:"A list of fields to split the data into groups."},summarize:{oneOf:[{type:"object",additionalProperties:{type:"array",description:"An array of aggregate functions.",items:{"enum":m}}},{type:"array",items:{type:"object",properties:{name:{type:"string",description:"The name of the field to aggregate."},ops:{type:"array",description:"An array of aggregate functions.",items:{"enum":m}},as:{type:"array",description:"An optional array of names to use for the output fields.",items:{type:"string"}}},additionalProperties:!1,required:["name","ops"]}}]}},additionalProperties:!1,required:["type","groupby","summarize"]}},{"../dataflow/changeset":36,"../dataflow/tuple":37,"../util/constants":108,"../util/debug":109,"./Facetor":88,"./Transform":100,datalib:20}],84:[function(e,t,n){function r(){}var i=e("./Transform"),a=e("../dataflow/Collector"),s=r.prototype=new i;s.init=function(e){return i.prototype.init.call(this,e),this._collector=new a(e),this},s.transform=function(e){this._collector.evaluate(e);var t=this._collector.data();return this.batchTransform(e,t)},s.batchTransform=function(e,t){},t.exports=r},{"../dataflow/Collector":31,"./Transform":100}],85:[function(e,t,n){function r(e){return a.prototype.init.call(this,e),a.addParameters(this,{field:{type:"field"},min:{type:"value"},max:{type:"value"},base:{type:"value","default":10},maxbins:{type:"value","default":20},step:{type:"value"},steps:{type:"value"},minstep:{type:"value"},div:{type:"array<value>","default":[5,2]}}),this._output={bin:"bin"},this}var i=e("datalib"),a=e("./Transform"),s=e("../dataflow/tuple"),o=r.prototype=new a;o.transform=function(e){function t(t){var i=n.param("field").accessor(t);i=null==i?null:d.start+d.step*~~((i-d.start)/d.step),s.set(t,r,i,e.stamp)}var n=this,r=this._output.bin,a=this.param("step"),o=this.param("steps"),l=this.param("minstep"),u={min:this.param("min"),max:this.param("max"),base:this.param("base"),maxbins:this.param("maxbins"),div:this.param("div")};a&&(u.step=a),o&&(u.steps=o),l&&(u.minstep=l);var d=i.bins(u);return e.add.forEach(t),e.mod.forEach(t),e.rem.forEach(t),e},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Bin transform",description:"Bins values into quantitative bins (e.g., for a histogram).",type:"object",properties:{type:{"enum":["bin"]},field:{type:"string",description:"The name of the field to bin values from."},min:{type:"number",description:"The minimum bin value to consider."},max:{type:"number",description:"The maximum bin value to consider."},base:{type:"number",description:"The number base to use for automatic bin determination.","default":10},maxbins:{type:"number",description:"The maximum number of allowable bins.","default":20},step:{type:"number",description:"An exact step size to use between bins. If provided, options such as maxbins will be ignored."},steps:{type:"array",items:{type:"number"},description:"An array of allowable step sizes to choose from."},minstep:{type:"number",description:"A minimum allowable step size (particularly useful for integer values)."},div:{type:"array",items:{type:"number"},description:"An array of scale factors indicating allowable subdivisions.","default":[5,2]}},additionalProperties:!1,required:["type","field","min","max"]}},{"../dataflow/tuple":37,"./Transform":100,datalib:20}],86:[function(e,t,n){function r(e){return u.prototype.init.call(this,e),u.addParameters(this,{"with":{type:"data"},diagonal:{type:"value","default":"true"}}),this._output={left:"a",right:"b"},this._collector=new d(e),this._lastRem=null,this._lastWith=null,this._ids={},this._cache={},this.router(!0)}function i(e,t){var n=this._cache[e._id]=this._cache[e._id]||{c:[],s:this._stamp};n.c.push(t)}function a(e,t,n,r,a){for(var s,o,l,u=t?n:this._collector.data(),d=0,c=u.length,h=void 0!==a._prev?null:void 0;c>d;++d)o=u[d],l=t?a._id+"_"+o._id:o._id+"_"+a._id,this._ids[l]||(a._id!=o._id||r)&&(s=f.ingest({},h),s[this._output.left]=t?a:o,s[this._output.right]=t?o:a,e.add.push(s),i.call(this,a,s),i.call(this,o,s),this._ids[l]=1)}function s(e,t,n){var r=this,i=this._cache[n._id];this._lastRem>i.s&&(i.c=i.c.filter(function(e){var n=e[r._output[t?"right":"left"]];return null!==r._cache[n._id]}),i.s=this._lastRem),e.mod.push.apply(e.mod,i.c)}function o(e,t){e.rem.push.apply(e.rem,this._cache[t._id].c),this._cache[t._id]=null,this._lastRem=this._stamp}function l(e,t){(e.add.length||e.rem.length)&&(t.fields[this._output.left]=1,t.fields[this._output.right]=1)}var u=e("./Transform"),d=e("../dataflow/Collector"),c=e("../util/debug"),f=e("../dataflow/tuple"),h=e("../dataflow/changeset"),p=r.prototype=new u;p.transform=function(e){c(e,["crossing"]),this._collector.evaluate(e);var t=this.param("with"),n=this.param("diagonal"),r=!t.name,i=this._collector.data(),u=r?e:t.source.last(),d=r?i:t.source.values(),f=h.create(e),p=o.bind(this,f);return e.rem.forEach(p),e.add.forEach(a.bind(this,f,!0,d,n)),!r&&u.stamp>this._lastWith&&(u.rem.forEach(p),u.add.forEach(a.bind(this,f,!1,i,n)),u.mod.forEach(s.bind(this,f,!1)),l.call(this,u,f),this._lastWith=u.stamp),e.mod.forEach(s.bind(this,f,!0)),l.call(this,e,f),f},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Cross transform",description:"Compute the cross-product of two data sets.",type:"object",properties:{type:{"enum":["cross"]},"with":{type:"string",description:"The name of the secondary data set to cross with the primary data. If unspecified, the primary data is crossed with itself."},diagonal:{type:"boolean",description:'If false, items along the "diagonal" of the cross-product (those elements with the same index in their respective array) will not be included in the output.',"default":!0},output:{type:"object",description:"Rename the output data fields",properties:{left:{type:"string","default":"a"},right:{type:"string","default":"b"}},additionalProperties:!1}},additionalProperties:!1,required:["type","with"]}},{"../dataflow/Collector":31,"../dataflow/changeset":36,"../dataflow/tuple":37,"../util/debug":109,"./Transform":100}],87:[function(e,t,n){function r(t){return a.addParameters(this,{transform:{type:"custom",set:function(e){return this._transform._pipeline=e,this._transform},get:function(){var t=e("../parse/transforms"),n=this._transform;return n._pipeline.map(function(e){return t(n._graph,e)})}}}),this._pipeline=[],s.call(this,t)}var i=e("datalib"),a=e("./Transform"),s=e("./Aggregate"),o=r.prototype=Object.create(s.prototype);o.aggr=function(){return s.prototype.aggr.call(this).facet(this)},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Facet transform",description:'A special aggregate transform that organizes a data set into groups or "facets".',type:"object",properties:i.extend({},s.schema.properties,{type:{"enum":["facet"]},transform:{$ref:"#/refs/transform"}}),required:["type","groupby"]}},{"../parse/transforms":60,"./Aggregate":83,"./Transform":100,datalib:20}],88:[function(e,t,n){function r(){d.constructor.call(this),this._facet=null}function i(e){l({},["deleting cell",this.tuple._id]);var t=this.ds.pipeline();e.removeListener(t[0]),e._graph.disconnect(t)}var a=e("datalib"),s=e("../dataflow/tuple"),o=e("../dataflow/changeset"),l=e("../util/debug"),u=e("../util/constants"),d=a.groupby(),c=r.prototype=Object.create(d);c.facet=function(e){return arguments.length?(this._facet=e,this):this._facet},c._ingest=function(e){return s.ingest(e,null)},c._assign=s.set,c._newcell=function(e){var t,n,r=d._newcell.call(this,e),a=this._facet,s=r.tuple;return null!==this._facet&&(t=a._graph,n=a.param("transform"),r.ds=t.data("vg_"+s._id,n,s),r["delete"]=i,a.addListener(n[0])),r},c._newtuple=function(e){var t=d._newtuple.call(this,e);return null!==this._facet&&s.set(t,"key",this._cellkey(e)),t},c.clear=function(){if(null!==this._facet)for(var e in this._cells)this._cells[e]["delete"](this._facet);return d.clear.call(this)},c._add=function(e){var t=this._cell(e);d._add.call(this,e),null!==this._facet&&t.ds._input.add.push(e)},c._mod=function(e,t){var n=this._cell(t),r=this._cell(e);d._mod.call(this,e,t),null!==this._facet&&(n===r?n.ds._input.mod.push(e):(n.ds._input.rem.push(e),r.ds._input.add.push(e)))},c._rem=function(e){var t=this._cell(e);d._rem.call(this,e),null!==this._facet&&t.ds._input.rem.push(e)},c.changes=function(e,t){var n,r,i,a,s=this._aggr;for(a in this._cells){for(n=this._cells[a],r=n.flag,n.collect&&n.data.values(),i=0;i<s.length;++i)n.aggs[s[i].name].set();n.num<=0?(r===u.MOD_CELL&&t.rem.push(n.tuple),null!==this._facet&&n["delete"](this._facet),delete this._cells[a]):(null!==this._facet&&o.copy(e,n.ds._input),r&u.ADD_CELL?t.add.push(n.tuple):r&u.MOD_CELL&&t.mod.push(n.tuple)),n.flag=0}return this._rems=!1,t},t.exports=r},{"../dataflow/changeset":36,"../dataflow/tuple":37,"../util/constants":108,"../util/debug":109,datalib:20}],89:[function(e,t,n){function r(e){return a.prototype.init.call(this,e),a.addParameters(this,{test:{type:"expr"}}),this._skip={},this}function i(e){return o.eval(this._graph,this.param("test"),e,null,null,null,this.dependency(u.SIGNALS))}var a=e("./Transform"),s=e("../dataflow/changeset"),o=e("../parse/expr"),l=e("../util/debug"),u=e("../util/constants"),d=r.prototype=new a;d.transform=function(e){l(e,["filtering"]);var t=s.create(e),n=this._skip,r=this;return e.rem.forEach(function(e){1!==n[e._id]?t.rem.push(e):n[e._id]=0}),e.add.forEach(function(e){i.call(r,e)?t.add.push(e):n[e._id]=1}),e.mod.forEach(function(e){var a=i.call(r,e),s=1===n[e._id];a&&s?(n[e._id]=0,t.add.push(e)):a&&!s?t.mod.push(e):!a&&s||(t.rem.push(e),n[e._id]=1)}),t},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Filter transform",description:"Filters elements from a data set to remove unwanted items.",type:"object",properties:{type:{"enum":["filter"]},test:{type:"string",description:"A string containing an expression (in JavaScript syntax) for the filter predicate."}},additionalProperties:!1,required:["type","test"]}},{"../dataflow/changeset":36,"../parse/expr":47,"../util/constants":108,"../util/debug":109,"./Transform":100}],90:[function(e,t,n){function r(e){return o.prototype.init.call(this,e),o.addParameters(this,{fields:{type:"array<field>"}}),this._output={key:"key",value:"value"},this._cache={},this.router(!0).revises(!0)}function i(e,t){for(var n in this._cache)t.rem.push.apply(t.rem,this._cache[n]);this._cache={}}function a(e,t,n){var r=this._cache[e._id]||(this._cache[e._id]=Array(n));return r[t]||(r[t]=u.derive(e,e._prev))}function s(e,t,n,r,i){for(var s,o,l,d=0,c=e.length,f=t.length;c>d;++d)for(o=e[d],s=0;f>s;++s)l=a.call(this,o,s,f),u.set(l,this._output.key,t[s]),u.set(l,this._output.value,n[s](o)),r.push(l)}var o=e("./Transform"),l=e("../util/debug"),u=e("../dataflow/tuple"),d=e("../dataflow/changeset"),c=r.prototype=new o;c.transform=function(e,t){l(e,["folding"]);var n=this,r=this.param("fields"),a=d.create(e);return t&&i.call(this,e,a),s.call(this,e.add,r.field,r.accessor,a.add,e.stamp),s.call(this,e.mod,r.field,r.accessor,t?a.add:a.mod,e.stamp),e.rem.forEach(function(e){a.rem.push.apply(a.rem,n._cache[e._id]),n._cache[e._id]=null}),(e.add.length||e.rem.length||r.field.some(function(t){return!!e.fields[t]}))&&(a.fields[this._output.key]=1,a.fields[this._output.value]=1),a},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Fold transform",description:'Collapse ("fold") one or more data properties into two properties.',type:"object",properties:{type:{"enum":["fold"]},fields:{type:"array",description:"An array of field references indicating the data properties to fold.",items:{type:"string"},minItems:1,uniqueItems:!0},output:{type:"object",description:"Rename the output data fields",properties:{key:{type:"string","default":"key"},value:{type:"string","default":"value"}},additionalProperties:!1}},additionalProperties:!1,required:["type","fields"]}},{"../dataflow/changeset":36,"../dataflow/tuple":37,"../util/debug":109,"./Transform":100}],91:[function(e,t,n){(function(n){function r(e){return a.prototype.init.call(this,e),a.addParameters(this,{size:{type:"array<value>","default":[500,500]},links:{type:"data"},linkDistance:{type:"field|value","default":20},linkStrength:{type:"field|value","default":1},charge:{type:"field|value","default":-30},chargeDistance:{type:"field|value","default":1/0},iterations:{type:"value","default":500},friction:{type:"value","default":.9},theta:{type:"value","default":.8},gravity:{type:"value","default":.1},alpha:{type:"value","default":.1}}),this._nodes=[],this._links=[],this._layout=i.layout.force(),this._output={x:"layout_x",y:"layout_y",source:"_source",target:"_target"},this}var i="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,a=e("./Transform"),s=e("../dataflow/tuple"),o=r.prototype=new a;o.transform=function(e){var t=this.param("links").source.last(),n=this._layout,r=this._output,i=this._nodes,a=this._links,o=this.param("iterations");e.add.forEach(function(e){i.push({tuple:e})}),t.add.forEach(function(e){var t={tuple:e,source:i[e.source],target:i[e.target]};s.set(e,r.source,t.source.tuple),s.set(e,r.target,t.target.tuple),a.push(t)}),n.size(this.param("size")).linkDistance(this.param("linkDistance")).linkStrength(this.param("linkStrength")).charge(this.param("charge")).chargeDistance(this.param("chargeDistance")).friction(this.param("friction")).theta(this.param("theta")).gravity(this.param("gravity")).alpha(this.param("alpha")).nodes(i).links(a),n.start();for(var l=0;o>l;++l)n.tick();if(n.stop(),i.forEach(function(e){s.set(e.tuple,r.x,e.x),s.set(e.tuple,r.y,e.y)}),e.rem.length>0){var u=s.idMap(e.rem);this._nodes=i.filter(function(e){return!u[e.tuple._id]})}if(t.rem.length>0){var d=s.idMap(t.rem);this._links=a.filter(function(e){return!d[e.tuple._id]})}return e.fields[r.x]=1,e.fields[r.y]=1,e},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Force transform",description:"Performs force-directed layout for network data.",type:"object",properties:{type:{"enum":["force"]},size:{type:"array",description:"The dimensions [width, height] of this force layout.",minItems:2,maxItems:2,items:{type:"number"},"default":[500,500]},links:{type:"string",description:"The name of the link (edge) data set."},linkDistance:{type:["number","string"],description:"Determines the length of edges, in pixels.","default":20},linkStrength:{type:["number","string"],description:"Determines the tension of edges (the spring constant).","default":1},charge:{type:["number","string"],description:"The strength of the charge each node exerts.","default":-30},chargeDistance:{type:["number","string"],description:"The maximum distance over which charge forces are applied.","default":1/0},iterations:{type:"number",description:"The number of iterations to run the force directed layout.","default":500},friction:{type:"number",description:"The strength of the friction force used to stabilize the layout.","default":.9},theta:{type:"number",description:"The theta parameter for the Barnes-Hut algorithm, which is used to compute charge forces between nodes.","default":.8},gravity:{type:"number",description:"The strength of the pseudo-gravity force that pulls nodes towards the center of the layout area.","default":.1},alpha:{type:"number",description:'A "temperature" parameter that determines how much node positions are adjusted at each step.',"default":.1},output:{type:"object",description:"Rename the output data fields",properties:{x:{type:"string","default":"layout_x"},y:{type:"string","default":"layout_y"},source:{type:"string","default":"_source"},target:{type:"string","default":"_target"}},additionalProperties:!1}},additionalProperties:!1,required:["type","links"]}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":37,"./Transform":100}],92:[function(e,t,n){function r(e){return i.prototype.init.call(this,e),i.addParameters(this,{field:{type:"value"},expr:{type:"expr"}}),this}var i=e("./Transform"),a=e("../dataflow/tuple"),s=e("../parse/expr"),o=e("../util/debug"),l=e("../util/constants"),u=r.prototype=new i;u.transform=function(e){function t(e){var t=s.eval(n,i,e,null,null,null,u);a.set(e,r,t)}o(e,["formulating"]);var n=this._graph,r=this.param("field"),i=this.param("expr"),u=this.dependency(l.SIGNALS);return e.add.forEach(t),this.reevaluate(e)&&e.mod.forEach(t),e.fields[r]=1,e},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Formula transform",description:"Extends data elements with new values according to a calculation formula.",type:"object",properties:{type:{"enum":["formula"]},field:{type:"string",description:"The property name in which to store the computed formula value."},expr:{type:"string",description:"A string containing an expression (in JavaScript syntax) for the formula."}},required:["type","field","expr"]}},{"../dataflow/tuple":37,"../parse/expr":47,"../util/constants":108,"../util/debug":109,"./Transform":100}],93:[function(e,t,n){(function(n){function r(e){return s.prototype.init.call(this,e),s.addParameters(this,r.Parameters),s.addParameters(this,{lon:{type:"field"},lat:{type:"field"}}),this._output={x:"layout_x",y:"layout_y"},this}var i=e("datalib"),a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,s=e("./Transform"),o=e("../dataflow/tuple");r.Parameters={projection:{type:"value","default":"mercator"},center:{type:"array[value]"},translate:{type:"array[value]"},rotate:{type:"array[value]"},scale:{type:"value"},precision:{type:"value"},clipAngle:{type:"value"},clipExtent:{type:"value"}},r.d3Projection=function(){var e,t,n,s=(this._graph,this.param("projection")),o=r.Parameters;s!==this._mode&&(this._mode=s,this._projection=a.geo[s]()),e=this._projection;for(t in o)"projection"!==t&&e[t]&&(n=this.param(t),void 0===n||i.isArray(n)&&0===n.length||n!==e[t]()&&e[t](n));return e};var l=r.prototype=new s;l.transform=function(e){function t(e){var t=[i(e),a(e)],r=s(t);o.set(e,n.x,r[0]),o.set(e,n.y,r[1])}var n=(this._graph,this._output),i=this.param("lon").accessor,a=this.param("lat").accessor,s=r.d3Projection.call(this);return e.add.forEach(t),this.reevaluate(e)&&(e.mod.forEach(t),e.rem.forEach(t)),e.fields[n.x]=1,e.fields[n.y]=1,e},t.exports=r,r.baseSchema={projection:{type:"string",description:"The type of cartographic projection to use.","default":"mercator"},center:{type:"array",description:"The center of the projection.",items:{type:"number"},minItems:2,maxItems:2},translate:{type:"array",description:"The translation of the projection.",items:{type:"number"},minItems:2,maxItems:2},rotate:{type:"number",description:"The rotation of the projection."},scale:{type:"number",description:"The scale of the projection."},precision:{type:"number",description:"The desired precision of the projection."},clipAngle:{type:"number",description:"The clip angle of the projection."},clipExtent:{type:"number",description:"The clip extent of the projection."}},r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Geo transform",description:"Performs a cartographic projection. Given longitude and latitude values, sets corresponding x and y properties for a mark.",type:"object",properties:i.extend({type:{"enum":["geo"]},lon:{type:"string",description:"The input longitude values."},lat:{type:"string",description:"The input latitude values."},output:{type:"object",description:"Rename the output data fields",properties:{x:{type:"string","default":"layout_x"},y:{type:"string","default":"layout_y"}}}},r.baseSchema),required:["type","lon","lat"]}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":37,"./Transform":100,datalib:20}],94:[function(e,t,n){(function(n){function r(e){return o.prototype.init.call(this,e),o.addParameters(this,s.Parameters),o.addParameters(this,{value:{type:"field","default":null}}),this._output={path:"layout_path"},this}var i=e("datalib"),a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,s=e("./Geo"),o=e("./Transform"),l=e("../dataflow/tuple"),u=r.prototype=new o;u.transform=function(e){function t(e){l.set(e,n.path,u(r(e)))}var n=this._output,r=this.param("value").accessor||i.identity,o=s.d3Projection.call(this),u=a.geo.path().projection(o);return e.add.forEach(t),this.reevaluate(e)&&(e.mod.forEach(t),e.rem.forEach(t)),e.fields[n.path]=1,e},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Geopath transform",description:"Creates paths for geographic regions, such as countries, states and counties.",type:"object",properties:i.extend({type:{"enum":["geopath"]},value:{type:"string",description:"The data field containing GeoJSON Feature data."},output:{type:"object",description:"Rename the output data fields",properties:{path:{type:"string","default":"layout_path"}}}},s.baseSchema),required:["type","value"]
}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":37,"./Geo":93,"./Transform":100,datalib:20}],95:[function(e,t,n){function r(e){return l.prototype.init.call(this,e),l.addParameters(this,{source:{type:"field","default":"_source"},target:{type:"field","default":"_target"},x:{type:"field","default":"layout_x"},y:{type:"field","default":"layout_y"},tension:{type:"value","default":.2},shape:{type:"value","default":"line"}}),this._output={path:"layout_path"},this}function i(e,t,n,r,i,a){var s=t(e),o=r(s),l=i(s),u=n(e),d=r(u),c=i(u);return"M"+o+","+l+"L"+d+","+c}function a(e,t,n,r,i,a){var s=t(e),o=r(s),l=i(s),u=n(e),d=r(u),c=i(u),f=d-o,h=c-l,p=a*(f+h),m=a*(h-f);return"M"+o+","+l+"C"+(o+p)+","+(l+m)+" "+(d+m)+","+(c-p)+" "+d+","+c}function s(e,t,n,r,i,a){var s=t(e),o=r(s),l=i(s),u=n(e),d=r(u),c=i(u),f=(o+d)/2;return"M"+o+","+l+"C"+f+","+l+" "+f+","+c+" "+d+","+c}function o(e,t,n,r,i,a){var s=t(e),o=r(s),l=i(s),u=n(e),d=r(u),c=i(u),f=(l+c)/2;return"M"+o+","+l+"C"+o+","+f+" "+d+","+f+" "+d+","+c}var l=e("./Transform"),u=e("../dataflow/tuple"),d=r.prototype=new l,c={line:i,curve:a,diagonal:s,diagonalX:s,diagonalY:o};d.transform=function(e){function t(e){var t=r(e,i,a,s,o,l);u.set(e,n.path,t)}var n=this._output,r=c[this.param("shape")]||c.line,i=this.param("source").accessor,a=this.param("target").accessor,s=this.param("x").accessor,o=this.param("y").accessor,l=this.param("tension");return e.add.forEach(t),this.reevaluate(e)&&e.mod.forEach(t),e.fields[n.path]=1,e},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"LinkPath transform",description:"Computes a path definition for connecting nodes within a node-link network or tree diagram.",type:"object",properties:{type:{"enum":["linkpath"]},source:{type:"string",description:"The data field that references the source node for this link.","default":"_source"},target:{type:"string",description:"The data field that references the target node for this link.","default":"_target"},x:{type:"string","default":"layout_x"},y:{type:"string","default":"layout_y"},tension:{type:"number",description:'A tension parameter for the "tightness" of "curve"-shaped links.',"default":.2,minimum:0,maximum:1},shape:{"enum":["line","curve","diagonal","diagonalX","diagonalY"],description:"The path shape to use","default":"line"},output:{type:"object",description:"Rename the output data fields",properties:{path:{type:"string","default":"layout_path"}},additionalProperties:!1}},additionalProperties:!1,required:["type"]}},{"../dataflow/tuple":37,"./Transform":100}],96:[function(e,t,n){function r(e,t,n){this._name=e,this._type=t,this._transform=n,this._value=[],this._accessors=[],this._resolution=!1,this._signals={}}function i(){var e=l.test(this._type),t=u.test(this._type),n=d.test(this._type),r=e?this._value:this._value[0],i=e?this._accessors:this._accessors[0];return!a.isValid(i)&&f.test(this._type)?r:t?{name:r,source:i}:n?{field:r,accessor:i}:r}var a=e("datalib"),s=e("../parse/expr"),o=e("../util/constants"),l=/array/i,u=/data/i,d=/field/i,c=/expr/i,f=/value/i,h=r.prototype;h.get=function(){var e,t,n,r=this._transform._graph,s=u.test(this._type),o=d.test(this._type);if(!this._resolution)return i.call(this);if(s)return this._accessors=this._value.map(function(e){return r.data(e)}),i.call(this);for(e in this._signals)t=this._signals[e],n=r.signalRef(e),o&&(this._accessors[t]=this._value[t]!=n?a.accessor(n):this._accessors[t]),this._value[t]=n;return i.call(this)},h.set=function(e){var t=this,n=c.test(this._type),r=u.test(this._type),i=d.test(this._type);return this._value=a.array(e).map(function(e,l){if(a.isString(e)){if(n){var u=s(e);return t._transform.dependency(o.FIELDS,u.fields),t._transform.dependency(o.SIGNALS,u.signals),u.fn}return i?(t._accessors[l]=a.accessor(e),t._transform.dependency(o.FIELDS,e)):r&&(t._resolution=!0,t._transform.dependency(o.DATA,e)),e}return void 0!==e.value?e.value:void 0!==e.field?(t._accessors[l]=a.accessor(e.field),t._transform.dependency(o.FIELDS,e.field),e.field):void 0!==e.signal?(t._resolution=!0,t._signals[e.signal]=l,t._transform.dependency(o.SIGNALS,e.signal),e.signal):e}),t._transform},t.exports=r},{"../parse/expr":47,"../util/constants":108,datalib:20}],97:[function(e,t,n){(function(n){function r(e){return l.prototype.init.call(this,e),o.addParameters(this,{value:{type:"field","default":null},startAngle:{type:"value","default":0},endAngle:{type:"value","default":2*Math.PI},sort:{type:"value","default":!1}}),this._output={start:"layout_start",end:"layout_end",mid:"layout_mid"},this}function i(){return 1}var a=e("datalib"),s="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,o=e("./Transform"),l=e("./BatchTransform"),u=e("../dataflow/tuple"),d=r.prototype=new l;d.batchTransform=function(e,t){var n,r,o,l=(this._graph,this._output),d=this.param("value").accessor||i,c=this.param("startAngle"),f=this.param("endAngle"),h=this.param("sort"),p=t.map(d),m=c,g=(f-c)/s.sum(p),y=a.range(t.length);for(h&&y.sort(function(e,t){return p[e]-p[t]}),n=0;n<y.length;++n)r=t[y[n]],o=p[y[n]],u.set(r,l.start,m),u.set(r,l.mid,m+.5*o*g),u.set(r,l.end,m+=o*g);return e.fields[l.start]=1,e.fields[l.end]=1,e.fields[l.mid]=1,e},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Pie transform",description:"Computes a pie chart layout.",type:"object",properties:{type:{"enum":["pie"]},value:{type:"string",description:"The data values to encode as angular spans. If this property is omitted, all pie slices will have equal spans."},startAngle:{type:"number",minimum:0,maximum:2*Math.PI,"default":0},endAngle:{type:"number",minimum:0,maximum:2*Math.PI,"default":2*Math.PI},sort:{type:"boolean",description:" If true, will sort the data prior to computing angles.","default":!1},output:{type:"object",description:"Rename the output data fields",properties:{start:{type:"string","default":"layout_start"},end:{type:"string","default":"layout_end"},mid:{type:"string","default":"layout_mid"}}}},required:["type"]}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":37,"./BatchTransform":84,"./Transform":100,datalib:20}],98:[function(e,t,n){function r(e){return a.prototype.init.call(this,e),a.addParameters(this,{by:{type:"array<field>"}}),this.router(!0)}var i=e("datalib"),a=e("./Transform"),s=(e("../parse/expr"),e("../util/debug")),o=r.prototype=new a;o.transform=function(e){return s(e,["sorting"]),(e.add.length||e.mod.length||e.rem.length)&&(e.sort=i.comparator(this.param("by").field)),e},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Sort transform",description:"Sorts the values of a data set.",type:"object",properties:{type:{"enum":["sort"]},by:{oneOf:[{type:"string"},{type:"array",items:{type:"string"}}],description:"A list of fields to use as sort criteria."}},required:["type","by"]}},{"../parse/expr":47,"../util/debug":109,"./Transform":100,datalib:20}],99:[function(e,t,n){function r(e){return o.prototype.init.call(this,e),s.addParameters(this,{groupby:{type:"array<field>"},sortby:{type:"array<field>"},value:{type:"field"},offset:{type:"value","default":"zero"}}),this._output={start:"layout_start",end:"layout_end",mid:"layout_mid"},this}function i(e,t,n,r){var i,a,s,o,l,u,d,c=[];if(null==t)c.push(e.slice());else for(i={},a=0;a<e.length;++a)s=e[a],o=t.map(function(e){return e(s)}),l=i[o]||(c.push(i[o]=[]),i[o]),l.push(s);for(o=0,d=0;o<c.length;++o){for(l=c[o],a=0,u=0;a<l.length;++a)u+=r(l[a]);l.sum=u,u>d&&(d=u),null!=n&&l.sort(n)}return c.max=d,c}var a=e("datalib"),s=e("./Transform"),o=e("./BatchTransform"),l=e("../dataflow/tuple"),u=r.prototype=new o;u.batchTransform=function(e,t){for(var n=(this._graph,this.param("groupby").accessor),r=a.comparator(this.param("sortby").field),s=this.param("value").accessor,o=this.param("offset"),u=this._output,d=i(t,n,r,s),c=0,f=d.max;c<d.length;++c){var c,h,p,m=d[c],g=m.sum,y="center"===o?(f-g)/2:0,v="normalize"===o?1/g:1,_=y,b=0;for(j=0;j<m.length;++j)h=m[j],p=_,b+=s(h),_=v*b+y,l.set(h,u.start,p),l.set(h,u.end,_),l.set(h,u.mid,.5*(p+_))}return e.fields[u.start]=1,e.fields[u.end]=1,e.fields[u.mid]=1,e},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Stack transform",description:"Computes layout values for stacked graphs, as in stacked bar charts or stream graphs.",type:"object",properties:{type:{"enum":["stack"]},groupby:{type:"array",items:{type:"string"},description:"A list of fields to split the data into groups (stacks)."},sortby:{type:"array",items:{type:"string"},description:"A list of fields to determine the sort order of stacks."},value:{type:"string",description:"The data field that determines the thickness/height of stacks."},offset:{"enum":["zero","silhouette","wiggle","expand"],description:"The baseline offset","default":"zero"},output:{type:"object",description:"Rename the output data fields",properties:{start:{type:"string","default":"layout_start"},end:{type:"string","default":"layout_end"},mid:{type:"string","default":"layout_mid"}},additionalProperties:!1}},additionalProperties:!1,required:["type","groupby","value"]}},{"../dataflow/tuple":37,"./BatchTransform":84,"./Transform":100,datalib:20}],100:[function(e,t,n){function r(e){return e&&i.prototype.init.call(this,e),this}var i=e("../dataflow/Node"),a=e("./Parameter"),s=e("../util/constants");r.addParameters=function(e,t){e._parameters=e._parameters||{};for(var n in t){var r=t[n],i=e._parameters[n]=new a(n,r.type,e);"custom"===r.type&&(r.set&&(i.set=r.set.bind(i)),r.get&&(i.get=r.get.bind(i))),r.hasOwnProperty("default")&&i.set(r["default"])}};var o=r.prototype=new i;o.param=function(e,t){return 1===arguments.length?this._parameters[e].get():this._parameters[e].set(t)},o.transform=function(e,t){return e},o.evaluate=function(e){var t=this._stamp<e.stamp&&this.dependency(s.SIGNALS).some(function(t){return!!e.signals[t]});return this.transform(e,t)},o.output=function(e){for(var t in this._output)void 0!==e[t]&&(this._output[t]=e[t]);return this},t.exports=r},{"../dataflow/Node":34,"../util/constants":108,"./Parameter":96}],101:[function(e,t,n){(function(n){function r(e){return o.prototype.init.call(this,e),s.addParameters(this,{sort:{type:"array<field>","default":["-value"]},children:{type:"field","default":"children"},value:{type:"field","default":"value"},size:{type:"array<value>","default":[500,500]},round:{type:"value","default":!0},sticky:{type:"value","default":!1},ratio:{type:"value","default":u},padding:{type:"value","default":null},mode:{type:"value","default":"squarify"}}),this._layout=a.layout.treemap(),this._output={x:"layout_x",y:"layout_y",width:"layout_width",height:"layout_height"},this}var i=e("datalib"),a="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,s=e("./Transform"),o=e("./BatchTransform"),l=e("../dataflow/tuple"),u=.5*(1+Math.sqrt(5)),d=r.prototype=new o;d.batchTransform=function(e,t){var n=this._layout,r=this._output;return n.sort(i.comparator(this.param("sort").field)).children(this.param("children").accessor).value(this.param("value").accessor).size(this.param("size")).round(this.param("round")).sticky(this.param("sticky")).ratio(this.param("ratio")).padding(this.param("padding")).mode(this.param("mode")).nodes(t[0]),t.forEach(function(e){l.set(e,r.x,e.x),l.set(e,r.y,e.y),l.set(e,r.width,e.dx),l.set(e,r.height,e.dy)}),e.fields[r.x]=1,e.fields[r.y]=1,e.fields[r.width]=1,e.fields[r.height]=1,e},t.exports=r,r.schema={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{type:{"enum":["treemap"]},sort:{type:"array",items:{type:"string"},description:"A list of fields to use as sort criteria for sibling nodes.","default":["-value"]},children:{type:"string",description:"A data field that represents the children array","default":"children"},value:{type:"string",description:"The values to use to determine the area of each leaf-level treemap cell.","default":"value"},size:{type:"array",items:{type:"number"},description:"The dimensions of the treemap layout",minItems:0,maxItems:0,"default":[500,500]},round:{type:"boolean",description:"If true, treemap cell dimensions will be rounded to integer pixels.","default":!0},sticky:{type:"boolean",description:"If true, repeated runs of the treemap will use cached partition boundaries.","default":!1},ratio:{type:"number",description:"The target aspect ratio for the layout to optimize.","default":u},padding:{oneOf:[{type:"number"},{type:"array",items:{type:"number"},minItems:4,maxItems:4}],description:"he padding (in pixels) to provide around internal nodes in the treemap."},output:{type:"object",description:"Rename the output data fields",properties:{x:{type:"string","default":"layout_x"},y:{type:"string","default":"layout_y"},width:{type:"string","default":"layout_width"},height:{type:"string","default":"layout_height"}}}},required:["type","groupby","value"]}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dataflow/tuple":37,"./BatchTransform":84,"./Transform":100,datalib:20}],102:[function(e,t,n){function r(e){return s.prototype.init.call(this,e),s.addParameters(this,{"with":{type:"data"},as:{type:"value"},key:{type:"field","default":"data"},withKey:{type:"field","default":null},"default":{type:"value"}}),this._map={},this._collector=new o(e),this._lastJoin=0,this.revises(!0)}function i(e){return this._map[e]||(this._map[e]=[])}var a=e("datalib"),s=e("./Transform"),o=e("../dataflow/Collector"),l=e("../util/debug"),u=r.prototype=new s;u.transform=function(e){var t=this.param("with"),n=t.source,r=n.last(),s=n.values(),o=this.param("key"),u=this.param("withKey"),d=this.param("as"),c=this.param("default"),f=i.bind(this),h={};if(l(e,["zipping",t.name]),u.field)r&&r.stamp>this._lastJoin&&(r.rem.forEach(function(e){var t=f(u.accessor(e));t[0]&&t[0].forEach(function(e){e[d]=c}),t[1]=null}),r.add.forEach(function(e){var t=f(u.accessor(e));t[0]&&t[0].forEach(function(t){t[d]=e}),t[1]=e}),r.fields[u.field]&&r.mod.forEach(function(e){var t;if(e._prev&&void 0!==(t=u.accessor(e._prev))){var n=f(t);n[0]&&n[0].forEach(function(e){e[d]=c}),n[1]=null;var r=f(u.accessor(e));r[0]&&r[0].forEach(function(t){t[d]=e}),r[1]=e}}),this._lastJoin=r.stamp),e.add.forEach(function(e){var t=f(o.accessor(e));e[d]=t[1]||c,(t[0]=t[0]||[]).push(e)}),e.rem.forEach(function(e){var t=o.accessor(e);(h[t]=h[t]||{})[e._id]=1}),e.fields[o.field]&&e.mod.forEach(function(e){var t;if(e._prev&&void 0!==(t=o.accessor(e._prev))){var n=f(o.accessor(e));e[d]=n[1]||c,(n[0]=n[0]||[]).push(e),(h[t]=h[t]||{})[e._id]=1}}),a.keys(h).forEach(function(e){var t=f(e);t[0]&&(t[0]=t[0].filter(function(t){return 1!==h[e][t._id]}))});else{if(0==e.add.length&&0==e.rem.length&&0==r.add.length&&0==r.rem.length)return e;this._collector.evaluate(e);var p,m=this._collector.data(),g=s.length;for(p=0;p<m.length;p++)m[p][d]=s[p%g]}return e.fields[d]=1,e},t.exports=r,r.baseSchema={type:{"enum":["zip"]},"with":{type:"string",description:'The name of the secondary data set to "zip" with the current, primary data set.'},as:{type:"string",description:"The name of the field in which to store the secondary data set values."}},r.schema={$schema:"http://json-schema.org/draft-04/schema#",title:"Zip transform",description:"Merges two data sets together.",type:"object",oneOf:[{properties:r.baseSchema,required:["type","with","as"],additionalProperties:!1},{properties:a.extend({key:{type:"string",description:"The field in the primary data set to match against the secondary data set."},withKey:{type:"string",description:"The field in the secondary data set to match against the primary data set."},"default":{description:"A default value to use if no matching key value is found."}},r.baseSchema),required:["type","with","as","key","withKey"],additionalProperties:!1}]}},{"../dataflow/Collector":31,"../util/debug":109,"./Transform":100,datalib:20}],103:[function(e,t,n){t.exports={aggregate:e("./Aggregate"),bin:e("./Bin"),cross:e("./Cross"),linkpath:e("./LinkPath"),facet:e("./Facet"),filter:e("./Filter"),fold:e("./Fold"),force:e("./Force"),formula:e("./Formula"),geo:e("./Geo"),geopath:e("./GeoPath"),pie:e("./Pie"),sort:e("./Sort"),stack:e("./Stack"),treemap:e("./Treemap"),zip:e("./Zip")}},{"./Aggregate":83,"./Bin":85,"./Cross":86,"./Facet":87,"./Filter":89,"./Fold":90,"./Force":91,"./Formula":92,"./Geo":93,"./GeoPath":94,"./LinkPath":95,"./Pie":97,"./Sort":98,"./Stack":99,"./Treemap":101,"./Zip":102}],104:[function(e,t,n){var r=function(e){this.clear(),e&&this.union(e)},i=r.prototype;i.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},i.set=function(e,t,n,r){return this.x1=e,this.y1=t,this.x2=n,this.y2=r,this},i.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},i.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},i.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},i.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},i.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),a=t-t*r+n*i,s=n-t*i-n*r,o=this.x1,l=this.x2,u=this.y1,d=this.y2;return this.clear().add(r*o-i*u+a,i*o+r*u+s).add(r*o-i*d+a,i*o+r*d+s).add(r*l-i*u+a,i*l+r*u+s).add(r*l-i*d+a,i*l+r*d+s)},i.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},i.encloses=function(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},i.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},i.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},i.width=function(){return this.x2-this.x1},i.height=function(){return this.y2-this.y1},t.exports=r},{}],105:[function(e,t,n){function r(e){this.id="grad_"+i++,this.type=e||"linear",this.stops=[],this.x1=0,this.x2=1,this.y1=0,this.y2=0}var i=0,a=r.prototype;a.stop=function(e,t){return this.stops.push({offset:e,color:t}),this},t.exports=r},{}],106:[function(e,t,n){(function(n){function r(e){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:w.render.fontSize)+"px "+(e.font||w.render.font)}function i(){return C||(C=(_.isNode?new("undefined"!=typeof window?window.canvas:"undefined"!=typeof n?n.canvas:null)(1,1):v.select("body").append("canvas").attr("class","vega_hidden").attr("width",1).attr("height",1).style("display","none").node()).getContext("2d"))}function a(e,t,n){return null==t?n.set(0,0,0,0):(E(t,n),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&n.expand(e.strokeWidth)),n}function s(e,t){var n=e.path?e.pathCache||(e.pathCache=k(e.path)):null;return a(e,n,t)}function o(e,t){var n=e.mark.items,e=n[0],r=e.pathCache||(e.pathCache=k(S(n)));return a(n[0],r,t)}function l(e,t){var n=e.mark.items,e=n[0],r=e.pathCache||(e.pathCache=k(A(n)));return a(n[0],r,t)}function u(e,t){var n=e.x||0,r=e.y||0,i=n+e.width||0,a=r+e.height||0;return t.set(n,r,i,a),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function d(e,t){var n=e.width||0,r=e.height||0,i=(e.x||0)-("center"===e.align?n/2:"right"===e.align?n:0),a=(e.y||0)-("middle"===e.baseline?r/2:"bottom"===e.baseline?r:0);return t.set(i,a,i+n,a+r)}function c(e,t){var n,r;return t.set(n=e.x||0,r=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function f(e,t){var n,r,i,a,s,o,l,u,d,c=e.x||0,f=e.y||0,h=e.innerRadius||0,p=e.outerRadius||0,m=(e.startAngle||0)-L,g=(e.endAngle||0)-L,y=1/0,v=-(1/0),_=1/0,b=-(1/0),x=[m,g],w=m-m%L;for(r=0;4>r&&g>w;++r,w+=L)x.push(w);for(r=0,i=x.length;i>r;++r)n=x[r],a=Math.cos(n),o=h*a,u=p*a,s=Math.sin(n),l=h*s,d=p*s,y=Math.min(y,o,u),v=Math.max(v,o,u),_=Math.min(_,l,d),b=Math.max(b,l,d);return t.set(c+y,f+_,c+v,f+b),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function h(e,t){var n,r,i,a,s=null!=e.size?e.size:100,o=e.x||0,l=e.y||0;switch(e.shape){case"cross":n=Math.sqrt(s/5)/2,r=3*n,t.set(o-r,l-n,o+r,l+n);break;case"diamond":a=Math.sqrt(s/(2*M)),i=a*M,t.set(o-i,l-a,o+i,l+a);break;case"square":r=Math.sqrt(s),n=r/2,t.set(o-n,l-n,o+n,l+n);break;case"triangle-down":i=Math.sqrt(s/T),a=i*T/2,t.set(o-i,l-a,o+i,l+a);break;case"triangle-up":i=Math.sqrt(s/T),a=i*T/2,t.set(o-i,l-a,o+i,l+a);break;default:n=Math.sqrt(s/Math.PI),t.set(o-n,l-n,o+n,l+n)}return e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function p(e,t,n){var a,s,o=(e.x||0)+(e.dx||0),l=(e.y||0)+(e.dy||0),u=e.fontSize||w.render.fontSize,d=e.align,c=e.baseline,f=e.radius||0,h=i();return h.font=r(e),h.textAlign=d||"left",h.textBaseline=c||"alphabetic",a=h.measureText(e.text||"").width,f&&(s=(e.theta||0)-Math.PI/2,o+=f*Math.cos(s),l+=f*Math.sin(s)),"center"===d?o-=a/2:"right"===d&&(o-=a),"top"===c?l+=u/5:"bottom"===c?l-=u:"middle"===c?l=l-u/2+u/10:l-=4*u/5,t.set(o,l,o+a,l+u),e.angle&&!n&&t.rotate(e.angle*Math.PI/180,e.x||0,e.y||0),t.expand(n?0:1)}function m(e,t,n){var r,i,a=e.axisItems||[],s=e.legendItems||[];for(r=0,i=a.length;i>r;++r)t.union(a[r].bounds);for(r=0,i=e.items.length;i>r;++r)t.union(e.items[r].bounds);if(n){for(r=0,i=s.length;i>r;++r)t.union(s[r].bounds);null!=e.width&&null!=e.height&&t.add(e.width,e.height),null!=e.x&&null!=e.y&&t.add(0,0)}return t.translate(e.x||0,e.y||0),t}function g(e,t,n){t=t||P[e.mark.marktype],e.bounds_prev||(e["bounds:prev"]=new b);var r=e.bounds,i=e["bounds:prev"];return r&&i.clear().union(r),e.bounds=t(e,r?r.clear():new b,n),r||i.clear().union(e.bounds),e.bounds}function y(e,t,n){t=t||e.bounds&&e.bounds.clear()||new b;var r,i,a=e.marktype,s=P[a],o=e.items;if("area"===a||"line"===a)o.length&&(o[0].bounds=s(o[0],t));else for(r=0,i=o.length;i>r;++r)t.union(g(o[r],s,n));e.bounds=t}var v="undefined"!=typeof window?window.d3:"undefined"!=typeof n?n.d3:null,_=e("datalib"),b=e("../util/Bounds"),x=e("../render/canvas/path"),w=e("./config"),k=x.parse,E=x.bounds,S=x.area,A=x.line,L=Math.PI/2,T=Math.sqrt(3),M=Math.tan(30*Math.PI/180),C=null,P={group:m,symbol:h,image:d,rect:u,rule:c,arc:f,text:p,path:s,area:o,line:l};t.exports={mark:y,item:g,text:p,group:m}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../render/canvas/path":65,"../util/Bounds":104,"./config":107,datalib:20}],107:[function(e,t,n){(function(e){var n="undefined"!=typeof window?window.d3:"undefined"!=typeof e?e.d3:null,r={};r.debug=!1,r.load={baseURL:"",domainWhiteList:!1},r.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',r.autopadInset=5,r.scale={time:n.time.scale,utc:n.time.scale.utc},r.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},r.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},r.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},r.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},r.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],108:[function(e,t,n){t.exports={ADD_CELL:1,MOD_CELL:2,ID:"_id",DATA:"data",FIELDS:"fields",SCALES:"scales",SIGNAL:"signal",SIGNALS:"signals",GROUP:"group",ENTER:"enter",UPDATE:"update",EXIT:"exit",SENTINEL:{sentinel:1},SINGLETON:"_singleton",ADD:"add",REMOVE:"remove",TOGGLE:"toggle",CLEAR:"clear",LINEAR:"linear",ORDINAL:"ordinal",LOG:"log",POWER:"pow",TIME:"time",QUANTILE:"quantile",DOMAIN:"domain",RANGE:"range",MARK:"mark",AXIS:"axis",LEGEND:"legend",COUNT:"count",GROUPBY:"groupby",MIN:"min",MAX:"max",VALUE:"value",SORT:"sort",ASC:"asc",DESC:"desc"}},{}],109:[function(e,t,n){var r,i=e("./config");t.exports=function(e,t){if(i.debug){var n=Function.prototype.bind.call(console.log,console);t.unshift(e.stamp||-1),t.unshift(Date.now()-r),e.add&&t.push(e.add.length,e.mod.length,e.rem.length,!!e.reflow),n.apply(console,t),r=Date.now()}}},{"./config":107}],110:[function(e,t,n){var r=e("datalib"),i=e("../parse");t.exports=function a(e){var a={defs:{},refs:{},$ref:"#/defs/spec"};return e=e||{},r.keys(i).forEach(function(e){var t=i[e].schema;t&&(t.refs&&r.extend(a.refs,t.refs),t.defs&&r.extend(a.defs,t.defs))}),e.properties&&r.keys(e.properties).forEach(function(t){a.defs.propset.properties[t]=e.properties}),e.propertySets&&r.keys(e.propertySets).forEach(function(t){a.defs.mark.properties.properties.properties[t]=e.propertySets[t]}),a}},{"../parse":48,datalib:20}]},{},[1])(1)});